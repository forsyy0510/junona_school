{% extends "base.html" %}

{% block title %}{{ title }} - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ{% endblock %}

{% block content %}
<div class="edit-container">
    <div class="edit-header">
        <h1>üìù {{ title }}</h1>
        <a href="{{ url_for('info.' + endpoint) }}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É</a>
    </div>

    <form method="POST" enctype="multipart/form-data" class="edit-form">
        {{ form.hidden_tag() }}
        
        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div class="form-section">
            <h2>‚ÑπÔ∏è –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
            <div class="form-group">
                {{ form.title.label(class="form-label") }}
                {{ form.title(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.text.label(class="form-label") }}
                {{ form.text(class="form-control", rows="4") }}
            </div>
        </div>

        <!-- –ë–ª–æ–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
        <div class="form-section">
            <h2>üß© –ë–ª–æ–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</h2>
            <div id="content-blocks-container">
                {% for block in form.content_blocks %}
                <div class="content-block">
                    <div class="content-block-header">
                        <h3 class="content-block-title">üì¶ –ë–ª–æ–∫ {{ loop.index }}</h3>
                        <button type="button" onclick="removeContentBlock(this)" class="btn btn-danger btn-sm">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –±–ª–æ–∫</button>
                    </div>
                    
                    <div class="block-type-selector">
                        {{ block.block_type.label(class="form-label") }}
                        {{ block.block_type(class="form-control") }}
                    </div>
                    
                    <div class="form-group">
                        {{ block.title.label(class="form-label") }}
                        {{ block.title(class="form-control") }}
                    </div>
                    
                    <div class="form-group">
                        {{ block.content.label(class="form-label") }}
                        {{ block.content(class="form-control", rows="3") }}
                    </div>

                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –±–ª–æ–∫–∞ -->
                    <div class="block-content" data-block-type="{{ block.block_type.data or 'text' }}">
                        <!-- –¢–∞–±–ª–∏—Ü–∞ -->
                        <div class="table-content" style="display: none;">
                            <h4>–ó–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã</h4>
                            <div id="table-headers-{{ loop.index0 }}">
                                {% for header in block.table_headers %}
                                <div style="display: flex; gap: 10px; margin-bottom: 10px; align-items: center;">
                                    <input type="text" name="content_blocks-{{ loop.index0 }}-table_headers-{{ loop.index0 }}" value="{{ header.data if header.data else '' }}" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–æ–ª–±—Ü–∞" style="flex: 1; padding: 8px; border-radius: 8px; border: 1px solid #e5e7eb;" oninput="updateTablePreview({{ loop.index0 }})">
                                    <button type="button" onclick="removeTableHeader(this)" class="btn btn-danger btn-sm">üóëÔ∏è</button>
                                </div>
                                {% endfor %}
                            </div>
                            <button type="button" onclick="addTableHeader({{ loop.index0 }})" class="btn btn-success btn-sm" style="margin-bottom: 15px;">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫</button>
                            
                            <h4>–°—Ç—Ä–æ–∫–∏ —Ç–∞–±–ª–∏—Ü—ã</h4>
                            <div id="table-rows-{{ loop.index0 }}">
                                {% for row in block.table_rows %}
                                <div style="display: flex; gap: 10px; margin-bottom: 10px; align-items: center;">
                                    <div style="flex: 1; display: flex; gap: 5px;">
                                        {% for cell in row.cells %}
                                        <input type="text" name="content_blocks-{{ loop.index0 }}-table_rows-{{ loop.index0 }}-cells-{{ loop.index0 }}" value="{{ cell.data if cell.data else '' }}" placeholder="–Ø—á–µ–π–∫–∞" style="flex: 1; padding: 8px; border-radius: 8px; border: 1px solid #e5e7eb;" oninput="updateTablePreview({{ loop.index0 }})">
                                        {% endfor %}
                                    </div>
                                    <button type="button" onclick="removeTableRow(this)" class="btn btn-danger btn-sm">üóëÔ∏è</button>
                                </div>
                                {% endfor %}
                            </div>
                            <button type="button" onclick="addTableRow({{ loop.index0 }})" class="btn btn-success btn-sm" style="margin-bottom: 20px;">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É</button>
                            
                            <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–∞–±–ª–∏—Ü—ã -->
                            <div class="table-preview-section" style="margin-top: 25px; padding: 20px; background: #f8fafc; border-radius: 12px; border: 2px solid #e2e8f0;">
                                <h4 style="margin: 0 0 15px 0; color: #1e293b; font-size: 1.1rem;">üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–∞–±–ª–∏—Ü—ã</h4>
                                <div id="table-preview-{{ loop.index0 }}" class="table-preview" style="overflow-x: auto; border: 1px solid #d1d5db; border-radius: 8px; background: white;">
                                    <table class="content-table" style="width: 100%; border-collapse: collapse; margin: 0;">
                                        <thead>
                                            <tr style="background: #f1f5f9;">
                                                <th style="padding: 12px; border: 1px solid #d1d5db; text-align: left; font-weight: 600; color: #374151;">–ó–∞–≥–æ–ª–æ–≤–æ–∫ 1</th>
                                                <th style="padding: 12px; border: 1px solid #d1d5db; text-align: left; font-weight: 600; color: #374151;">–ó–∞–≥–æ–ª–æ–≤–æ–∫ 2</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td style="padding: 12px; border: 1px solid #d1d5db; color: #6b7280;">–Ø—á–µ–π–∫–∞ 1</td>
                                                <td style="padding: 12px; border: 1px solid #d1d5db; color: #6b7280;">–Ø—á–µ–π–∫–∞ 2</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <p style="margin: 10px 0 0 0; font-size: 0.9rem; color: #6b7280; text-align: center;">
                                    üí° –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
                                </p>
                            </div>
                        </div>

                        <!-- –°–ø–∏—Å–æ–∫ -->
                        <div class="list-content" style="display: none;">
                            <h4>–≠–ª–µ–º–µ–Ω—Ç—ã —Å–ø–∏—Å–∫–∞</h4>
                            <div id="list-items-{{ loop.index0 }}">
                                {% for item in block.list_items %}
                                <div style="display: flex; gap: 10px; margin-bottom: 10px; align-items: center;">
                                    <input type="text" name="content_blocks-{{ loop.index0 }}-list_items-{{ loop.index0 }}" value="{{ item.data if item.data else '' }}" placeholder="–≠–ª–µ–º–µ–Ω—Ç —Å–ø–∏—Å–∫–∞" style="flex: 1; padding: 8px; border-radius: 8px; border: 1px solid #e5e7eb;">
                                    <button type="button" onclick="removeListItem(this)" class="btn btn-danger btn-sm">üóëÔ∏è</button>
                                </div>
                                {% endfor %}
                            </div>
                            <button type="button" onclick="addListItem({{ loop.index0 }})" class="btn btn-success btn-sm">–î–æ–±–∞–≤–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç</button>
                        </div>

                        <!-- –î–æ–∫—É–º–µ–Ω—Ç—ã -->
                        <div class="documents-content" style="display: none;">
                            <h4>–î–æ–∫—É–º–µ–Ω—Ç—ã</h4>
                            <div id="documents-{{ loop.index0 }}">
                                {% for doc in block.documents %}
                                <div style="display: flex; gap: 10px; margin-bottom: 10px; align-items: center;">
                                    <input type="text" name="content_blocks-{{ loop.index0 }}-documents-{{ loop.index0 }}-name" value="{{ doc.name.data if doc.name.data else '' }}" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞" style="flex: 1; padding: 8px; border-radius: 8px; border: 1px solid #e5e7eb;">
                                    <input type="text" name="content_blocks-{{ loop.index0 }}-documents-{{ loop.index0 }}-url" value="{{ doc.url.data if doc.url.data else '' }}" placeholder="URL –¥–æ–∫—É–º–µ–Ω—Ç–∞" style="flex: 1; padding: 8px; border-radius: 8px; border: 1px solid #e5e7eb;">
                                    <button type="button" onclick="removeDocument(this)" class="btn btn-danger btn-sm">üóëÔ∏è</button>
                                </div>
                                {% endfor %}
                            </div>
                            <button type="button" onclick="addDocument({{ loop.index0 }})" class="btn btn-success btn-sm">‚ûï –î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç</button>
                            
                            <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ -->
                            <div class="file-upload-section" style="margin-top: 20px; padding: 15px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
                                <h5 style="margin: 0 0 10px 0; color: #374151; font-size: 0.9rem;">üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã</h5>
                                <input type="file" name="block_documents_{{ loop.index0 }}" multiple accept=".pdf,.doc,.docx,.txt" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 6px; background: white;">
                                <p style="margin: 5px 0 0 0; font-size: 0.8rem; color: #6b7280;">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: PDF, DOC, DOCX, TXT</p>
                            </div>
                        </div>

                        <!-- –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ -->
                        <div class="photos-content" style="display: none;">
                            <h4>–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</h4>
                            <div id="photos-{{ loop.index0 }}">
                                {% for photo in block.photos %}
                                <div style="display: flex; gap: 10px; margin-bottom: 10px; align-items: center;">
                                    <input type="text" name="content_blocks-{{ loop.index0 }}-photos-{{ loop.index0 }}-url" value="{{ photo.url.data if photo.url.data else '' }}" placeholder="URL —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏" style="flex: 1; padding: 8px; border-radius: 8px; border: 1px solid #e5e7eb;">
                                    <input type="text" name="content_blocks-{{ loop.index0 }}-photos-{{ loop.index0 }}-alt" value="{{ photo.alt.data if photo.alt.data else '' }}" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏" style="flex: 1; padding: 8px; border-radius: 8px; border: 1px solid #e5e7eb;">
                                    <button type="button" onclick="removePhoto(this)" class="btn btn-danger btn-sm">üóëÔ∏è</button>
                                </div>
                                {% endfor %}
                            </div>
                            <button type="button" onclick="addPhoto({{ loop.index0 }})" class="btn btn-success btn-sm">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é</button>
                            
                            <!-- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π -->
                            <div class="file-upload-section" style="margin-top: 20px; padding: 15px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
                                <h5 style="margin: 0 0 10px 0; color: #374151; font-size: 0.9rem;">üì∏ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</h5>
                                <input type="file" name="block_photos_{{ loop.index0 }}" multiple accept=".jpg,.jpeg,.png,.gif" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 6px; background: white;">
                                <p style="margin: 5px 0 0 0; font-size: 0.8rem; color: #6b7280;">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: JPG, JPEG, PNG, GIF</p>
                            </div>
                        </div>

                        <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –ª—é–¥–µ–π -->
                        <div class="persons-content" style="display: none;">
                            <h4>–ö–∞—Ä—Ç–æ—á–∫–∏ –ª—é–¥–µ–π</h4>
                            <div id="persons-{{ loop.index0 }}">
                                {% for person in block.persons %}
                                <div style="border: 1px solid #d1d5db; border-radius: 8px; padding: 15px; margin-bottom: 15px; background: white;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                        <h5 style="margin: 0;">–ö–∞—Ä—Ç–æ—á–∫–∞ {{ loop.index }}</h5>
                                        <button type="button" onclick="removePerson(this)" class="btn btn-danger btn-xs">üóëÔ∏è</button>
                                    </div>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                                        <input type="text" name="content_blocks-{{ loop.index0 }}-persons-{{ loop.index0 }}-name" value="{{ person.name.data if person.name.data else '' }}" placeholder="–§–ò–û" style="padding: 8px; border-radius: 8px; border: 1px solid #e5e7eb;">
                                        <input type="text" name="content_blocks-{{ loop.index0 }}-persons-{{ loop.index0 }}-position" value="{{ person.position.data if person.position.data else '' }}" placeholder="–î–æ–ª–∂–Ω–æ—Å—Ç—å" style="padding: 8px; border-radius: 8px; border: 1px solid #e5e7eb;">
                                        <input type="text" name="content_blocks-{{ loop.index0 }}-persons-{{ loop.index0 }}-photo" value="{{ person.photo.data if person.photo.data else '' }}" placeholder="URL —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏" style="padding: 8px; border-radius: 8px; border: 1px solid #e5e7eb;">
                                        <input type="text" name="content_blocks-{{ loop.index0 }}-persons-{{ loop.index0 }}-email" value="{{ person.email.data if person.email.data else '' }}" placeholder="Email" style="padding: 8px; border-radius: 8px; border: 1px solid #e5e7eb;">
                                        <input type="text" name="content_blocks-{{ loop.index0 }}-persons-{{ loop.index0 }}-phone" value="{{ person.phone.data if person.phone.data else '' }}" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" style="padding: 8px; border-radius: 8px; border: 1px solid #e5e7eb;">
                                        <input type="text" name="content_blocks-{{ loop.index0 }}-persons-{{ loop.index0 }}-education" value="{{ person.education.data if person.education.data else '' }}" placeholder="–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ" style="padding: 8px; border-radius: 8px; border: 1px solid #e5e7eb;">
                                        <input type="text" name="content_blocks-{{ loop.index0 }}-persons-{{ loop.index0 }}-experience" value="{{ person.experience.data if person.experience.data else '' }}" placeholder="–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã" style="padding: 8px; border-radius: 8px; border: 1px solid #e5e7eb;">
                                    </div>
                                    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏ -->
                                    <div style="margin-bottom: 10px; padding: 10px; background: #f8fafc; border-radius: 6px; border: 1px solid #e2e8f0;">
                                        <label style="display: block; margin-bottom: 5px; font-size: 0.9rem; color: #374151; font-weight: 500;">üì∏ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è:</label>
                                        <input type="file" name="person_photo_file_{{ loop.index0 }}_{{ loop.index0 }}" accept=".jpg,.jpeg,.png,.gif" style="width: 100%; padding: 6px; border: 1px solid #d1d5db; border-radius: 4px; background: white;">
                                        <p style="margin: 3px 0 0 0; font-size: 0.75rem; color: #6b7280;">–ò–ª–∏ —É–∫–∞–∂–∏—Ç–µ URL –≤—ã—à–µ</p>
                                    </div>
                                    <textarea name="content_blocks-{{ loop.index0 }}-persons-{{ loop.index0 }}-bio" placeholder="–ë–∏–æ–≥—Ä–∞—Ñ–∏—è" style="width: 100%; padding: 8px; border-radius: 8px; border: 1px solid #e5e7eb; resize: vertical;" rows="3">{{ person.bio.data if person.bio.data else '' }}</textarea>
                                </div>
                                {% endfor %}
                            </div>
                            <button type="button" onclick="addPerson({{ loop.index0 }})" class="btn btn-success btn-sm">–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É</button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            <button type="button" onclick="addContentBlock()" class="btn btn-success" style="font-size: 16px;">‚ûï –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</button>
        </div>

        <!-- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ -->
        <div class="file-upload-section">
            <h2>üìÅ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤</h2>
            <div class="form-group">
                {{ form.new_documents.label(class="form-label") }}
                {{ form.new_documents(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.new_photos.label(class="form-label") }}
                {{ form.new_photos(class="form-control") }}
            </div>
        </div>

        <div class="submit-section">
            {{ form.submit(class="btn btn-success", style="font-size: 16px; padding: 12px 30px;") }}
            <button type="button" onclick="cleanHtmlData()" class="btn btn-warning" style="font-size: 16px; padding: 12px 30px; margin-left: 10px;">üßπ –û—á–∏—Å—Ç–∏—Ç—å HTML-—Ç–µ–≥–∏</button>
        </div>
    </form>
</div>

<script>
let blockCount = {{ form.content_blocks.data | length if form.content_blocks.data else 0 }};

function addContentBlock() {
    const container = document.getElementById('content-blocks-container');
    const blockDiv = document.createElement('div');
    blockDiv.className = 'content-block';
    blockDiv.style.cssText = 'border: 1px solid #e5e7eb; border-radius: 8px; padding: 20px; margin-bottom: 20px; background: #f9fafb;';
    
    blockDiv.innerHTML = `
        <div class="content-block-header">
            <h3 class="content-block-title">üì¶ –ë–ª–æ–∫ ${blockCount + 1}</h3>
            <button type="button" onclick="removeContentBlock(this)" class="btn btn-danger btn-sm">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –±–ª–æ–∫</button>
        </div>
        
        <div class="block-type-selector">
            <label class="form-label">–¢–∏–ø –±–ª–æ–∫–∞</label>
            <select name="content_blocks-${blockCount}-block_type" class="form-control" onchange="toggleBlockContent(this)">
                <option value="text">–¢–µ–∫—Å—Ç</option>
                <option value="table">–¢–∞–±–ª–∏—Ü–∞</option>
                <option value="list">–°–ø–∏—Å–æ–∫</option>
                <option value="documents">–î–æ–∫—É–º–µ–Ω—Ç—ã</option>
                <option value="photos">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</option>
                <option value="person">–ö–∞—Ä—Ç–æ—á–∫–∞ —á–µ–ª–æ–≤–µ–∫–∞</option>
            </select>
        </div>
        
        <div class="form-group">
            <label class="form-label">–ó–∞–≥–æ–ª–æ–≤–æ–∫ –±–ª–æ–∫–∞</label>
            <input type="text" name="content_blocks-${blockCount}-title" class="form-control">
        </div>
        
        <div class="form-group">
            <label class="form-label">–°–æ–¥–µ—Ä–∂–∏–º–æ–µ</label>
            <textarea name="content_blocks-${blockCount}-content" class="form-control" rows="3"></textarea>
        </div>

        <div class="block-content" data-block-type="text">
            <div class="table-content table-editor" style="display: none;">
                <h4>–ó–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã</h4>
                <div id="table-headers-${blockCount}"></div>
                <button type="button" onclick="addTableHeader(${blockCount})" class="btn btn-success btn-sm" style="margin-bottom: 15px;">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫</button>
                
                <h4>–°—Ç—Ä–æ–∫–∏ —Ç–∞–±–ª–∏—Ü—ã</h4>
                <div id="table-rows-${blockCount}"></div>
                <button type="button" onclick="addTableRow(${blockCount})" class="btn btn-success btn-sm" style="margin-bottom: 20px;">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É</button>
                
                <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–∞–±–ª–∏—Ü—ã -->
                <div class="table-preview-section" style="margin-top: 25px; padding: 20px; background: #f8fafc; border-radius: 12px; border: 2px solid #e2e8f0;">
                    <h4 style="margin: 0 0 15px 0; color: #1e293b; font-size: 1.1rem;">üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–∞–±–ª–∏—Ü—ã</h4>
                    <div id="table-preview-${blockCount}" class="table-preview" style="overflow-x: auto; border: 1px solid #d1d5db; border-radius: 8px; background: white;">
                        <table class="content-table" style="width: 100%; border-collapse: collapse; margin: 0;">
                            <thead>
                                <tr style="background: #f1f5f9;">
                                    <th style="padding: 12px; border: 1px solid #d1d5db; text-align: left; font-weight: 600; color: #374151;">–ó–∞–≥–æ–ª–æ–≤–æ–∫ 1</th>
                                    <th style="padding: 12px; border: 1px solid #d1d5db; text-align: left; font-weight: 600; color: #374151;">–ó–∞–≥–æ–ª–æ–≤–æ–∫ 2</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 12px; border: 1px solid #d1d5db; color: #6b7280;">–Ø—á–µ–π–∫–∞ 1</td>
                                    <td style="padding: 12px; border: 1px solid #d1d5db; color: #6b7280;">–Ø—á–µ–π–∫–∞ 2</td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px; border: 1px solid #d1d5db; color: #6b7280;">–Ø—á–µ–π–∫–∞ 3</td>
                                    <td style="padding: 12px; border: 1px solid #d1d5db; color: #6b7280;">–Ø—á–µ–π–∫–∞ 4</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <p style="margin: 10px 0 0 0; font-size: 0.9rem; color: #6b7280; text-align: center;">
                        üí° –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
                    </p>
                </div>
            </div>
            
            <div class="list-content list-editor" style="display: none;">
                <h4>–≠–ª–µ–º–µ–Ω—Ç—ã —Å–ø–∏—Å–∫–∞</h4>
                <div id="list-items-${blockCount}"></div>
                <button type="button" onclick="addListItem(${blockCount})" class="btn btn-success btn-sm">‚ûï –î–æ–±–∞–≤–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç</button>
            </div>
            
            <div class="documents-content documents-editor" style="display: none;">
                <h4>–î–æ–∫—É–º–µ–Ω—Ç—ã</h4>
                <div id="documents-${blockCount}"></div>
                <button type="button" onclick="addDocument(${blockCount})" class="btn btn-success btn-sm">‚ûï –î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç</button>
                
                <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ -->
                <div class="file-upload-section" style="margin-top: 20px; padding: 15px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
                    <h5 style="margin: 0 0 10px 0; color: #374151; font-size: 0.9rem;">üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã</h5>
                    <input type="file" name="block_documents_${blockCount}" multiple accept=".pdf,.doc,.docx,.txt" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 6px; background: white;">
                    <p style="margin: 5px 0 0 0; font-size: 0.8rem; color: #6b7280;">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: PDF, DOC, DOCX, TXT</p>
                </div>
            </div>
            
            <div class="photos-content photos-editor" style="display: none;">
                <h4>–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</h4>
                <div id="photos-${blockCount}"></div>
                <button type="button" onclick="addPhoto(${blockCount})" class="btn btn-success btn-sm">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é</button>
                
                <!-- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π -->
                <div class="file-upload-section" style="margin-top: 20px; padding: 15px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
                    <h5 style="margin: 0 0 10px 0; color: #374151; font-size: 0.9rem;">üì∏ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</h5>
                    <input type="file" name="block_photos_${blockCount}" multiple accept=".jpg,.jpeg,.png,.gif" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 6px; background: white;">
                    <p style="margin: 5px 0 0 0; font-size: 0.8rem; color: #6b7280;">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: JPG, JPEG, PNG, GIF</p>
                </div>
            </div>
            
            <div class="persons-content persons-editor" style="display: none;">
                <h4>–ö–∞—Ä—Ç–æ—á–∫–∏ –ª—é–¥–µ–π</h4>
                <div id="persons-${blockCount}"></div>
                <button type="button" onclick="addPerson(${blockCount})" class="btn btn-success btn-sm">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É</button>
            </div>
        </div>
    `;
    
    container.appendChild(blockDiv);
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –Ω–æ–≤–æ–≥–æ —Å–µ–ª–µ–∫—Ç–∞
    const newSelect = blockDiv.querySelector('select[name*="block_type"]');
    if (newSelect) {
        newSelect.addEventListener('change', function() {
            toggleBlockContent(this);
        });
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç
        newSelect.value = 'text';
        toggleBlockContent(newSelect);
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –¥–ª—è –Ω–æ–≤–æ–≥–æ –±–ª–æ–∫–∞
    updateTablePreview(blockCount);
    
    blockCount++;
}

function removeContentBlock(button) {
    button.closest('.content-block').remove();
}

function toggleBlockContent(select) {
    const blockContent = select.closest('.content-block').querySelector('.block-content');
    const blockType = select.value;
    
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ç–∏–ø—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    const contentTypes = ['.table-content', '.list-content', '.documents-content', '.photos-content', '.persons-content'];
    contentTypes.forEach(selector => {
        const elements = blockContent.querySelectorAll(selector);
        elements.forEach(el => {
            el.style.display = 'none';
        });
    });
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π —Ç–∏–ø
    let targetSelector = '';
    if (blockType === 'table') {
        targetSelector = '.table-content';
    } else if (blockType === 'list') {
        targetSelector = '.list-content';
    } else if (blockType === 'documents') {
        targetSelector = '.documents-content';
    } else if (blockType === 'photos') {
        targetSelector = '.photos-content';
    } else if (blockType === 'person') {
        targetSelector = '.persons-content';
    }
    
    if (targetSelector) {
        const targetElement = blockContent.querySelector(targetSelector);
        if (targetElement) {
            targetElement.style.display = 'block';
        }
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º data-block-type –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
    if (blockContent) {
        blockContent.setAttribute('data-block-type', blockType);
    }
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏
function addTableHeader(blockIndex) {
    const container = document.getElementById(`table-headers-${blockIndex}`);
    const headerIndex = container.children.length;
    const div = document.createElement('div');
    div.className = 'item-row';
    div.innerHTML = `
        <input type="text" name="content_blocks-${blockIndex}-table_headers-${headerIndex}" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–æ–ª–±—Ü–∞" class="form-control" oninput="updateTablePreview(${blockIndex})">
        <button type="button" onclick="removeTableHeader(this)" class="btn btn-danger btn-sm">üóëÔ∏è</button>
    `;
    container.appendChild(div);
    
    // –î–æ–±–∞–≤–ª—è–µ–º —è—á–µ–π–∫—É –≤ –∫–∞–∂–¥—É—é —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å—Ç—Ä–æ–∫—É
    const rowsContainer = document.getElementById(`table-rows-${blockIndex}`);
    if (rowsContainer) {
        rowsContainer.querySelectorAll('.item-row').forEach(row => {
            const cellsContainer = row.querySelector('div[style*="flex: 1"]');
            if (cellsContainer) {
                const cellIndex = cellsContainer.children.length;
                const newCell = document.createElement('input');
                newCell.type = 'text';
                newCell.name = `content_blocks-${blockIndex}-table_rows-${Array.from(rowsContainer.children).indexOf(row)}-cells-${cellIndex}`;
                newCell.placeholder = `–Ø—á–µ–π–∫–∞ ${cellIndex + 1}`;
                newCell.className = 'form-control';
                newCell.oninput = () => updateTablePreview(blockIndex);
                cellsContainer.appendChild(newCell);
            }
        });
    }
    
    updateTablePreview(blockIndex);
}

function removeTableHeader(button) {
    const headerRow = button.parentElement;
    const headerIndex = Array.from(headerRow.parentElement.children).indexOf(headerRow);
    
    // –£–¥–∞–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
    headerRow.remove();
    
    // –£–¥–∞–ª—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —è—á–µ–π–∫—É –∏–∑ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏
    const blockIndex = getBlockIndexFromElement(button);
    if (blockIndex !== -1) {
        const rowsContainer = document.getElementById(`table-rows-${blockIndex}`);
        if (rowsContainer) {
            rowsContainer.querySelectorAll('.item-row').forEach(row => {
                const cellsContainer = row.querySelector('div[style*="flex: 1"]');
                if (cellsContainer && cellsContainer.children[headerIndex]) {
                    cellsContainer.children[headerIndex].remove();
                }
            });
        }
        updateTablePreview(blockIndex);
    }
}

function addTableRow(blockIndex) {
    const container = document.getElementById(`table-rows-${blockIndex}`);
    const rowIndex = container.children.length;
    
    // –ü–æ–ª—É—á–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —è—á–µ–µ–∫
    const headersContainer = document.getElementById(`table-headers-${blockIndex}`);
    const headerCount = headersContainer ? headersContainer.children.length : 1;
    
    // –°–æ–∑–¥–∞–µ–º —è—á–µ–π–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–ª–æ–Ω–∫–∏
    let cellsHtml = '';
    for (let i = 0; i < headerCount; i++) {
        cellsHtml += `<input type="text" name="content_blocks-${blockIndex}-table_rows-${rowIndex}-cells-${i}" placeholder="–Ø—á–µ–π–∫–∞ ${i + 1}" class="form-control" oninput="updateTablePreview(${blockIndex})">`;
    }
    
    const div = document.createElement('div');
    div.className = 'item-row';
    div.innerHTML = `
        <div style="flex: 1; display: flex; gap: 5px;">
            ${cellsHtml}
        </div>
        <button type="button" onclick="removeTableRow(this)" class="btn btn-danger btn-sm">üóëÔ∏è</button>
    `;
    container.appendChild(div);
    updateTablePreview(blockIndex);
}

function removeTableRow(button) {
    button.parentElement.remove();
    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è
    const blockIndex = getBlockIndexFromElement(button);
    if (blockIndex !== -1) {
        updateTablePreview(blockIndex);
    }
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å–ø–∏—Å–∫–∞–º–∏
function addListItem(blockIndex) {
    const container = document.getElementById(`list-items-${blockIndex}`);
    const itemIndex = container.children.length;
    const div = document.createElement('div');
    div.className = 'item-row';
    div.innerHTML = `
        <input type="text" name="content_blocks-${blockIndex}-list_items-${itemIndex}" placeholder="–≠–ª–µ–º–µ–Ω—Ç —Å–ø–∏—Å–∫–∞" class="form-control">
        <button type="button" onclick="removeListItem(this)" class="btn btn-danger btn-sm">üóëÔ∏è</button>
    `;
    container.appendChild(div);
}

function removeListItem(button) {
    button.parentElement.remove();
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏
function addDocument(blockIndex) {
    const container = document.getElementById(`documents-${blockIndex}`);
    const docIndex = container.children.length;
    const div = document.createElement('div');
    div.className = 'item-row';
    div.innerHTML = `
        <input type="text" name="content_blocks-${blockIndex}-documents-${docIndex}-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞" class="form-control">
        <input type="text" name="content_blocks-${blockIndex}-documents-${docIndex}-url" placeholder="URL –¥–æ–∫—É–º–µ–Ω—Ç–∞" class="form-control">
        <button type="button" onclick="removeDocument(this)" class="btn btn-danger btn-sm">üóëÔ∏è</button>
    `;
    container.appendChild(div);
}

function removeDocument(button) {
    button.parentElement.remove();
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏
function addPhoto(blockIndex) {
    const container = document.getElementById(`photos-${blockIndex}`);
    const photoIndex = container.children.length;
    const div = document.createElement('div');
    div.className = 'item-row';
    div.innerHTML = `
        <input type="text" name="content_blocks-${blockIndex}-photos-${photoIndex}-url" placeholder="URL —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏" class="form-control">
        <input type="text" name="content_blocks-${blockIndex}-photos-${photoIndex}-alt" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏" class="form-control">
        <button type="button" onclick="removePhoto(this)" class="btn btn-danger btn-sm">üóëÔ∏è</button>
    `;
    container.appendChild(div);
}

function removePhoto(button) {
    button.parentElement.remove();
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ –ª—é–¥–µ–π
function addPerson(blockIndex) {
    const container = document.getElementById(`persons-${blockIndex}`);
    const personIndex = container.children.length;
    const div = document.createElement('div');
    div.className = 'person-card';
    div.innerHTML = `
        <div class="person-card-header">
            <h5 class="person-card-title">–ö–∞—Ä—Ç–æ—á–∫–∞ ${container.children.length + 1}</h5>
            <button type="button" onclick="removePerson(this)" class="btn btn-danger btn-xs">üóëÔ∏è</button>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
            <input type="text" name="content_blocks-${blockIndex}-persons-${personIndex}-name" placeholder="–§–ò–û" class="form-control">
            <input type="text" name="content_blocks-${blockIndex}-persons-${personIndex}-position" placeholder="–î–æ–ª–∂–Ω–æ—Å—Ç—å" class="form-control">
            <input type="text" name="content_blocks-${blockIndex}-persons-${personIndex}-photo" placeholder="URL —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏" class="form-control">
            <input type="text" name="content_blocks-${blockIndex}-persons-${personIndex}-email" placeholder="Email" class="form-control">
            <input type="text" name="content_blocks-${blockIndex}-persons-${personIndex}-phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" class="form-control">
            <input type="text" name="content_blocks-${blockIndex}-persons-${personIndex}-education" placeholder="–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ" class="form-control">
            <input type="text" name="content_blocks-${blockIndex}-persons-${personIndex}-experience" placeholder="–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã" class="form-control">
        </div>
        <!-- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏ -->
        <div style="margin-bottom: 10px; padding: 10px; background: #f8fafc; border-radius: 6px; border: 1px solid #e2e8f0;">
            <label style="display: block; margin-bottom: 5px; font-size: 0.9rem; color: #374151; font-weight: 500;">üì∏ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è:</label>
            <input type="file" name="person_photo_file_${blockIndex}_${personIndex}" accept=".jpg,.jpeg,.png,.gif" style="width: 100%; padding: 6px; border: 1px solid #d1d5db; border-radius: 4px; background: white;">
            <p style="margin: 3px 0 0 0; font-size: 0.75rem; color: #6b7280;">–ò–ª–∏ —É–∫–∞–∂–∏—Ç–µ URL –≤—ã—à–µ</p>
        </div>
        <textarea name="content_blocks-${blockIndex}-persons-${personIndex}-bio" placeholder="–ë–∏–æ–≥—Ä–∞—Ñ–∏—è" class="form-control" rows="3"></textarea>
    `;
    container.appendChild(div);
}

function removePerson(button) {
    button.closest('div').remove();
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞ –±–ª–æ–∫–∞ –∏–∑ —ç–ª–µ–º–µ–Ω—Ç–∞
function getBlockIndexFromElement(element) {
    const contentBlock = element.closest('.content-block');
    if (!contentBlock) return -1;
    
    // –ò—â–µ–º –∏–Ω–¥–µ–∫—Å –≤ ID —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    const headersContainer = contentBlock.querySelector('[id^="table-headers-"]');
    if (headersContainer) {
        const id = headersContainer.id;
        const match = id.match(/table-headers-(\d+)/);
        if (match) return parseInt(match[1]);
    }
    
    const rowsContainer = contentBlock.querySelector('[id^="table-rows-"]');
    if (rowsContainer) {
        const id = rowsContainer.id;
        const match = id.match(/table-rows-(\d+)/);
        if (match) return parseInt(match[1]);
    }
    
    return -1;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã
function updateTablePreview(blockIndex) {
    const previewContainer = document.getElementById(`table-preview-${blockIndex}`);
    if (!previewContainer) return;
    
    // –ü–æ–ª—É—á–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏
    const headersContainer = document.getElementById(`table-headers-${blockIndex}`);
    const headerInputs = headersContainer ? headersContainer.querySelectorAll('input[type="text"]') : [];
    const headers = Array.from(headerInputs).map(input => input.value || '–ó–∞–≥–æ–ª–æ–≤–æ–∫');
    
    // –ü–æ–ª—É—á–∞–µ–º —Å—Ç—Ä–æ–∫–∏
    const rowsContainer = document.getElementById(`table-rows-${blockIndex}`);
    const rowInputs = rowsContainer ? rowsContainer.querySelectorAll('input[type="text"]') : [];
    const rows = [];
    
    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —è—á–µ–π–∫–∏ –ø–æ —Å—Ç—Ä–æ–∫–∞–º (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ –≤ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–µ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —è—á–µ–µ–∫)
    if (rowInputs.length > 0) {
        const cellsPerRow = headers.length || 1;
        for (let i = 0; i < rowInputs.length; i += cellsPerRow) {
            const row = [];
            for (let j = 0; j < cellsPerRow; j++) {
                const input = rowInputs[i + j];
                row.push(input ? (input.value || `–Ø—á–µ–π–∫–∞ ${j + 1}`) : `–Ø—á–µ–π–∫–∞ ${j + 1}`);
            }
            rows.push(row);
        }
    }
    
    // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–º–µ—Ä
    if (headers.length === 0 && rows.length === 0) {
        headers.push('–ó–∞–≥–æ–ª–æ–≤–æ–∫ 1', '–ó–∞–≥–æ–ª–æ–≤–æ–∫ 2');
        rows.push(['–Ø—á–µ–π–∫–∞ 1', '–Ø—á–µ–π–∫–∞ 2']);
    }
    
    // –°–æ–∑–¥–∞–µ–º HTML —Ç–∞–±–ª–∏—Ü—ã
    let tableHTML = '<table class="content-table" style="width: 100%; border-collapse: collapse; margin: 0;">';
    
    // –ó–∞–≥–æ–ª–æ–≤–∫–∏
    if (headers.length > 0) {
        tableHTML += '<thead><tr style="background: #f1f5f9;">';
        headers.forEach(header => {
            tableHTML += `<th style="padding: 12px; border: 1px solid #d1d5db; text-align: left; font-weight: 600; color: #374151;">${header}</th>`;
        });
        tableHTML += '</tr></thead>';
    }
    
    // –°—Ç—Ä–æ–∫–∏
    if (rows.length > 0) {
        tableHTML += '<tbody>';
        rows.forEach(row => {
            tableHTML += '<tr>';
            row.forEach(cell => {
                tableHTML += `<td style="padding: 12px; border: 1px solid #d1d5db; color: #6b7280;">${cell}</td>`;
            });
            tableHTML += '</tr>';
        });
        tableHTML += '</tbody>';
    }
    
    tableHTML += '</table>';
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
    previewContainer.innerHTML = tableHTML;
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –±–ª–æ–∫–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –±–ª–æ–∫–æ–≤
    document.querySelectorAll('.content-block').forEach(block => {
        const select = block.querySelector('select[name*="block_type"]');
        if (select) {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –µ—Å–ª–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ
            if (!select.value) {
                select.value = 'text';
            }
            toggleBlockContent(select);
        }
    });
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –≤—Å–µ—Ö —Å–µ–ª–µ–∫—Ç–æ–≤ —Ç–∏–ø–æ–≤ –±–ª–æ–∫–æ–≤
    document.querySelectorAll('select[name*="block_type"]').forEach(select => {
        select.addEventListener('change', function() {
            console.log('DEBUG: –ò–∑–º–µ–Ω–µ–Ω —Ç–∏–ø –±–ª–æ–∫–∞ –Ω–∞:', this.value, '–¥–ª—è –ø–æ–ª—è:', this.name);
            toggleBlockContent(this);
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–∏–ø –±–ª–æ–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        console.log('DEBUG: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∏–ø–∞ –±–ª–æ–∫–∞:', select.value, '–¥–ª—è –ø–æ–ª—è:', select.name);
        toggleBlockContent(select);
    });
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä—ã –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
    document.querySelectorAll('[id^="table-preview-"]').forEach(preview => {
        const match = preview.id.match(/table-preview-(\d+)/);
        if (match) {
            updateTablePreview(parseInt(match[1]));
        }
    });
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã
    document.querySelector('form').addEventListener('submit', function(e) {
        console.log('DEBUG: –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã');
        const blockTypes = document.querySelectorAll('select[name*="block_type"]');
        blockTypes.forEach((select, index) => {
            console.log(`DEBUG: –ë–ª–æ–∫ ${index}: —Ç–∏–ø = ${select.value}, –∏–º—è –ø–æ–ª—è = ${select.name}`);
        });
    });
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ HTML-—Ç–µ–≥–æ–≤
function cleanHtmlData() {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å HTML-—Ç–µ–≥–∏ –∏–∑ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
        // –°–æ–∑–¥–∞–µ–º —Ñ–æ—Ä–º—É –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ POST-–∑–∞–ø—Ä–æ—Å–∞
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/info/clean_html_data';
        
        // –î–æ–±–∞–≤–ª—è–µ–º CSRF —Ç–æ–∫–µ–Ω
        const csrfToken = document.querySelector('input[name="csrf_token"]');
        if (csrfToken) {
            const csrfInput = document.createElement('input');
            csrfInput.type = 'hidden';
            csrfInput.name = 'csrf_token';
            csrfInput.value = csrfToken.value;
            form.appendChild(csrfInput);
        }
        
        document.body.appendChild(form);
        form.submit();
    }
});
</script>

<!-- –°—Ç–∏–ª–∏ —É–∂–µ –≤–∫–ª—é—á–µ–Ω—ã –≤ base.html -->
{% endblock %}