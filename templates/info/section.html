{% extends "base.html" %}

{% macro render_field_content(field_name, field_label, field_value, section_endpoint='main', show_label=true) %}
{% if show_label %}
<strong>{{ field_label }}:</strong>
{% endif %}
{% if field_value is iterable and field_value is not string and field_value is not mapping %}
{# –ú–∞—Å—Å–∏–≤ file_with_name –æ–±—ä–µ–∫—Ç–æ–≤ #}
<div class="files-list">
    {% for file_obj in field_value %}
    {% if file_obj is mapping and file_obj.url %}
    {% set display_name = file_obj.displayName or file_obj.originalName or file_obj.filename %}
    {% set filename = file_obj.url.split('/')[-1] %}
    <div class="file-item">
        <a href="{{ filename | info_file_url(section_endpoint) }}" download class="download-link">üìÑ {{ display_name
            }}</a>
    </div>
    {% endif %}
    {% endfor %}
</div>
{% elif field_value is mapping %}
{# file_with_name –æ–±—ä–µ–∫—Ç: {filename, originalName, url, displayName} #}
{% if field_value.url %}
{% set display_name = field_value.displayName or field_value.originalName or field_value.filename %}
{% set filename = field_value.url.split('/')[-1] %}
<span><a href="{{ filename | info_file_url(section_endpoint) }}" download class="download-link">üìÑ –°–∫–∞—á–∞—Ç—å {{
        display_name }}</a></span>
{% else %}
<span>{{ field_value.filename or field_value.displayName or '–§–∞–π–ª' }}</span>
{% endif %}
{% elif field_value is string %}
{# –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä–æ–∫–∏ —Å –∑–∞–ø—è—Ç—ã–º–∏ (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤) #}
{% if ',' in field_value %}
{# –°—Ç—Ä–æ–∫–∞ —Å –∑–∞–ø—è—Ç—ã–º–∏ - –ø—Ä–æ–≤–µ—Ä—è–µ–º, —ç—Ç–æ —Ñ–∞–π–ª—ã –∏–ª–∏ –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç #}
{# –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å–ª–∏ –≤ —Å—Ç—Ä–æ–∫–µ –µ—Å—Ç—å –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∫ —Ñ–∞–π–ª—ã #}
{% set has_file_urls = '/info/download_file/' in field_value or '/download_file/' in field_value or '/static/uploads/'
in field_value %}
{% set files = field_value.split(',') %}

{% if has_file_urls %}
<!-- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤, —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—è—Ç—ã–º–∏ -->
<div class="files-list">
    {% for file_url in files %}
    {% set file_url_trimmed = file_url.strip() %}
    {% if file_url_trimmed %}
    {# –ò–∑–≤–ª–µ–∫–∞–µ–º URL —á–∞—Å—Ç—å (–¥–æ |) #}
    {% set url_part = file_url_trimmed.split('|')[0].strip() if '|' in file_url_trimmed else file_url_trimmed %}
    {# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ URL –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É #}
    {% if url_part and ('/info/download_file/' in url_part or '/download_file/' in url_part or '/static/uploads/' in
    url_part) %}
    {% set filename = url_part.split('/')[-1] %}
    {% set display_name = file_url_trimmed.split('|')[-1].strip() if '|' in file_url_trimmed else filename %}
    <div class="file-item">
        <a href="{{ filename | info_file_url(section_endpoint) }}" download class="download-link">üìÑ {{ display_name
            }}</a>
    </div>
    {% elif url_part and '/' in url_part and (url_part.startswith('/') or 'download_file' in url_part) %}
    {# –†–µ–∑–µ—Ä–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è –ø—É—Ç–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å —Ñ–∞–π–ª–∞–º–∏ #}
    {% set possible_filename = url_part.split('/')[-1] %}
    {% if possible_filename and '.' in possible_filename %}
    <div class="file-item">
        <a href="{{ possible_filename | info_file_url(section_endpoint) }}" download class="download-link">üìÑ {{
            file_url_trimmed.split('|')[-1].strip() if '|' in file_url_trimmed else possible_filename }}</a>
    </div>
    {% endif %}
    {% endif %}
    {% endif %}
    {% endfor %}
</div>
{% else %}
<!-- –û–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç —Å –∑–∞–ø—è—Ç—ã–º–∏ - –Ω–æ –µ—Å–ª–∏ –µ—Å—Ç—å /info/download_file/, –≤—Å–µ —Ä–∞–≤–Ω–æ –ø—ã—Ç–∞–µ–º—Å—è –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∫–∞–∫ —Ñ–∞–π–ª—ã -->
{% set files_check = field_value.split(',') %}
{% set has_any_file_path = false %}
{% for check_url in files_check %}
{% if '/info/download_file/' in check_url or '/download_file/' in check_url %}
{% set has_any_file_path = true %}
{% endif %}
{% endfor %}
{% if has_any_file_path %}
<div class="files-list">
    {% for file_url in files_check %}
    {% set file_url_trimmed = file_url.strip() %}
    {% if file_url_trimmed and ('/info/download_file/' in file_url_trimmed or '/download_file/' in file_url_trimmed) %}
    {% set url_part = file_url_trimmed.split('|')[0].strip() if '|' in file_url_trimmed else file_url_trimmed %}
    {% set filename = url_part.split('/')[-1] %}
    {% set display_name = file_url_trimmed.split('|')[-1].strip() if '|' in file_url_trimmed else filename %}
    <div class="file-item">
        <a href="{{ filename | info_file_url(section_endpoint) }}" download class="download-link">üìÑ {{ display_name
            }}</a>
    </div>
    {% endif %}
    {% endfor %}
</div>
{% else %}
<span style="white-space: pre-line;">{{ field_value }}</span>
{% endif %}
{% endif %}
{% elif field_value.startswith('http') or field_value.startswith('/download_file/') or
field_value.startswith('/info/download_file/') or field_value.startswith('/static/uploads/') %}
{# –≠—Ç–æ —Ñ–∞–π–ª–æ–≤—ã–π URL (–æ–¥–∏–Ω–æ—á–Ω—ã–π —Ñ–∞–π–ª) #}
{% if field_name == 'official_website' %}
<span><a href="{{ field_value }}" target="_blank" class="download-link">–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–∞–π—Ç</a></span>
{% elif field_value.startswith('http') and not field_value.startswith('/download_file/') and not
field_value.startswith('/static/uploads/') %}
<span><a href="{{ field_value }}" target="_blank" class="download-link">–ü–µ—Ä–µ–π—Ç–∏ –ø–æ —Å—Å—ã–ª–∫–µ</a></span>
{% else %}
<!-- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ–¥–∏–Ω–æ—á–Ω—ã–π —Ñ–∞–π–ª -->
{% set file_url_clean = field_value.split('|')[0].strip() if '|' in field_value else field_value.strip() %}
{% set filename = file_url_clean.split('/')[-1] %}
{% set display_name = field_value.split('|')[-1].strip() if '|' in field_value else filename %}
<span><a href="{{ filename | info_file_url(section_endpoint) }}" download class="download-link">üìÑ –°–∫–∞—á–∞—Ç—å {{
        display_name }}</a></span>
{% endif %}
{% else %}
<!-- –û–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç –±–µ–∑ –∑–∞–ø—è—Ç—ã—Ö -->
<span style="white-space: pre-line;">{{ field_value }}</span>
{% endif %}
{% else %}
<span style="white-space: pre-line;">{{ field_value }}</span>
{% endif %}
{% endmacro %}

{% macro render_field(field_name, field_label, field_value, section_endpoint='main') %}
<div class="form-data-item">
    {{ render_field_content(field_name, field_label, field_value, section_endpoint) }}
</div>
{% endmacro %}

{% macro render_document_field(field_name, field_label, field_value, section_endpoint='main',
document_itemprop='document', show_label=true) %}
{# –ú–∞–∫—Ä–æ—Å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª–µ–π –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤. show_label=false ‚Äî –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å—å, –µ—Å–ª–∏ –æ–Ω–∞ —É–∂–µ –≤ –ª–µ–≤–æ–º —Å—Ç–æ–ª–±—Ü–µ —Ç–∞–±–ª–∏—Ü—ã #}
{% set field_files = [] %}
{% set field_files_filtered = [] %}
{% set has_files = False %}

{% if field_value %}
{% if field_value is iterable and field_value is not string and field_value is not mapping %}
{# –ú–∞—Å—Å–∏–≤ file_with_name –æ–±—ä–µ–∫—Ç–æ–≤ #}
{% for file_obj in field_value %}
{% if file_obj is mapping and file_obj.url %}
{% set _ = field_files.append(file_obj.url ~ '|' ~ (file_obj.displayName or file_obj.originalName or file_obj.filename))
%}
{% set has_files = True %}
{% endif %}
{% endfor %}
{% elif field_value is mapping %}
{# file_with_name –æ–±—ä–µ–∫—Ç (–æ–¥–∏–Ω–æ—á–Ω—ã–π) #}
{% if field_value.url %}
{% set _ = field_files.append(field_value.url ~ '|' ~ (field_value.displayName or field_value.originalName or
field_value.filename)) %}
{% set has_files = True %}
{% endif %}
{% elif field_value is string %}
{% if ',' in field_value %}
{% set files = field_value.split(',') %}
{% for file_url in files %}
{% set file_url = file_url.strip() %}
{% if file_url and (file_url.startswith('/download_file/') or file_url.startswith('/info/download_file/') or
file_url.startswith('/static/uploads/')) %}
{% set _ = field_files.append(file_url) %}
{% set has_files = True %}
{% endif %}
{% endfor %}
{% else %}
{% if field_value.startswith('/download_file/') or field_value.startswith('/info/download_file/') or
field_value.startswith('/static/uploads/') %}
{% set _ = field_files.append(field_value) %}
{% set has_files = True %}
{% endif %}
{% endif %}
{% endif %}

{# –§–∏–ª—å—Ç—Ä—É–µ–º —Ñ–∞–π–ª—ã - –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ #}
{% for file_url in field_files %}
{% set file_url_clean = file_url.split('|')[0] if '|' in file_url else file_url %}
{% set file_exists = file_url_clean | file_exists(section_endpoint) %}
{% if file_exists %}
{% set _ = field_files_filtered.append(file_url) %}
{% endif %}
{% endfor %}
{% endif %}

{# –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤ —Å—Ç–∏–ª–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ #}
<div class="form-data-item document-item" style="text-align:center;" role="list">
    <div class="document-icon" aria-hidden="true">üìÑ</div>
    <div class="document-info" style="margin:0 auto;">
        {% if show_label %}<div class="document-title">{{ field_label }}</div>{% endif %}
        <div class="document-link" role="list">
            {% if field_files_filtered %}
            {% if field_files_filtered|length == 1 %}
            {# –û–¥–∏–Ω–æ—á–Ω—ã–π —Ñ–∞–π–ª #}
            {% set file_url = field_files_filtered[0] %}
            {% set file_url_clean = file_url.split('|')[0] if '|' in file_url else file_url %}
            {% set filename = file_url_clean.split('/')[-1] %}
            {% set display_name = file_url.split('|')[-1] if '|' in file_url else filename %}
            <div class="file-item" role="listitem" itemprop="{{ document_itemprop }}" itemscope="itemscope"
                itemtype="https://schema.org/MediaObject"
                style="border:none; box-shadow:none; padding:6px 10px; margin:6px auto; display:inline-block;">
                <a href="{{ filename | info_file_url(section_endpoint) }}" download class="download-link"
                    itemprop="contentUrl" aria-label="–°–∫–∞—á–∞—Ç—å {{ display_name }}">
                    üìÑ –°–∫–∞—á–∞—Ç—å {{ display_name }}
                </a>
            </div>
            {% else %}
            {# –ù–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤ #}
            <div class="files-list" role="list"
                style="display:flex; flex-direction:column; align-items:center; gap:8px;">
                {% for file_url in field_files_filtered %}
                {% set file_url_clean = file_url.split('|')[0] if '|' in file_url else file_url %}
                {% set filename = file_url_clean.split('/')[-1] %}
                {% set display_name = file_url.split('|')[-1] if '|' in file_url else filename %}
                <div class="file-item" role="listitem" itemprop="{{ document_itemprop }}" itemscope="itemscope"
                    itemtype="https://schema.org/MediaObject"
                    style="border:none; box-shadow:none; padding:6px 10px; display:inline-block;">
                    <a href="{{ filename | info_file_url(section_endpoint) }}" download class="download-link"
                        itemprop="contentUrl" aria-label="–°–∫–∞—á–∞—Ç—å {{ display_name }}">
                        üìÑ {{ display_name }}
                    </a>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            {% else %}
            <div role="listitem" itemprop="{{ document_itemprop }}" itemscope="itemscope"
                itemtype="https://schema.org/MediaObject"
                style="border:none; box-shadow:none; padding:6px 10px; margin:6px auto; display:inline-block;">
                <span itemprop="contentUrl">—Ñ–∞–π–ª –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</span>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endmacro %}

{% block title %}{{ section.title }} ‚Äî –Æ–Ω–æ–Ω–∞{% endblock %}
{% block meta_description %}{{ section.title }} ‚Äî –ú–ë–û–£ –ò–¢ –ì–∏–º–Ω–∞–∑–∏—è –Æ–Ω–æ–Ω–∞. {% if section.text %}{% set text_data =
section.text | from_json %}{% if text_data and text_data.form_data %}{% if text_data.form_data.get('short_name') %}{{
text_data.form_data.short_name }}. {% endif %}{% endif %}{% endif %}–°–≤–µ–¥–µ–Ω–∏—è –æ–± –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.{% endblock
%}
{% block og_title %}{{ section.title }}{% endblock %}
{% block og_type %}website{% endblock %}

{% block content %}
{% set sveden_table_endpoints = ['main', 'structure', 'documents', 'education', 'standards', 'management', 'teachers', 'facilities', 'scholarships', 'paid-services', 'finance', 'vacancies', 'international'] %}
{% set use_new_sveden_layout = section.endpoint in sveden_table_endpoints %}
<div class="section-container{% if use_new_sveden_layout %} section-container--sveden-tables{% endif %}" itemscope="itemscope" itemtype="https://schema.org/EducationalOrganization">
    <div class="section-header">
        <h1 itemprop="name">{{ section.title }}</h1>
        {% if current_user.is_authenticated %}
        <div style="display: flex; gap: 10px;">
            <button onclick="openEditSection()" class="btn btn-primary"
                style="background: linear-gradient(135deg, #3b82f6, #1d4ed8);">
                ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
            </button>
            {% if section.url and section.url.startswith('/sidebar/') %}
            <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–¥—Ä–∞–∑–¥–µ–ª–∞ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ –º–∞—Å—Ç–µ—Ä –±–æ–∫–æ–≤–æ–≥–æ –º–µ–Ω—é -->
            {% endif %}
        </div>
        {% endif %}
    </div>

    {% if children and children|length > 0 %}
    <div class="section-children" style="margin: 24px 0; padding: 0;">
        <div
            style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; margin-top: 16px;">
            {% for child in children %}
            {% set child_href = ('/sidebar/' ~ child.endpoint) if (section.url and section.url.startswith('/sidebar/')) else (('/sveden/' ~ child.endpoint) if (is_sveden is defined and is_sveden) else ('/info/' ~ child.endpoint)) %}
            <a href="{{ child_href }}"
                style="display: flex; align-items: center; padding: 16px; background: #f8fafc; border: 1px solid #e5e7eb; border-radius: 12px; text-decoration: none; transition: all 0.2s ease; color: #2563eb;"
                onmouseover="this.style.background='#f1f5f9'; this.style.borderColor='#3b82f6'; this.style.boxShadow='0 2px 8px rgba(59, 130, 246, 0.15)';"
                onmouseout="this.style.background='#f8fafc'; this.style.borderColor='#e5e7eb'; this.style.boxShadow='none';">
                <div
                    style="width: 8px; height: 8px; background: #3b82f6; border-radius: 50%; margin-right: 12px; flex-shrink: 0;">
                </div>
                <div style="flex: 1; font-size: 15px; line-height: 1.5; font-weight: 500;">{{ child.title }}</div>
            </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}


    <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã -->
    {% if section.text %}
    {% set text_data = section.text | from_json %}
    {% if text_data and text_data.form_data %}
    {% set itemprop_map = (text_data.get('form_data') or {}).get('itemprop_mapping') or {} %}
    {% set section_headers = (text_data.get('form_data') or {}).get('section_headers') or {} %}
    {% set main_title_cfg = section_headers.get('main_title') or {} %}
    {% set founder_title_cfg = section_headers.get('founder_title') or {} %}
    {% set main_title_text = main_title_cfg.get('text') or '–°–≤–µ–¥–µ–Ω–∏—è –æ–± –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏' %}
    {% set main_title_visible = main_title_cfg.get('visible', True) %}
    {% set founder_title_text = founder_title_cfg.get('text') or '–£—á—Ä–µ–¥–∏—Ç–µ–ª–∏ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏' %}
    {% set founder_title_visible = founder_title_cfg.get('visible', True) %}
    {% set working_hours_cfg = section_headers.get('working_hours_title') or {} %}
    {% set places_cfg = section_headers.get('places_title') or {} %}
    {% set license_cfg = section_headers.get('license_title') or {} %}
    {% set accreditation_cfg = section_headers.get('accreditation_title') or {} %}
    {% set working_hours_text = working_hours_cfg.get('text') or '–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏' %}
    {% set working_hours_visible = working_hours_cfg.get('visible', True) %}
    {% set places_text = places_cfg.get('text') or '–ú–µ—Å—Ç–∞ –æ—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏' %}
    {% set places_visible = places_cfg.get('visible', True) %}
    {% set license_text = license_cfg.get('text') or '–õ–∏—Ü–µ–Ω–∑–∏—è' %}
    {% set license_visible = license_cfg.get('visible', True) %}
    {% set accreditation_text = accreditation_cfg.get('text') or '–ê–∫–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏—è' %}
    {% set accreditation_visible = accreditation_cfg.get('visible', True) %}

    <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Å–≤–µ–¥–µ–Ω–∏—è -->
    {% set main_fields = ['full_name', 'short_name', 'founding_date', 'location_address', 'contact_phone',
    'contact_email', 'official_website', 'visually_impaired_version', 'founder_name', 'founder_address', 'founder_phone', 'founder_email', 'founder_website', 'social_media'] %}
    {% set main_filled_fields = [] %}
    {% for field_name in main_fields %}
    {% if text_data.form_data.get(field_name) %}
    {% set _ = main_filled_fields.append(field_name) %}
    {% endif %}
    {% endfor %}

    {# –î–ª—è —Ä–∞–∑–¥–µ–ª–∞ main –Ω–∞ /sveden/* —Ç–µ—Å—Ç–∏—Ä—É–µ–º –≤–∞—Ä–∏–∞–Ω—Ç, –≥–¥–µ –≤—Å–µ –∞–¥—Ä–µ—Å–∞ –∏ —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã –≤–ª–æ–∂–µ–Ω—ã –≤–Ω—É—Ç—Ä—å mainInfo #}
    {# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä mainInfo –≤—Å–µ–≥–¥–∞, –¥–∞–∂–µ –µ—Å–ª–∏ –ø–æ–ª—è –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã #}
    {% if section.endpoint == 'main' and is_sveden %}
    <div class="form-data-section" itemprop="mainInfo" itemscope="itemscope"
        itemtype="https://schema.org/EducationalOrganization">
        {% if main_title_visible %}<h2>{{ main_title_text }}</h2>{% endif %}
        <table class="info-table" style="width: 100%; border-collapse: collapse; margin: 20px 0;">
            <tbody>
                {% set field_labels = {
                'full_name': '–ü–æ–ª–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏',
                'short_name': '–°–æ–∫—Ä–∞—â–µ–Ω–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏',
                'founding_date': '–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏',
                'location_address': '–ê–¥—Ä–µ—Å –º–µ—Å—Ç–æ–Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏',
                'contact_phone': '–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ —Ç–µ–ª–µ—Ñ–æ–Ω—ã –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏',
                'contact_email': '–ê–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏',
                'official_website': '–ê–¥—Ä–µ—Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞',
                'visually_impaired_version': '–í–µ—Ä—Å–∏—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞ –¥–ª—è —Å–ª–∞–±–æ–≤–∏–¥—è—â–∏—Ö',
                'founder_name': founder_title_text,
                'founder_address': '–ê–¥—Ä–µ—Å —É—á—Ä–µ–¥–∏—Ç–µ–ª—è',
                'founder_phone': '–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω —É—á—Ä–µ–¥–∏—Ç–µ–ª—è',
                'founder_email': '–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞ —É—á—Ä–µ–¥–∏—Ç–µ–ª—è',
                'founder_website': '–°–∞–π—Ç —É—á—Ä–µ–¥–∏—Ç–µ–ª—è',
                'social_media': '–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö'
                } %}

                {% for field_name in main_fields %}
                {% set field_label = field_labels.get(field_name, field_name | replace('_', ' ') | title) %}
                {% set field_value = text_data.form_data.get(field_name) %}
                {% set is_filled = field_value and field_value | trim %}
                {% if field_name == 'full_name' %}
                <tr>
                    <td
                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                        {{ field_label }}</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb;" itemprop="{{ itemprop_map.get('full_name') or 'fullName' }}">{% if is_filled %}{{
                        field_value }}{% else %}–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ{% endif %}</td>
                </tr>
                {% elif field_name == 'short_name' %}
                <tr>
                    <td
                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                        {{ field_label }}</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb;" itemprop="{{ itemprop_map.get('short_name') or 'shortName' }}">{% if is_filled %}{{
                        field_value }}{% else %}–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ{% endif %}</td>
                </tr>
                {% elif field_name == 'founding_date' %}
                <tr>
                    <td
                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                        {{ field_label }}</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb;" itemprop="{{ itemprop_map.get('founding_date') or 'regDate' }}">{% if is_filled %}{{
                        field_value }}{% else %}–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ{% endif %}</td>
                </tr>
                {% elif field_name == 'location_address' %}
                <tr>
                    <td
                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                        {{ field_label }}</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb;" itemprop="{{ itemprop_map.get('location_address') or 'address' }}">{% if is_filled %}{{
                        field_value }}{% else %}–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ{% endif %}</td>
                </tr>
                {% elif field_name == 'contact_phone' %}
                <tr>
                    <td
                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                        {{ field_label }}</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb;" itemprop="{{ itemprop_map.get('contact_phone') or 'telephone' }}">{% if is_filled %}{{
                        field_value }}{% else %}–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ{% endif %}</td>
                </tr>
                {% elif field_name == 'contact_email' %}
                <tr>
                    <td
                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                        {{ field_label }}</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb;" itemprop="{{ itemprop_map.get('contact_email') or 'email' }}">{% if is_filled %}{{
                        field_value }}{% else %}–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ{% endif %}</td>
                </tr>
                {% elif field_name == 'official_website' %}
                <tr>
                    <td
                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                        {{ field_label }}</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb;">
                        {% if is_filled %}
                        <a href="{{ field_value }}" target="_blank" itemprop="{{ itemprop_map.get('official_website') or 'url' }}">{{ field_value }}</a>
                        {% else %}
                        <span itemprop="{{ itemprop_map.get('official_website') or 'url' }}">–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>
                        {% endif %}
                    </td>
                </tr>
                {% elif field_name == 'visually_impaired_version' %}
                <tr>
                    <td
                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                        {{ field_label }}</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb;">
                        {% if is_filled %}
                        <a href="{{ field_value }}" target="_blank" itemprop="{{ itemprop_map.get('visually_impaired_version') or 'copy' }}">{{ field_value }}</a>
                        {% else %}
                        <span itemprop="{{ itemprop_map.get('visually_impaired_version') or 'copy' }}">–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>
                        {% endif %}
                    </td>
                </tr>
                {% elif field_name == 'founder_name' %}
                {# –ë–ª–æ–∫ —É—á—Ä–µ–¥–∏—Ç–µ–ª—è –ø–æ –º–µ—Ç–æ–¥–∏—á–∫–µ: –æ–¥–∏–Ω uchredLaw –∏ 5 –¥–æ—á–µ—Ä–Ω–∏—Ö —Ç–µ–≥–æ–≤ #}
                {% set founder_name_value = text_data.form_data.get('founder_name', '') | trim %}
                {% set founder_address_value = text_data.form_data.get('founder_address', '') | trim %}
                {% set founder_phone_value = text_data.form_data.get('founder_phone', '') | trim %}
                {% set founder_email_value = text_data.form_data.get('founder_email', '') | trim %}
                {% set founder_website_value = text_data.form_data.get('founder_website', '') | trim %}
                <tr itemprop="uchredLaw" itemscope="itemscope" itemtype="https://schema.org/Organization">
                    <td
                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                        {{ founder_title_text }}</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr>
                                <td style="padding: 5px; border: none; font-weight: 600; width: 40%;">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ
                                    —É—á—Ä–µ–¥–∏—Ç–µ–ª—è</td>
                                <td style="padding: 5px; border: none;" itemprop="{{ itemprop_map.get('founder_name') or 'nameUchred' }}">{% if founder_name_value %}{{ founder_name_value }}{% else %}–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ{% endif %}</td>
                            </tr>
                            <tr>
                                <td style="padding: 5px; border: none; font-weight: 600; width: 40%;">–ê–¥—Ä–µ—Å —É—á—Ä–µ–¥–∏—Ç–µ–ª—è
                                </td>
                                <td style="padding: 5px; border: none;" itemprop="{{ itemprop_map.get('founder_address') or 'addressUchred' }}">{% if founder_address_value %}{{ founder_address_value }}{% else %}–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ{% endif %}</td>
                            </tr>
                            <tr>
                                <td style="padding: 5px; border: none; font-weight: 600; width: 40%;">–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω
                                    —É—á—Ä–µ–¥–∏—Ç–µ–ª—è</td>
                                <td style="padding: 5px; border: none;" itemprop="{{ itemprop_map.get('founder_phone') or 'telUchred' }}">{% if founder_phone_value %}{{ founder_phone_value }}{% else %}–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ{% endif %}</td>
                            </tr>
                            <tr>
                                <td style="padding: 5px; border: none; font-weight: 600; width: 40%;">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞
                                    —É—á—Ä–µ–¥–∏—Ç–µ–ª—è</td>
                                <td style="padding: 5px; border: none;" itemprop="{{ itemprop_map.get('founder_email') or 'mailUchred' }}">{% if founder_email_value %}{{ founder_email_value }}{% else %}–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ{% endif %}</td>
                            </tr>
                            <tr>
                                <td style="padding: 5px; border: none; font-weight: 600; width: 40%;">–°–∞–π—Ç —É—á—Ä–µ–¥–∏—Ç–µ–ª—è
                                </td>
                                <td style="padding: 5px; border: none;" itemprop="{{ itemprop_map.get('founder_website') or 'websiteUchred' }}">{% if founder_website_value %}{{ founder_website_value }}{% else %}–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ{% endif %}</td>
                            </tr>
                        </table>
                    </td>
                </tr>
                {% elif field_name in ['founder_address', 'founder_phone', 'founder_email', 'founder_website'] %}
                {# –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —ç—Ç–∏ –ø–æ–ª—è, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å founder_name #}
                {% else %}
                <tr>
                    <td
                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                        {{ field_label }}</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb;">
                        {% if is_filled %}
                        {{ render_field_content(field_name, field_label, field_value, section.endpoint, false) }}
                        {% else %}
                        <span>–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>
                        {% endif %}
                    </td>
                </tr>
                {% endif %}
                {% endfor %}
            </tbody>
        </table>

        {# –í–∞—Ä–∏–∞–Ω—Ç A: —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã –∏ –∞–¥—Ä–µ—Å–∞ –í–ù–£–¢–†–ò mainInfo (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –∏–∑ –º–µ—Ç–æ–¥–∏—á–∫–∏) #}
        <!-- –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã -->
        <div class="working-hours-section" itemprop="workTime">
            <div class="working-hours-header">
                {% if working_hours_visible %}<h2>{{ working_hours_text }}</h2>{% endif %}
            </div>
            <div class="working-hours-container">
                <table class="working-hours-table">
                    <thead>
                        <tr>
                            <th>–î–µ–Ω—å –Ω–µ–¥–µ–ª–∏</th>
                            <th>–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã</th>
                            <th>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ ‚Äì —á–µ—Ç–≤–µ—Ä–≥</td>
                            <td>09:00 –¥–æ 18:00</td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>–ü—è—Ç–Ω–∏—Ü–∞</td>
                            <td>09:00 –¥–æ 16:45</td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>–û–±–µ–¥–µ–Ω–Ω—ã–π –ø–µ—Ä–µ—Ä—ã–≤</td>
                            <td>13:00 –¥–æ 13:45</td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>–í—ã—Ö–æ–¥–Ω–æ–π</td>
                            <td></td>
                            <td>—Å—É–±–±–æ—Ç–∞, –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        {# –ú–µ—Å—Ç–∞ –æ—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–ø–æ –º–µ—Ç–æ–¥–∏—á–∫–µ –ø. 3.2, —Ç–∞–±–ª–∏—Ü–∞ 3.2.1) #}
        {% set locations_order = [
        ('main_educational_location', '–û—Å–Ω–æ–≤–Ω–æ–µ –º–µ—Å—Ç–æ –æ—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏'),
        ('additional_educational_programs_location', '–ú–µ—Å—Ç–∞ –æ—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º –ø—Ä–æ–≥—Ä–∞–º–º–∞–º'),
        ('main_professional_training_location', '–ú–µ—Å—Ç–∞ –æ—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ –æ—Å–Ω–æ–≤–Ω—ã–º –ø—Ä–æ–≥—Ä–∞–º–º–∞–º –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è'),
        ('network_form_location', '–ú–µ—Å—Ç–∞ –æ—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Å–µ—Ç–µ–≤–æ–π —Ñ–æ—Ä–º—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º'),
        ('practice_location', '–ú–µ—Å—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –ø—Ä–∞–∫—Ç–∏–∫–∏'),
        ('practical_training_location', '–ú–µ—Å—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –æ–±—É—á–∞—é—â–∏—Ö—Å—è'),
        ('gia_location', '–ú–µ—Å—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–π –∏—Ç–æ–≥–æ–≤–æ–π –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏–∏')
        ] %}
        {% set locations_entries = [] %}
        {% for loc_key, loc_label in locations_order %}
        {% if text_data.form_data.get(loc_key) %}
        {% set _ = locations_entries.append({'label': loc_label, 'value': text_data.form_data.get(loc_key), 'key': loc_key}) %}
        {% endif %}
        {% endfor %}
        {# –†–∞–Ω–µ–µ –∑–¥–µ—Å—å –¥–æ–±–∞–≤–ª—è–ª–∏—Å—å –ª—é–±—ã–µ –ø–æ–ª—è form_data —Å "location". –£–±—Ä–∞–Ω–æ, —á—Ç–æ–±—ã –Ω–µ –≤—ã–≤–æ–¥–∏—Ç—å –ª–∏—à–Ω–∏–µ –ø–æ–ª—è –≤—Ä–æ–¥–µ "Location Address". #}

        <div class="locations-section">
            <div class="locations-header">
                {% if places_visible %}<h2>{{ places_text }}</h2>{% endif %}
            </div>
            <div class="locations-container">
                {% if locations_entries %}
                {% for loc in locations_entries %}
                {% if loc and loc.value %}
                {% set location_itemprop = itemprop_map.get(loc.key) if loc.key else none %}
                {% if not location_itemprop %}
                {% set location_itemprop = 'address' %}
                {% if '—Å–µ—Ç–µ–≤–æ–π —Ñ–æ—Ä–º—ã' in loc.label or 'network' in loc.label|lower %}
                {% set location_itemprop = 'addressPlaceSet' %}
                {% elif '–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º –ø—Ä–æ–≥—Ä–∞–º–º–∞–º' in loc.label or 'additional' in loc.label|lower %}
                {% set location_itemprop = 'addressPlaceDop' %}
                {% elif '–æ—Å–Ω–æ–≤–Ω—ã–º –ø—Ä–æ–≥—Ä–∞–º–º–∞–º –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è' in loc.label or 'professional training' in
                loc.label|lower %}
                {% set location_itemprop = 'addressPlaceOpp' %}
                {% elif '–ø—Ä–∞–∫—Ç–∏–∫–∏' in loc.label or 'practice' in loc.label|lower %}
                {% set location_itemprop = 'addressPlacePrac' %}
                {% elif '–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏' in loc.label or 'practical training' in loc.label|lower %}
                {% set location_itemprop = 'addressPlacePodg' %}
                {% elif '–≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–π –∏—Ç–æ–≥–æ–≤–æ–π –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏–∏' in loc.label or 'GIA' in loc.label|upper %}
                {% set location_itemprop = 'addressPlaceGia' %}
                {% endif %}
                {% endif %}
                <div class="location-block">
                    <div class="location-title">{{ loc.label }}</div>
                    <div class="location-address" itemprop="{{ location_itemprop }}">
                        {% if loc.value is string %}
                        {{ loc.value }}
                        {% elif loc.value is iterable %}
                        {% for item in loc.value %}
                        {% if item is mapping and item.address is defined %}
                        {{ item.address }}
                        {% elif item is string %}
                        {{ item }}
                        {% else %}
                        {{ item }}
                        {% endif %}
                        {% if not loop.last %}<br>{% endif %}
                        {% endfor %}
                        {% else %}
                        {{ loc.value }}
                        {% endif %}
                    </div>
                </div>
                {% endif %}
                {% endfor %}
                {% else %}
                <div class="locations-content info-block-content">
                    –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω–∞.
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% elif section.endpoint == 'main' %}
    {# –í–∞—Ä–∏–∞–Ω—Ç B (–∫–∞–∫ –±—ã–ª–æ —Ä–∞–Ω—å—à–µ): mainInfo –æ—Ç–¥–µ–ª—å–Ω–æ, —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã –∏ –∞–¥—Ä–µ—Å–∞ –≤–Ω–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ mainInfo.
    –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç —Å—Ä–∞–≤–Ω–∏—Ç—å, –∫–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º –ø—Ä–æ–≤–µ—Ä–∫–∏. #}
    {# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä mainInfo –≤—Å–µ–≥–¥–∞, –¥–∞–∂–µ –µ—Å–ª–∏ –ø–æ–ª—è –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã #}
    <div class="form-data-section" itemprop="mainInfo" itemscope="itemscope"
        itemtype="https://schema.org/EducationalOrganization">
        {% if main_title_visible %}<h2>{{ main_title_text }}</h2>{% endif %}
        <table class="info-table" style="width: 100%; border-collapse: collapse; margin: 20px 0;">
            <tbody>
                {% set field_labels = {
                'full_name': '–ü–æ–ª–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏',
                'short_name': '–°–æ–∫—Ä–∞—â–µ–Ω–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏',
                'founding_date': '–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏',
                'location_address': '–ê–¥—Ä–µ—Å –º–µ—Å—Ç–æ–Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏',
                'contact_phone': '–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ —Ç–µ–ª–µ—Ñ–æ–Ω—ã –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏',
                'contact_email': '–ê–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏',
                'official_website': '–ê–¥—Ä–µ—Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞',
                'visually_impaired_version': '–í–µ—Ä—Å–∏—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞ –¥–ª—è —Å–ª–∞–±–æ–≤–∏–¥—è—â–∏—Ö',
                'founder_name': founder_title_text,
                'founder_address': '–ê–¥—Ä–µ—Å —É—á—Ä–µ–¥–∏—Ç–µ–ª—è',
                'founder_phone': '–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω —É—á—Ä–µ–¥–∏—Ç–µ–ª—è',
                'founder_email': '–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞ —É—á—Ä–µ–¥–∏—Ç–µ–ª—è',
                'founder_website': '–°–∞–π—Ç —É—á—Ä–µ–¥–∏—Ç–µ–ª—è',
                'social_media': '–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö'
                } %}

                {% for field_name in main_fields %}
                {% set field_label = field_labels.get(field_name, field_name | replace('_', ' ') | title) %}
                {% set field_value = text_data.form_data.get(field_name) %}
                {% set is_filled = field_value and field_value | trim %}
                {% if field_name == 'full_name' %}
                <tr>
                    <td
                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                        {{ field_label }}</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb;" itemprop="{{ itemprop_map.get('full_name') or 'fullName' }}">{% if is_filled %}{{
                        field_value }}{% else %}–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ{% endif %}</td>
                </tr>
                {% elif field_name == 'short_name' %}
                <tr>
                    <td
                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                        {{ field_label }}</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb;" itemprop="{{ itemprop_map.get('short_name') or 'shortName' }}">{% if is_filled %}{{
                        field_value }}{% else %}–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ{% endif %}</td>
                </tr>
                {% elif field_name == 'founding_date' %}
                <tr>
                    <td
                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                        {{ field_label }}</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb;" itemprop="{{ itemprop_map.get('founding_date') or 'regDate' }}">{% if is_filled %}{{
                        field_value }}{% else %}–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ{% endif %}</td>
                </tr>
                {% elif field_name == 'location_address' %}
                <tr>
                    <td
                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                        {{ field_label }}</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb;" itemprop="{{ itemprop_map.get('location_address') or 'address' }}">{% if is_filled %}{{
                        field_value }}{% else %}–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ{% endif %}</td>
                </tr>
                {% elif field_name == 'contact_phone' %}
                <tr>
                    <td
                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                        {{ field_label }}</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb;" itemprop="{{ itemprop_map.get('contact_phone') or 'telephone' }}">{% if is_filled %}{{
                        field_value }}{% else %}–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ{% endif %}</td>
                </tr>
                {% elif field_name == 'contact_email' %}
                <tr>
                    <td
                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                        {{ field_label }}</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb;" itemprop="{{ itemprop_map.get('contact_email') or 'email' }}">{% if is_filled %}{{
                        field_value }}{% else %}–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ{% endif %}</td>
                </tr>
                {% elif field_name == 'official_website' %}
                <tr>
                    <td
                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                        {{ field_label }}</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb;">
                        {% if is_filled %}
                        <a href="{{ field_value }}" target="_blank" itemprop="{{ itemprop_map.get('official_website') or 'url' }}">{{ field_value }}</a>
                        {% else %}
                        <span itemprop="{{ itemprop_map.get('official_website') or 'url' }}">–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>
                        {% endif %}
                    </td>
                </tr>
                {% elif field_name == 'visually_impaired_version' %}
                <tr>
                    <td
                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                        {{ field_label }}</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb;">
                        {% if is_filled %}
                        <a href="{{ field_value }}" target="_blank" itemprop="{{ itemprop_map.get('visually_impaired_version') or 'copy' }}">{{ field_value }}</a>
                        {% else %}
                        <span itemprop="{{ itemprop_map.get('visually_impaired_version') or 'copy' }}">–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>
                        {% endif %}
                    </td>
                </tr>
                {% elif field_name == 'founder_name' %}
                {# –ë–ª–æ–∫ —É—á—Ä–µ–¥–∏—Ç–µ–ª—è –ø–æ –º–µ—Ç–æ–¥–∏—á–∫–µ: –æ–¥–∏–Ω uchredLaw –∏ 5 –¥–æ—á–µ—Ä–Ω–∏—Ö —Ç–µ–≥–æ–≤ #}
                {% set founder_name_value = text_data.form_data.get('founder_name', '') | trim %}
                {% set founder_address_value = text_data.form_data.get('founder_address', '') | trim %}
                {% set founder_phone_value = text_data.form_data.get('founder_phone', '') | trim %}
                {% set founder_email_value = text_data.form_data.get('founder_email', '') | trim %}
                {% set founder_website_value = text_data.form_data.get('founder_website', '') | trim %}
                <tr itemprop="uchredLaw" itemscope="itemscope" itemtype="https://schema.org/Organization">
                    <td
                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                        {{ founder_title_text }}</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr>
                                <td style="padding: 5px; border: none; font-weight: 600; width: 40%;">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ
                                    —É—á—Ä–µ–¥–∏—Ç–µ–ª—è</td>
                                <td style="padding: 5px; border: none;" itemprop="{{ itemprop_map.get('founder_name') or 'nameUchred' }}">{% if founder_name_value %}{{ founder_name_value }}{% else %}–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ{% endif %}</td>
                            </tr>
                            <tr>
                                <td style="padding: 5px; border: none; font-weight: 600; width: 40%;">–ê–¥—Ä–µ—Å —É—á—Ä–µ–¥–∏—Ç–µ–ª—è
                                </td>
                                <td style="padding: 5px; border: none;" itemprop="{{ itemprop_map.get('founder_address') or 'addressUchred' }}">{% if founder_address_value %}{{ founder_address_value }}{% else %}–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ{% endif %}</td>
                            </tr>
                            <tr>
                                <td style="padding: 5px; border: none; font-weight: 600; width: 40%;">–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω
                                    —É—á—Ä–µ–¥–∏—Ç–µ–ª—è</td>
                                <td style="padding: 5px; border: none;" itemprop="{{ itemprop_map.get('founder_phone') or 'telUchred' }}">{% if founder_phone_value %}{{ founder_phone_value }}{% else %}–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ{% endif %}</td>
                            </tr>
                            <tr>
                                <td style="padding: 5px; border: none; font-weight: 600; width: 40%;">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞
                                    —É—á—Ä–µ–¥–∏—Ç–µ–ª—è</td>
                                <td style="padding: 5px; border: none;" itemprop="{{ itemprop_map.get('founder_email') or 'mailUchred' }}">{% if founder_email_value %}{{ founder_email_value }}{% else %}–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ{% endif %}</td>
                            </tr>
                            <tr>
                                <td style="padding: 5px; border: none; font-weight: 600; width: 40%;">–°–∞–π—Ç —É—á—Ä–µ–¥–∏—Ç–µ–ª—è
                                </td>
                                <td style="padding: 5px; border: none;" itemprop="{{ itemprop_map.get('founder_website') or 'websiteUchred' }}">{% if founder_website_value %}{{ founder_website_value }}{% else %}–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ{% endif %}</td>
                            </tr>
                        </table>
                    </td>
                </tr>
                {% elif field_name in ['founder_address', 'founder_phone', 'founder_email', 'founder_website'] %}
                {# –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —ç—Ç–∏ –ø–æ–ª—è, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å founder_name #}
                {% else %}
                <tr>
                    <td
                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                        {{ field_label }}</td>
                    <td style="padding: 10px; border: 1px solid #e5e7eb;">
                        {% if is_filled %}
                        {{ render_field_content(field_name, field_label, field_value, section.endpoint, false) }}
                        {% else %}
                        <span>–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>
                        {% endif %}
                    </td>
                </tr>
                {% endif %}
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã -->
    <div class="working-hours-section" itemprop="workTime">
        <div class="working-hours-header">
            {% if working_hours_visible %}<h2>{{ working_hours_text }}</h2>{% endif %}
        </div>
        <div class="working-hours-container">
            <table class="working-hours-table">
                <thead>
                    <tr>
                        <th>–î–µ–Ω—å –Ω–µ–¥–µ–ª–∏</th>
                        <th>–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã</th>
                        <th>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ ‚Äì —á–µ—Ç–≤–µ—Ä–≥</td>
                        <td>09:00 –¥–æ 18:00</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>–ü—è—Ç–Ω–∏—Ü–∞</td>
                        <td>09:00 –¥–æ 16:45</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>–û–±–µ–¥–µ–Ω–Ω—ã–π –ø–µ—Ä–µ—Ä—ã–≤</td>
                        <td>13:00 –¥–æ 13:45</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>–í—ã—Ö–æ–¥–Ω–æ–π</td>
                        <td></td>
                        <td>—Å—É–±–±–æ—Ç–∞, –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- –ú–µ—Å—Ç–∞ –æ—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ -->
    {# –ü–æ –º–µ—Ç–æ–¥–∏—á–∫–µ –ø. 3.2, —Ç–∞–±–ª–∏—Ü–∞ 3.2.1 #}
    {% set locations_order = [
    ('main_educational_location', '–û—Å–Ω–æ–≤–Ω–æ–µ –º–µ—Å—Ç–æ –æ—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏'),
    ('additional_educational_programs_location', '–ú–µ—Å—Ç–∞ –æ—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º –ø—Ä–æ–≥—Ä–∞–º–º–∞–º'),
    ('main_professional_training_location', '–ú–µ—Å—Ç–∞ –æ—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ –æ—Å–Ω–æ–≤–Ω—ã–º –ø—Ä–æ–≥—Ä–∞–º–º–∞–º –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è'),
    ('network_form_location', '–ú–µ—Å—Ç–∞ –æ—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Å–µ—Ç–µ–≤–æ–π —Ñ–æ—Ä–º—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º'),
    ('practice_location', '–ú–µ—Å—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –ø—Ä–∞–∫—Ç–∏–∫–∏'),
    ('practical_training_location', '–ú–µ—Å—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –æ–±—É—á–∞—é—â–∏—Ö—Å—è'),
    ('gia_location', '–ú–µ—Å—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–π –∏—Ç–æ–≥–æ–≤–æ–π –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏–∏')
    ] %}
    {% set locations_entries = [] %}
    {% for loc_key, loc_label in locations_order %}
    {% if text_data.form_data.get(loc_key) %}
    {% set _ = locations_entries.append({'label': loc_label, 'value': text_data.form_data.get(loc_key), 'key': loc_key}) %}
        {% endif %}
        {% endfor %}
    {# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è —Å "location" —É–º—ã—à–ª–µ–Ω–Ω–æ –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º, —á—Ç–æ–±—ã –Ω–µ –ø–æ—è–≤–ª—è–ª–∏—Å—å –ª–∏—à–Ω–∏–µ –∑–∞–ø–∏—Å–∏. #}
    <div class="locations-section">
        <div class="locations-header">
            {% if places_visible %}<h2>{{ places_text }}</h2>{% endif %}
        </div>
        <div class="locations-container">
            {% if locations_entries %}
            {% for loc in locations_entries %}
            {% if loc and loc.value %}
            {% set location_itemprop = itemprop_map.get(loc.key) if loc.key else none %}
            {% if not location_itemprop %}
            {% set location_itemprop = 'address' %}
            {% if '—Å–µ—Ç–µ–≤–æ–π —Ñ–æ—Ä–º—ã' in loc.label or 'network' in loc.label|lower %}
            {% set location_itemprop = 'addressPlaceSet' %}
            {% elif '–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º –ø—Ä–æ–≥—Ä–∞–º–º–∞–º' in loc.label or 'additional' in loc.label|lower %}
            {% set location_itemprop = 'addressPlaceDop' %}
            {% elif '–æ—Å–Ω–æ–≤–Ω—ã–º –ø—Ä–æ–≥—Ä–∞–º–º–∞–º –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è' in loc.label or 'professional training' in
            loc.label|lower %}
            {% set location_itemprop = 'addressPlaceOpp' %}
            {% elif '–ø—Ä–∞–∫—Ç–∏–∫–∏' in loc.label or 'practice' in loc.label|lower %}
            {% set location_itemprop = 'addressPlacePrac' %}
            {% elif '–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏' in loc.label or 'practical training' in loc.label|lower %}
            {% set location_itemprop = 'addressPlacePodg' %}
            {% elif '–≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–π –∏—Ç–æ–≥–æ–≤–æ–π –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏–∏' in loc.label or 'GIA' in loc.label|upper %}
            {% set location_itemprop = 'addressPlaceGia' %}
            {% endif %}
            {% endif %}
            <div class="location-block">
                <div class="location-title">{{ loc.label }}</div>
                <div class="location-address" itemprop="{{ location_itemprop }}">
                    {% if loc.value is string %}
                    {{ loc.value }}
                    {% elif loc.value is iterable %}
                    {% for item in loc.value %}
                    {% if item is mapping and item.address is defined %}
                    {{ item.address }}
                    {% elif item is string %}
                    {{ item }}
                    {% else %}
                    {{ item }}
                    {% endif %}
                    {% if not loop.last %}<br>{% endif %}
                    {% endfor %}
                    {% else %}
                    {{ loc.value }}
                    {% endif %}
                </div>
            </div>
            {% endif %}
            {% endfor %}
            {% else %}
            <div class="locations-content info-block-content">
                –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω–∞.
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}
    {% endif %}


    <!-- –õ–∏—Ü–µ–Ω–∑–∏—è -->
    {# –õ–∏—Ü–µ–Ω–∑–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ main #}
    {% if section.endpoint == 'main' %}
    <div class="form-data-section" itemprop="licenseDocLink" itemscope="itemscope"
        itemtype="https://schema.org/MediaObject">
        {% if license_visible %}<h2>{{ license_text }}</h2>{% endif %}
        {% set field_name = 'license_document' %}
        {% set field_label = '–§–∞–π–ª –ª–∏—Ü–µ–Ω–∑–∏–∏' %}
        {% set field_value = text_data.form_data.get(field_name) %}
        {% set is_filled = false %}
        {% if field_value %}
        {% if field_value is string %}
        {# –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä–æ–∫–∏ —Å –∑–∞–ø—è—Ç—ã–º–∏ (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤) #}
        {% if ',' in field_value %}
        {# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ñ–∞–π–ª –≤ —Å—Ç—Ä–æ–∫–µ —Å –∑–∞–ø—è—Ç—ã–º–∏ #}
        {% set files = field_value.split(',') %}
        {% for file_url in files %}
        {% set file_url_trimmed = file_url.strip() %}
        {# –ò–∑–≤–ª–µ–∫–∞–µ–º URL —á–∞—Å—Ç—å (–¥–æ |) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ #}
        {% set url_part = file_url_trimmed.split('|')[0].strip() if '|' in file_url_trimmed else file_url_trimmed %}
        {% if url_part and (url_part.startswith('/download_file/') or url_part.startswith('/info/download_file/') or
        url_part.startswith('/static/uploads/')) %}
        {% set is_filled = true %}
        {% endif %}
        {% endfor %}
        {% elif field_value.startswith('/download_file/') or field_value.startswith('/info/download_file/') or
        field_value.startswith('/static/uploads/') %}
        {% set is_filled = true %}
        {% endif %}
        {% elif field_value is mapping and (field_value.get('url') or field_value.get('filename')) %}
        {% set is_filled = true %}
        {% elif field_value is iterable and field_value is not string %}
        {% set is_filled = true %}
        {% endif %}
        {% endif %}
        <div class="form-data-item" style="margin-bottom: 12px;">
            <strong>{{ field_label }}:</strong>
            {% if field_value %}
            {{ render_field_content(field_name, field_label, field_value, section.endpoint, false) }}
            {% else %}
            <span style="color: #6b7280; font-style: italic;">—Ñ–∞–π–ª –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</span>
            {% endif %}
        </div>

        <!-- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫ –ª–∏—Ü–µ–Ω–∑–∏–∏ -->
        {% set field_name = 'license_attachment' %}
        {% set field_label = '–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫ –ª–∏—Ü–µ–Ω–∑–∏–∏' %}
        {% set field_value = text_data.form_data.get(field_name) %}
        {% set is_filled = false %}
        {% if field_value %}
        {% if field_value is string %}
        {# –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä–æ–∫–∏ —Å –∑–∞–ø—è—Ç—ã–º–∏ (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤) #}
        {% if ',' in field_value %}
        {# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ñ–∞–π–ª –≤ —Å—Ç—Ä–æ–∫–µ —Å –∑–∞–ø—è—Ç—ã–º–∏ #}
        {% set files = field_value.split(',') %}
        {% for file_url in files %}
        {% set file_url_trimmed = file_url.strip() %}
        {# –ò–∑–≤–ª–µ–∫–∞–µ–º URL —á–∞—Å—Ç—å (–¥–æ |) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ #}
        {% set url_part = file_url_trimmed.split('|')[0].strip() if '|' in file_url_trimmed else file_url_trimmed %}
        {% if url_part and (url_part.startswith('/download_file/') or url_part.startswith('/info/download_file/') or
        url_part.startswith('/static/uploads/')) %}
        {% set is_filled = true %}
        {% endif %}
        {% endfor %}
        {% elif field_value.startswith('/download_file/') or field_value.startswith('/info/download_file/') or
        field_value.startswith('/static/uploads/') %}
        {% set is_filled = true %}
        {% endif %}
        {% elif field_value is mapping and (field_value.get('url') or field_value.get('filename')) %}
        {% set is_filled = true %}
        {% elif field_value is iterable and field_value is not string %}
        {% set is_filled = true %}
        {% endif %}
        {% endif %}
        <div class="form-data-item" style="margin-bottom: 12px;">
            <strong>{{ field_label }}:</strong>
            {% if field_value %}
            {{ render_field_content(field_name, field_label, field_value, section.endpoint, false) }}
            {% else %}
            <span style="color: #6b7280; font-style: italic;">—Ñ–∞–π–ª –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</span>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- –ê–∫–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏—è -->
    {# –ê–∫–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ main #}
    {% if section.endpoint == 'main' %}
    <div class="form-data-section" itemprop="accreditationDocLink" itemscope="itemscope"
        itemtype="https://schema.org/MediaObject">
        {% if accreditation_visible %}<h2>{{ accreditation_text }}</h2>{% endif %}
        {% set field_name = 'accreditation_document' %}
        {% set field_label = '–§–∞–π–ª –∞–∫–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏–∏' %}
        {% set field_value = text_data.form_data.get(field_name) %}
        {% set is_filled = false %}
        {% if field_value %}
        {% if field_value is string %}
        {# –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä–æ–∫–∏ —Å –∑–∞–ø—è—Ç—ã–º–∏ (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤) #}
        {% if ',' in field_value %}
        {# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ñ–∞–π–ª –≤ —Å—Ç—Ä–æ–∫–µ —Å –∑–∞–ø—è—Ç—ã–º–∏ #}
        {% set files = field_value.split(',') %}
        {% for file_url in files %}
        {% set file_url_trimmed = file_url.strip() %}
        {# –ò–∑–≤–ª–µ–∫–∞–µ–º URL —á–∞—Å—Ç—å (–¥–æ |) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ #}
        {% set url_part = file_url_trimmed.split('|')[0].strip() if '|' in file_url_trimmed else file_url_trimmed %}
        {% if url_part and (url_part.startswith('/download_file/') or url_part.startswith('/info/download_file/') or
        url_part.startswith('/static/uploads/')) %}
        {% set is_filled = true %}
        {% endif %}
        {% endfor %}
        {% elif field_value.startswith('/download_file/') or field_value.startswith('/info/download_file/') or
        field_value.startswith('/static/uploads/') %}
        {% set is_filled = true %}
        {% endif %}
        {% elif field_value is mapping and (field_value.get('url') or field_value.get('filename')) %}
        {% set is_filled = true %}
        {% elif field_value is iterable and field_value is not string %}
        {% set is_filled = true %}
        {% endif %}
        {% endif %}
        <div class="form-data-item" style="margin-bottom: 12px;">
            <strong>{{ field_label }}:</strong>
            {% if field_value %}
            {{ render_field_content(field_name, field_label, field_value, section.endpoint, false) }}
            {% else %}
            <span style="color: #6b7280; font-style: italic;">—Ñ–∞–π–ª –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</span>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –æ—Ä–≥–∞–Ω—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞) -->
    {% if section.endpoint == 'structure' %}
    {% set structure_fields = ['title', 'text', 'head_name', 'head_position', 'location', 'is_branch',
    'is_representative', 'website', 'email', 'additional_info', 'division_clause'] %}
    {# –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤ #}
    {% set is_branch = text_data.form_data.get('is_branch') %}
    {% set is_representative = text_data.form_data.get('is_representative') %}
    {% set structure_type = 'regular' %}
    {% if is_branch and (is_branch|string|lower == '–¥–∞' or is_branch|string|lower == 'yes' or is_branch|string|lower ==
    'true' or is_branch|string|lower == '1') %}
    {% set structure_type = 'branch' %}
    {% elif is_representative and (is_representative|string|lower == '–¥–∞' or is_representative|string|lower == 'yes' or
    is_representative|string|lower == 'true' or is_representative|string|lower == '1') %}
    {% set structure_type = 'representative' %}
    {% endif %}

    {# –¢—Ä–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –±–ª–æ–∫–∞: –û–±—â–µ–µ —Å–æ–±—Ä–∞–Ω–∏–µ, –ü–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–π —Å–æ–≤–µ—Ç, –£–ø—Ä–∞–≤–ª—è—é—â–∏–π —Å–æ–≤–µ—Ç #}
            {% set councils = [
            {
            'title': '–û–±—â–µ–µ —Å–æ–±—Ä–∞–Ω–∏–µ —Ç—Ä—É–¥–æ–≤–æ–≥–æ –∫–æ–ª–ª–µ–∫—Ç–∏–≤–∞ –ì–∏–º–Ω–∞–∑–∏–∏',
            'prefix': 'structure_general'
            },
            {
            'title': '–ü–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–π —Å–æ–≤–µ—Ç',
            'prefix': 'structure_ped'
            },
            {
            'title': '–£–ø—Ä–∞–≤–ª—è—é—â–∏–π —Å–æ–≤–µ—Ç',
            'prefix': 'structure_mgmt'
            }
            ] %}
            {% for council in councils %}
            {% set prefix = council.prefix %}
            {% set _council_title_val = text_data.form_data.get(prefix ~ '_title') or '' %}
            {% set council_display_title = (_council_title_val | trim) or council.title %}
            {% set head_name = text_data.form_data.get(prefix ~ '_head_name') %}
            {% set head_position = text_data.form_data.get(prefix ~ '_head_position') %}
            {% set location_val = text_data.form_data.get(prefix ~ '_location') %}
            {% set is_branch = text_data.form_data.get(prefix ~ '_is_branch') %}
            {% set is_representative = text_data.form_data.get(prefix ~ '_is_representative') %}
            {% set website = text_data.form_data.get(prefix ~ '_website') %}
            {% set email = text_data.form_data.get(prefix ~ '_email') %}
            {% set additional_info = text_data.form_data.get(prefix ~ '_additional_info') %}
            {% set division_clause = text_data.form_data.get(prefix ~ '_division_clause') %}
            {# –ë–ª–æ–∫–∏ —Å–æ–≤–µ—Ç–æ–≤ –≤—Å–µ–≥–¥–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è, –¥–∞–∂–µ –µ—Å–ª–∏ –≤—Å–µ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ #}
            {# –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤ #}
            {% set council_type = 'regular' %}
            {% if is_branch and (is_branch|string|lower == '–¥–∞' or is_branch|string|lower == 'yes' or
            is_branch|string|lower == 'true' or is_branch|string|lower == '1') %}
            {% set council_type = 'branch' %}
            {% elif is_representative and (is_representative|string|lower == '–¥–∞' or is_representative|string|lower ==
            'yes' or is_representative|string|lower == 'true' or is_representative|string|lower == '1') %}
            {% set council_type = 'representative' %}
            {% endif %}
            {% if council_type == 'branch' %}
            <div class="form-data-section" itemprop="filInfo" itemscope="itemscope"
                itemtype="https://schema.org/ItemList">
                {% elif council_type == 'representative' %}
                <div class="form-data-section" itemprop="repInfo" itemscope="itemscope"
                    itemtype="https://schema.org/ItemList">
                    {% else %}
                    <div class="form-data-section" itemprop="structOrgUprav" itemscope="itemscope"
                        itemtype="https://schema.org/ItemList">
                        {% endif %}
                        {% set council_header_cfg = section_headers.get('structure_council_' ~ council.prefix ~ '_title') or {} %}
                        {% if council_header_cfg.get('visible', True) %}<h2>{{ council_header_cfg.get('text') or council_display_title }}</h2>{% endif %}
                        <table class="info-table" style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                            <tbody>
                                <tr>
                                    <td
                                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                                        –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–≥–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è</td>
                                    <td style="padding: 10px; border: 1px solid #e5e7eb;">
                                        {% if council_type == 'branch' %}
                                        <span itemprop="nameFil">{{ council_display_title }}</span>
                                        {% elif council_type == 'representative' %}
                                        <span itemprop="nameRep">{{ council_display_title }}</span>
                                        {% else %}
                                        <span itemprop="name">{{ council_display_title }}</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <td
                                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                                        –§–ò–û —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è</td>
                                    <td style="padding: 10px; border: 1px solid #e5e7eb;">
                                        {% if head_name %}
                                        {% if council_type == 'branch' %}
                                        <span itemprop="fioFil">{{ head_name }}</span>
                                        {% elif council_type == 'representative' %}
                                        <span itemprop="fioRep">{{ head_name }}</span>
                                        {% else %}
                                        <span itemprop="fio">{{ head_name }}</span>
                                        {% endif %}
                                        {% else %}
                                        {% if council_type == 'branch' %}<span itemprop="fioFil">–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>{% elif council_type == 'representative' %}<span itemprop="fioRep">–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>{% else %}<span itemprop="fio">–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>{% endif %}
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <td
                                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                                        –î–æ–ª–∂–Ω–æ—Å—Ç—å</td>
                                    <td style="padding: 10px; border: 1px solid #e5e7eb;">
                                        {% if head_position %}
                                        {% if council_type == 'branch' %}
                                        <span itemprop="postFil">{{ head_position }}</span>
                                        {% elif council_type == 'representative' %}
                                        <span itemprop="postRep">{{ head_position }}</span>
                                        {% else %}
                                        <span itemprop="post">{{ head_position }}</span>
                                        {% endif %}
                                        {% else %}
                                        {% if council_type == 'branch' %}<span itemprop="postFil">–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>{% elif council_type == 'representative' %}<span itemprop="postRep">–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>{% else %}<span itemprop="post">–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>{% endif %}
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <td
                                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                                        –ú–µ—Å—Ç–æ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è</td>
                                    <td style="padding: 10px; border: 1px solid #e5e7eb;">
                                        {% if location_val %}
                                        {% if council_type == 'branch' %}
                                        <span itemprop="addressFil">{{ location_val }}</span>
                                        {% elif council_type == 'representative' %}
                                        <span itemprop="addressRep">{{ location_val }}</span>
                                        {% else %}
                                        <span itemprop="addressStr">{{ location_val }}</span>
                                        {% endif %}
                                        {% else %}
                                        <span>–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <td
                                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                                        –ê–¥—Ä–µ—Å —Å–∞–π—Ç–∞</td>
                                    <td style="padding: 10px; border: 1px solid #e5e7eb;">
                                        {% if website %}
                                        {% if council_type == 'branch' %}
                                        <span><a href="{{ website }}" target="_blank" itemprop="websiteFil">{{ website
                                                }}</a></span>
                                        {% elif council_type == 'representative' %}
                                        <span><a href="{{ website }}" target="_blank" itemprop="websiteRep">{{ website
                                                }}</a></span>
                                        {% else %}
                                        <span><a href="{{ website }}" target="_blank" itemprop="site">{{ website
                                                }}</a></span>
                                        {% endif %}
                                        {% else %}
                                        <span>–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <td
                                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                                        –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞</td>
                                    <td style="padding: 10px; border: 1px solid #e5e7eb;">
                                        {% if email %}
                                        {% if council_type == 'branch' %}
                                        <span><a href="mailto:{{ email }}" itemprop="emailFil">{{ email }}</a></span>
                                        {% elif council_type == 'representative' %}
                                        <span><a href="mailto:{{ email }}" itemprop="emailRep">{{ email }}</a></span>
                                        {% else %}
                                        <span><a href="mailto:{{ email }}" itemprop="{{ itemprop_map.get('contact_email') or 'email' }}">{{ email }}</a></span>
                                        {% endif %}
                                        {% else %}
                                        <span>–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <td
                                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                                        –ü–æ–ª–æ–∂–µ–Ω–∏—è –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–º –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–∏</td>
                                    <td style="padding: 10px; border: 1px solid #e5e7eb;">
                                        {% if division_clause %}
                                        {% if division_clause is string and (division_clause.startswith('http') or
                                        division_clause.startswith('/download_file/') or
                                        division_clause.startswith('/info/download_file/')) %}
                                        {% set filename = division_clause.split('/')[-1] %}
                                        <span itemprop="divisionClauseDocLink" itemscope="itemscope"
                                            itemtype="https://schema.org/MediaObject">
                                            <a href="{{ division_clause }}" {% if
                                                division_clause.startswith('/download_file/') or
                                                division_clause.startswith('/info/download_file/') %}download{% else
                                                %}target="_blank" {% endif %} class="download-link"
                                                itemprop="contentUrl" aria-label="–°–∫–∞—á–∞—Ç—å {{ filename }}">
                                                –°–∫–∞—á–∞—Ç—å {{ filename }}
                                            </a>
                                        </span>
                                        {% else %}
                                        <span itemprop="divisionClauseDocLink" itemscope="itemscope"
                                            itemtype="https://schema.org/MediaObject">
                                            <span itemprop="contentUrl">{{ division_clause }}</span>
                                        </span>
                                        {% endif %}
                                        {% else %}
                                        <span>–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <td
                                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                                        –°—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —è–≤–ª—è–µ—Ç—Å—è —Ñ–∏–ª–∏–∞–ª–æ–º</td>
                                    <td style="padding: 10px; border: 1px solid #e5e7eb;">
                                        {% if is_branch %}<span>{{ is_branch }}</span>{% else %}<span>–Ω–µ
                                            –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>{% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <td
                                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                                        –°—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–æ–º</td>
                                    <td style="padding: 10px; border: 1px solid #e5e7eb;">
                                        {% if is_representative %}<span>{{ is_representative }}</span>{% else %}<span>–Ω–µ
                                            –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>{% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <td
                                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                                        –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</td>
                                    <td style="padding: 10px; border: 1px solid #e5e7eb;">
                                        {% if additional_info %}<span>{{ additional_info }}</span>{% else %}<span>–Ω–µ
                                            –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>{% endif %}
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    {% endfor %}

                    {# –û—Ä–≥–∞–Ω—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏: –≤—Å–µ–≥–¥–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º #}
                    {% set management_data = text_data.form_data.get('management_bodies') %}
                    <div class="form-data-section" itemprop="managementBodies" itemscope="itemscope"
                        itemtype="https://schema.org/ItemList" role="list">
                        {% set management_bodies_cfg = section_headers.get('management_bodies_title') or {} %}
                        {% if management_bodies_cfg.get('visible', True) %}<h2>{{ management_bodies_cfg.get('text') or '–û—Ä–≥–∞–Ω—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏' }}</h2>{% endif %}
                        <table class="info-table" style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                            <tbody>
                                {% if management_data %}
                                {% if management_data is string %}
                                <tr role="listitem" itemprop="managementBody">
                                    <td
                                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                                        –û—Ä–≥–∞–Ω—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</td>
                                    <td style="padding: 10px; border: 1px solid #e5e7eb;"><span>{{ management_data |
                                            safe }}</span></td>
                                </tr>
                                {% elif management_data is iterable %}
                                {% for item in management_data %}
                                <tr role="listitem" itemprop="managementBody">
                                    <td
                                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                                        {% if item.title is defined %}
                                        <strong>{{ item.title }}</strong><br>
                                        {% endif %}
                                        {% if item.head_name is defined %}
                                        <span>{{ item.head_name }}</span><br>
                                        {% endif %}
                                        {% if item.head_position is defined %}
                                        <span>{{ item.head_position }}</span><br>
                                        {% endif %}
                                        {% if item.location is defined %}
                                        <span>{{ item.location }}</span><br>
                                        {% endif %}
                                        {% if item.website is defined and item.website %}
                                        <a href="{{ item.website }}" target="_blank">{{ item.website }}</a><br>
                                        {% endif %}
                                        {% if item.email is defined and item.email %}
                                        <a href="mailto:{{ item.email }}">{{ item.email }}</a><br>
                                        {% endif %}
                                        {% if item.additional_info is defined %}
                                        <span>{{ item.additional_info }}</span>
                                        {% endif %}
                                    </td>
                                    <td style="padding: 10px; border: 1px solid #e5e7eb;"></td>
                                </tr>
                                {% endfor %}
                                {% else %}
                                <tr role="listitem" itemprop="managementBody">
                                    <td
                                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                                        –û—Ä–≥–∞–Ω—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</td>
                                    <td style="padding: 10px; border: 1px solid #e5e7eb;"><span>{{ management_data
                                            }}</span></td>
                                </tr>
                                {% endif %}
                                {% else %}
                                <tr role="listitem" itemprop="managementBody">
                                    <td
                                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                                        –û—Ä–≥–∞–Ω—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</td>
                                    <td style="padding: 10px; border: 1px solid #e5e7eb;"><span>–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span></td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                    {% endif %}

                    <!-- –°–æ–±–∏—Ä–∞–µ–º –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∏–∑ –±–ª–æ–∫–æ–≤ –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è -->
                    {% set all_block_documents = [] %}
                    {% set all_block_photos = [] %}
                    {% for block in section.get_content_blocks() %}
                    {% if block.get('type') == 'documents' and block.get('documents') %}
                    {% for doc in block.get('documents', []) %}
                    {% if doc %}
                    {% if doc is mapping %}
                    {% set doc_url = doc.get('url', '') %}
                    {% else %}
                    {% set doc_url = doc %}
                    {% endif %}
                    {% if doc_url %}
                    {% set filename = doc_url.split('/')[-1] %}
                    {% if filename %}
                    {% set _ = all_block_documents.append(filename) %}
                    {% endif %}
                    {% endif %}
                    {% endif %}
                    {% endfor %}
                    {% elif block.get('type') == 'photos' and block.get('photos') %}
                    {% for photo_url in block.get('photos', []) %}
                    {% if photo_url %}
                    {% set filename = photo_url.split('/')[-1] %}
                    {% if filename %}
                    {% set _ = all_block_photos.append(filename) %}
                    {% endif %}
                    {% endif %}
                    {% endfor %}
                    {% elif block.get('type') == 'text' and block.get('photos') %}
                    {% for photo_url in block.get('photos', []) %}
                    {% if photo_url %}
                    {% set filename = photo_url.split('/')[-1] %}
                    {% if filename %}
                    {% set _ = all_block_photos.append(filename) %}
                    {% endif %}
                    {% endif %}
                    {% endfor %}
                    {% elif block.get('type') == 'text' and block.get('documents') %}
                    {% for doc in block.get('documents', []) %}
                    {% if doc %}
                    {% set doc_url = doc.get('url', '') if doc is mapping else doc %}
                    {% if doc_url %}
                    {% set filename = doc_url.split('/')[-1] %}
                    {% if filename %}
                    {% set _ = all_block_documents.append(filename) %}
                    {% endif %}
                    {% endif %}
                    {% endif %}
                    {% endfor %}
                    {% endif %}
                    {% endfor %}

                    <!-- –î–æ–∫—É–º–µ–Ω—Ç—ã (–∏—Å–∫–ª—é—á–∞–µ–º –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏–∑ –±–ª–æ–∫–æ–≤) -->
                    {% set documents_fields = [
                    'charter', 'license', 'accreditation',
                    'pvr_students', 'pvr_workers',
                    'collective_agreement', 'annual_report', 'financial_statements',
                    'prescriptions_reports',
                    'admission_rules', 'education_programs', 'curriculum', 'calendar_schedule',
                    'training_schedule', 'control_forms',
                    'transfer_reinstatement', 'relations_termination',
                    'methodological_documents', 'local_regulations', 'other_local_acts',
                    'students_count_docs'
                    ] %}

                    {% set file_fields = [
                    'license_document', 'license_attachment', 'accreditation_document'
                    ] %}
                    {% set documents_filled_fields = [] %}
                    {% for field_name in documents_fields %}
                    {% set field_value = text_data.form_data.get(field_name) %}
                    {# –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞–∫ —Å—Ç—Ä–æ–∫ (—Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç), —Ç–∞–∫ –∏ dict {url, displayName,...} (file_with_name) #}
                    {% set field_url = '' %}
                    {% if field_value is string %}
                    {% set field_url = field_value %}
                    {% elif field_value is mapping and field_value.url is defined %}
                    {% set field_url = field_value.url %}
                    {% endif %}

                    {% if field_url and (field_url.startswith('/download_file/') or
                    field_url.startswith('/info/download_file/') or field_url.startswith('/sidebar/download_file/') or field_url.startswith('/static/uploads/')) %}
                    {% set has_block_document = false %}
                    {% if ',' in field_url %}
                    {% set files = field_url.split(',') %}
                    {% for file_url in files %}
                    {% set file_url = file_url.strip() %}
                    {% if file_url %}
                    {% set file_url_clean = file_url.split('|')[0] if '|' in file_url else file_url %}
                    {% set filename = file_url_clean.split('/')[-1] %}
                    {% for block_doc in all_block_documents %}
                    {% if block_doc == filename %}
                    {% set has_block_document = true %}
                    {% endif %}
                    {% endfor %}
                    {% endif %}
                    {% endfor %}
                    {% else %}
                    {% set field_value_clean = field_url.split('|')[0] if '|' in field_url else field_url %}
                    {% set filename = field_value_clean.split('/')[-1] %}
                    {% for block_doc in all_block_documents %}
                    {% if block_doc == filename %}
                    {% set has_block_document = true %}
                    {% endif %}
                    {% endfor %}
                    {% endif %}
                    {% if not has_block_document %}
                    {% set _ = documents_filled_fields.append(field_name) %}
                    {% endif %}
                    {% endif %}
                    {% endfor %}

                    {# –î–æ–∫—É–º–µ–Ω—Ç—ã –≤—Å–µ–≥–¥–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞ documents #}
                    {% if section.endpoint == 'documents' %}
                    {% set documents_page_cfg = section_headers.get('page_title') or {} %}
                    <div class="form-data-section" itemprop="documents" itemscope="itemscope"
                        itemtype="https://schema.org/ItemList" role="list">
                        {% if documents_page_cfg.get('visible', True) %}<h2>{{ documents_page_cfg.get('text') or '–î–æ–∫—É–º–µ–Ω—Ç—ã' }}</h2>{% endif %}
                        <table class="info-table" style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                            <tbody>
                                {% set documents_labels = {
                                'charter': '–£—Å—Ç–∞–≤ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏',
                                'license': '–õ–∏—Ü–µ–Ω–∑–∏—è –Ω–∞ –æ—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏',
                                'accreditation': '–°–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ –æ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–π –∞–∫–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏–∏',
                                'pvr_students': '–ü—Ä–∞–≤–∏–ª–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Ä–∞—Å–ø–æ—Ä—è–¥–∫–∞ –æ–±—É—á–∞—é—â–∏—Ö—Å—è (–≤–æ—Å–ø–∏—Ç–∞–Ω–Ω–∏–∫–æ–≤)',
                                'pvr_workers': '–ü—Ä–∞–≤–∏–ª–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Ç—Ä—É–¥–æ–≤–æ–≥–æ —Ä–∞—Å–ø–æ—Ä—è–¥–∫–∞',
                                'collective_agreement': '–ö–æ–ª–ª–µ–∫—Ç–∏–≤–Ω—ã–π –¥–æ–≥–æ–≤–æ—Ä',
                                'annual_report': '–û—Ç—á–µ—Ç –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö —Å–∞–º–æ–æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è (–ü—É–±–ª–∏—á–Ω—ã–π –¥–æ–∫–ª–∞–¥)',
                                'financial_statements': '–î–æ–∫—É–º–µ–Ω—Ç –æ –ø–æ—Ä—è–¥–∫–µ –æ–∫–∞–∑–∞–Ω–∏—è –ø–ª–∞—Ç–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —É—Å–ª—É–≥',
                                'prescriptions_reports': '–ü—Ä–µ–¥–ø–∏—Å–∞–Ω–∏—è –æ—Ä–≥–∞–Ω–æ–≤ –Ω–∞–¥–∑–æ—Ä–∞ –∏ –æ—Ç—á—ë—Ç—ã –æ–± –∏—Ö –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–∏',
                                'admission_rules': '–ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–∏–µ–º–∞ –æ–±—É—á–∞—é—â–∏—Ö—Å—è (–≤–æ—Å–ø–∏—Ç–∞–Ω–Ω–∏–∫–æ–≤)',
                                'education_programs': '–û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã',
                                'curriculum': '–£—á–µ–±–Ω—ã–π –ø–ª–∞–Ω',
                                'calendar_schedule': '–ö–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–π —É—á–µ–±–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫',
                                'training_schedule': '–†–µ–∂–∏–º –∑–∞–Ω—è—Ç–∏–π –æ–±—É—á–∞—é—â–∏—Ö—Å—è (–≤–æ—Å–ø–∏—Ç–∞–Ω–Ω–∏–∫–æ–≤)',
                                'control_forms': '–§–æ—Ä–º—ã, –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å –∏ –ø–æ—Ä—è–¥–æ–∫ —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏ –∏
                                –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–π –∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏–∏',
                                'transfer_reinstatement': '–ü–æ—Ä—è–¥–æ–∫ –∏ –æ—Å–Ω–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞, –æ—Ç—á–∏—Å–ª–µ–Ω–∏—è –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
                                –æ–±—É—á–∞—é—â–∏—Ö—Å—è',
                                'relations_termination': '–ü–æ—Ä—è–¥–æ–∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∏ –ø—Ä–µ–∫—Ä–∞—â–µ–Ω–∏—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π —Å –æ–±—É—á–∞—é—â–∏–º–∏—Å—è –∏
                                —Ä–æ–¥–∏—Ç–µ–ª—è–º–∏',
                                'methodological_documents': '–ú–µ—Ç–æ–¥–∏—á–µ—Å–∫–∏–µ –∏ –∏–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã',
                                'local_regulations': '–õ–æ–∫–∞–ª—å–Ω—ã–µ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –∞–∫—Ç—ã',
                                'other_local_acts': '–ò–Ω—ã–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –∞–∫—Ç—ã',
                                'students_count_docs': '–ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å –æ–±—É—á–∞—é—â–∏—Ö—Å—è',
                                'license_document': '–õ–∏—Ü–µ–Ω–∑–∏—è (–¥–æ–∫—É–º–µ–Ω—Ç)',
                                'license_attachment': '–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫ –ª–∏—Ü–µ–Ω–∑–∏–∏ (–¥–æ–∫—É–º–µ–Ω—Ç)',
                                'accreditation_document': '–°–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ –æ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–π –∞–∫–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏–∏ (–¥–æ–∫—É–º–µ–Ω—Ç)'
                                } %}

                                {% for field_name in documents_fields %}
                                {% set field_label = documents_labels.get(field_name, field_name | replace('_', ' ') |
                                title) %}
                                {% set field_value = text_data.form_data.get(field_name) %}
                                {% set field_files = [] %}
                                {% set field_files_filtered = [] %}
                                {% set has_files = False %}

                                {% if field_value %}
                                {% if field_value is iterable and field_value is not string and field_value is not
                                mapping %}
                                {# –ú–∞—Å—Å–∏–≤ file_with_name –æ–±—ä–µ–∫—Ç–æ–≤ #}
                                {% for file_obj in field_value %}
                                {% if file_obj is mapping and file_obj.url %}
                                {% set _ = field_files.append(file_obj.url ~ '|' ~ (file_obj.displayName or
                                file_obj.originalName or file_obj.filename)) %}
                                {% set has_files = True %}
                                {% endif %}
                                {% endfor %}
                                {% elif field_value is mapping %}
                                {# file_with_name –æ–±—ä–µ–∫—Ç (–æ–¥–∏–Ω–æ—á–Ω—ã–π) #}
                                {% if field_value.url %}
                                {% set _ = field_files.append(field_value.url ~ '|' ~ (field_value.displayName or
                                field_value.originalName or field_value.filename)) %}
                                {% set has_files = True %}
                                {% endif %}
                                {% elif field_value is string %}
                                {% if ',' in field_value %}
                                {% set files = field_value.split(',') %}
                                {% for file_url in files %}
                                {% set file_url = file_url.strip() %}
                                {% if file_url and (file_url.startswith('/download_file/') or
                                file_url.startswith('/info/download_file/') or file_url.startswith('/sidebar/download_file/') or file_url.startswith('/static/uploads/'))
                                %}
                                {% set _ = field_files.append(file_url) %}
                                {% set has_files = True %}
                                {% endif %}
                                {% endfor %}
                                {% else %}
                                {% if field_value.startswith('/download_file/') or
                                field_value.startswith('/info/download_file/') or
                                field_value.startswith('/static/uploads/') %}
                                {% set _ = field_files.append(field_value) %}
                                {% set has_files = True %}
                                {% endif %}
                                {% endif %}
                                {% endif %}
                                {% endif %}

                                {% set ns = namespace(seen=[]) %}
                                {% for file_url in field_files %}
                                {% set file_url_clean = file_url.split('|')[0] if '|' in file_url else file_url %}
                                {% set filename = file_url_clean.split('/')[-1] %}
                                {# –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∏–º—è: —É–±–∏—Ä–∞–µ–º —Å—É—Ñ—Ñ–∏–∫—Å—ã _2, _3 –∏ —Ç.–ø., –ø—Ä–∏–≤–æ–¥–∏–º –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É #}
                                {% set base_ext = filename.rsplit('.', 1) %}
                                {% set base = base_ext[0] %}
                                {% set ext = '.' ~ base_ext[1] if base_ext|length > 1 else '' %}
                                {% set base_parts = base.rsplit('_', 1) %}
                                {% if base_parts|length > 1 and base_parts[-1].isdigit() %}
                                {% set base_norm = base_parts[:-1]|join('_') %}
                                {% else %}
                                {% set base_norm = base %}
                                {% endif %}
                                {% set key = (base_norm ~ ext)|lower %}

                                {% if key not in ns.seen %}
                                {% set _ = ns.seen.append(key) %}

                                {% set is_block_doc = false %}
                                {% for block_doc in all_block_documents %}
                                {% if block_doc == filename %}
                                {% set is_block_doc = true %}
                                {% endif %}
                                {% endfor %}
                                {% set file_exists = file_url_clean | file_exists(section.endpoint) %}
                                {% if not is_block_doc and file_exists %}
                                {% set _ = field_files_filtered.append(file_url) %}
                                {% endif %}
                                {% endif %}
                                {% endfor %}

                                {# –í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞, –¥–∞–∂–µ –µ—Å–ª–∏ —Ñ–∞–π–ª –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç #}
                                {% set meta_date = text_data.form_data.get(field_name ~ '_date') %}
                                {% set meta_number = text_data.form_data.get(field_name ~ '_number') %}
                                {# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ #}
                                {% set doc_default = 'document' %}
                                {% if field_name == 'charter' %}
                                {% set doc_default = 'ustavDocLink' %}
                                {% elif field_name == 'license' or field_name == 'license_document' %}
                                {% set doc_default = 'licenseDocLink' %}
                                {% elif field_name == 'accreditation' or field_name == 'accreditation_document' %}
                                {% set doc_default = 'accreditationDocLink' %}
                                {% elif field_name == 'pvr_students' %}
                                {% set doc_default = 'localActStud' %}
                                {% elif field_name == 'pvr_workers' %}
                                {% set doc_default = 'localActOrder' %}
                                {% elif field_name == 'collective_agreement' %}
                                {% set doc_default = 'localActCollec' %}
                                {% elif field_name == 'annual_report' %}
                                {% set doc_default = 'reportEduDocLink' %}
                                {% elif field_name == 'prescriptions_reports' %}
                                {% set doc_default = 'prescriptionDocLink' %}
                                {% elif field_name == 'admission_rules' %}
                                {% set doc_default = 'priemDocLink' %}
                                {% elif field_name == 'training_schedule' %}
                                {% set doc_default = 'modeDocLink' %}
                                {% elif field_name == 'control_forms' %}
                                {% set doc_default = 'tekKontrolDocLink' %}
                                {% elif field_name == 'transfer_reinstatement' %}
                                {% set doc_default = 'perevodDocLink' %}
                                {% elif field_name == 'relations_termination' %}
                                {% set doc_default = 'vozDocLink' %}
                                {% endif %}
                                {% set document_itemprop = itemprop_map.get(field_name) or doc_default %}
                                <tr role="listitem">
                                    <td
                                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                                        {{ field_label }}</td>
                                    <td style="padding: 10px; border: 1px solid #e5e7eb; text-align: center;">
                                        {% if meta_date or meta_number %}
                                        <div style="font-size:0.9rem; color:#6b7280; margin-bottom:8px;">
                                            {% if meta_date %}
                                            <span>–î–∞—Ç–∞: {{ meta_date }}</span>
                                            {% endif %}
                                            {% if meta_date and meta_number %}
                                            <span> ¬∑ </span>
                                            {% endif %}
                                            {% if meta_number %}
                                            <span>–ù–æ–º–µ—Ä/–ø—Ä–∏–∫–∞–∑: {{ meta_number }}</span>
                                            {% endif %}
                                        </div>
                                        {% endif %}
                                        <div role="list">
                                            {% if field_files_filtered %}
                                            {% if field_files_filtered|length == 1 %}
                                            {% set file_url = field_files_filtered[0] %}
                                            {% set filename = file_url.split('/')[-1] %}
                                            {% set display_name = file_url.split('|')[-1] if '|' in file_url else
                                            filename %}
                                            <div role="listitem" itemprop="{{ document_itemprop }}"
                                                itemscope="itemscope" itemtype="https://schema.org/MediaObject"
                                                style="display:inline-block;">
                                                <a href="{{ filename | info_file_url(section.endpoint) }}" download
                                                    class="download-link" itemprop="contentUrl"
                                                    aria-label="–°–∫–∞—á–∞—Ç—å {{ display_name }}">
                                                    üìÑ –°–∫–∞—á–∞—Ç—å {{ display_name }}
                                                </a>
                                            </div>
                                            {% else %}
                                            <div role="list"
                                                style="display:flex; flex-direction:column; align-items:center; gap:8px;">
                                                {% for file_url in field_files_filtered %}
                                                {% set filename = file_url.split('/')[-1] %}
                                                {% set display_name = file_url.split('|')[-1] if '|' in file_url else
                                                filename %}
                                                <div role="listitem" itemprop="{{ document_itemprop }}"
                                                    itemscope="itemscope" itemtype="https://schema.org/MediaObject"
                                                    style="display:inline-block;">
                                                    <a href="{{ filename | info_file_url(section.endpoint) }}" download
                                                        class="download-link" itemprop="contentUrl"
                                                        aria-label="–°–∫–∞—á–∞—Ç—å {{ display_name }}">
                                                        üìÑ {{ display_name }}
                                                    </a>
                                                </div>
                                                {% endfor %}
                                            </div>
                                            {% endif %}
                                            {% else %}
                                            <div role="listitem" itemprop="{{ document_itemprop }}"
                                                itemscope="itemscope" itemtype="https://schema.org/MediaObject"
                                                style="display:inline-block;">
                                                <span itemprop="contentUrl">—Ñ–∞–π–ª –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</span>
                                            </div>
                                            {% endif %}
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% endif %}

                    <!-- –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ -->
                    {% if section.endpoint == 'education' %}
                    {% set education_fields = [
                    'title', 'text',
                    'elementary_education', 'basic_education', 'secondary_education',
                    'curriculum_noo', 'curriculum_ooo', 'curriculum_soo',
                    'calendar_schedule',
                    'student_count_elementary', 'student_count_basic', 'student_count_secondary',
                    'student_numbers_noo', 'student_numbers_ooo', 'student_numbers_soo',
                    'federal_budget_elementary', 'federal_budget_basic', 'federal_budget_secondary',
                    'regional_budget_elementary', 'regional_budget_basic', 'regional_budget_secondary',
                    'local_budget_elementary', 'local_budget_basic', 'local_budget_secondary',
                    'contract_education_elementary', 'contract_education_basic', 'contract_education_secondary',
                    'foreign_students_elementary', 'foreign_students_basic', 'foreign_students_secondary',
                    'education_languages', 'professional_programs', 'graduate_employment',
                    'student_numbers_document'
                    ] %}
                    {# –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤—Å–µ–≥–¥–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è #}
                    {% set education_page_cfg = section_headers.get('page_title') or {} %}
                    <div class="form-data-section" itemprop="eduAccred" itemscope="itemscope"
                        itemtype="https://schema.org/ItemList" role="list">
                        {% if education_page_cfg.get('visible', True) %}<h2>{{ education_page_cfg.get('text') or '–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ' }}</h2>{% endif %}
                        
                        {# –ë–ª–æ–∫ "–û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã" (implemented_programs) ‚Äî eduOp –≤ —Ä–∞–∑–º–µ—Ç–∫–µ –¥–ª—è VIKON #}
                        {% set implemented_programs_value = text_data.form_data.get('implemented_programs') %}
                        {% if implemented_programs_value %}
                        <div class="education-programs-section" style="margin-bottom: 30px;">
                            <h3 style="font-size: 1.5em; color: #2563eb; margin-bottom: 16px; font-weight: 600;">–û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã</h3>
                            <ul style="list-style: none; padding: 0; margin: 0;" itemprop="eduOp" itemscope="itemscope" itemtype="https://schema.org/ItemList" role="list">
                                {% if implemented_programs_value is iterable and implemented_programs_value is not string and implemented_programs_value is not mapping %}
                                    {% for program in implemented_programs_value %}
                                        {% set prog_name = program.get('name') if program is mapping else (program or '') %}
                                        {% set prog_url = program.get('url') if program is mapping else '' %}
                                        {% if program and (prog_name or prog_url) %}
                                            <li style="margin-bottom: 12px; padding-left: 20px; position: relative;" role="listitem" itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/EducationalProgram">
                                                <span style="position: absolute; left: 0;">‚Ä¢</span>
                                                <span itemprop="name">{{ prog_name or '‚Äî' }}</span>
                                                {% if prog_url %}
                                                    <a href="{{ prog_url }}" style="color: #2563eb; text-decoration: none; margin-left: 8px;" itemprop="url">(—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ)</a>
                                                {% endif %}
                                            </li>
                                        {% endif %}
                                    {% endfor %}
                                {% elif implemented_programs_value is string %}
                                    {% for program_line in implemented_programs_value.split('\n') %}
                                        {% set program_line = program_line.strip() %}
                                        {% if program_line %}
                                            {% if '|' in program_line %}
                                                {% set program_parts = program_line.split('|', 1) %}
                                                {% set program_name = program_parts[0].strip() %}
                                                {% set program_url = program_parts[1].strip() if program_parts|length > 1 else '' %}
                                            {% else %}
                                                {% set program_name = program_line %}
                                                {% set program_url = '' %}
                                            {% endif %}
                                            <li style="margin-bottom: 12px; padding-left: 20px; position: relative;" role="listitem" itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/EducationalProgram">
                                                <span style="position: absolute; left: 0;">‚Ä¢</span>
                                                <span itemprop="name">{{ program_name }}</span>
                                                {% if program_url %}
                                                    <a href="{{ program_url }}" style="color: #2563eb; text-decoration: none; margin-left: 8px;" itemprop="url">(—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ)</a>
                                                {% endif %}
                                            </li>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                            </ul>
                        </div>
                        {% endif %}
                        
                        {# –ë–ª–æ–∫ "–ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã" (adapted_programs) #}
                        {% set adapted_programs_value = text_data.form_data.get('adapted_programs') %}
                        {% if adapted_programs_value %}
                        <div class="education-programs-section" style="margin-bottom: 30px;">
                            <h3 style="font-size: 1.5em; color: #2563eb; margin-bottom: 16px; font-weight: 600;">–ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã</h3>
                            <ul style="list-style: none; padding: 0; margin: 0;" itemprop="eduAdOp" itemscope="itemscope" itemtype="https://schema.org/ItemList" role="list">
                                {% if adapted_programs_value is iterable and adapted_programs_value is not string and adapted_programs_value is not mapping %}
                                    {% for program in adapted_programs_value %}
                                        {% set prog_name = program.get('name') if program is mapping else (program or '') %}
                                        {% set prog_url = program.get('url') if program is mapping else '' %}
                                        {% if program and (prog_name or prog_url) %}
                                            <li style="margin-bottom: 12px; padding-left: 20px; position: relative;" role="listitem" itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/EducationalProgram">
                                                <span style="position: absolute; left: 0;">‚Ä¢</span>
                                                <span itemprop="name">{{ prog_name or '‚Äî' }}</span>
                                                {% if prog_url %}
                                                    <a href="{{ prog_url }}" style="color: #2563eb; text-decoration: none; margin-left: 8px;" itemprop="url">(—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ)</a>
                                                {% endif %}
                                            </li>
                                        {% endif %}
                                    {% endfor %}
                                {% elif adapted_programs_value is string %}
                                    {% for program_line in adapted_programs_value.split('\n') %}
                                        {% set program_line = program_line.strip() %}
                                        {% if program_line %}
                                            {% if '|' in program_line %}
                                                {% set program_parts = program_line.split('|', 1) %}
                                                {% set program_name = program_parts[0].strip() %}
                                                {% set program_url = program_parts[1].strip() if program_parts|length > 1 else '' %}
                                            {% else %}
                                                {% set program_name = program_line %}
                                                {% set program_url = '' %}
                                            {% endif %}
                                            <li style="margin-bottom: 12px; padding-left: 20px; position: relative;" role="listitem" itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/EducationalProgram">
                                                <span style="position: absolute; left: 0;">‚Ä¢</span>
                                                <span itemprop="name">{{ program_name }}</span>
                                                {% if program_url %}
                                                    <a href="{{ program_url }}" style="color: #2563eb; text-decoration: none; margin-left: 8px;" itemprop="url">(—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ)</a>
                                                {% endif %}
                                            </li>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                            </ul>
                        </div>
                        {% endif %}
                        
                        <table class="info-table" style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                            <tbody>
                                {% set education_labels = {
                                'title': '–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è',
                                'text': '–û–ø–∏—Å–∞–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è',
                                'implemented_programs': '–†–µ–∞–ª–∏–∑—É–µ–º—ã–µ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã',
                                'adapted_programs': '–ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã',
                                'elementary_education': '–ù–∞—á–∞–ª—å–Ω–æ–µ –æ–±—â–µ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ',
                                'basic_education': '–û—Å–Ω–æ–≤–Ω–æ–µ –æ–±—â–µ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ',
                                'secondary_education': '–°—Ä–µ–¥–Ω–µ–µ –æ–±—â–µ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ',
                                'curriculum_elementary': '–£—á–µ–±–Ω—ã–π –ø–ª–∞–Ω –ù–û–û',
                                'curriculum_basic': '–£—á–µ–±–Ω—ã–π –ø–ª–∞–Ω –û–û–û',
                                'curriculum_secondary': '–£—á–µ–±–Ω—ã–π –ø–ª–∞–Ω –°–û–û',
                                'curriculum_noo': '–£—á–µ–±–Ω—ã–π –ø–ª–∞–Ω –ù–û–û',
                                'curriculum_ooo': '–£—á–µ–±–Ω—ã–π –ø–ª–∞–Ω –û–û–û',
                                'curriculum_soo': '–£—á–µ–±–Ω—ã–π –ø–ª–∞–Ω –°–û–û',
                                'calendar_schedule': '–ö–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–π —É—á–µ–±–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫',
                                'student_count_elementary': '–ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å –æ–±—É—á–∞—é—â–∏—Ö—Å—è –ù–û–û',
                                'student_count_basic': '–ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å –æ–±—É—á–∞—é—â–∏—Ö—Å—è –û–û–û',
                                'student_count_secondary': '–ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å –æ–±—É—á–∞—é—â–∏—Ö—Å—è –°–û–û',
                                'student_numbers_noo': '–ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å –æ–±—É—á–∞—é—â–∏—Ö—Å—è –ù–û–û',
                                'student_numbers_ooo': '–ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å –æ–±—É—á–∞—é—â–∏—Ö—Å—è –û–û–û',
                                'student_numbers_soo': '–ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å –æ–±—É—á–∞—é—â–∏—Ö—Å—è –°–û–û',
                                'federal_budget_elementary': '–ó–∞ —Å—á–µ—Ç —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω–æ–≥–æ –±—é–¥–∂–µ—Ç–∞ –ù–û–û',
                                'federal_budget_basic': '–ó–∞ —Å—á–µ—Ç —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω–æ–≥–æ –±—é–¥–∂–µ—Ç–∞ –û–û–û',
                                'federal_budget_secondary': '–ó–∞ —Å—á–µ—Ç —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω–æ–≥–æ –±—é–¥–∂–µ—Ç–∞ –°–û–û',
                                'regional_budget_elementary': '–ó–∞ —Å—á–µ—Ç –±—é–¥–∂–µ—Ç–∞ —Å—É–±—ä–µ–∫—Ç–∞ –†–§ –ù–û–û',
                                'regional_budget_basic': '–ó–∞ —Å—á–µ—Ç –±—é–¥–∂–µ—Ç–∞ —Å—É–±—ä–µ–∫—Ç–∞ –†–§ –û–û–û',
                                'regional_budget_secondary': '–ó–∞ —Å—á–µ—Ç –±—é–¥–∂–µ—Ç–∞ —Å—É–±—ä–µ–∫—Ç–∞ –†–§ –°–û–û',
                                'local_budget_elementary': '–ó–∞ —Å—á–µ—Ç –º–µ—Å—Ç–Ω–æ–≥–æ –±—é–¥–∂–µ—Ç–∞ –ù–û–û',
                                'local_budget_basic': '–ó–∞ —Å—á–µ—Ç –º–µ—Å—Ç–Ω–æ–≥–æ –±—é–¥–∂–µ—Ç–∞ –û–û–û',
                                'local_budget_secondary': '–ó–∞ —Å—á–µ—Ç –º–µ—Å—Ç–Ω–æ–≥–æ –±—é–¥–∂–µ—Ç–∞ –°–û–û',
                                'contract_education_elementary': '–ü–æ –¥–æ–≥–æ–≤–æ—Ä–∞–º –æ–± –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏ –ù–û–û',
                                'contract_education_basic': '–ü–æ –¥–æ–≥–æ–≤–æ—Ä–∞–º –æ–± –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏ –û–û–û',
                                'contract_education_secondary': '–ü–æ –¥–æ–≥–æ–≤–æ—Ä–∞–º –æ–± –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏ –°–û–û',
                                'foreign_students_elementary': '–ò–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–µ –≥—Ä–∞–∂–¥–∞–Ω–µ –ù–û–û',
                                'foreign_students_basic': '–ò–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–µ –≥—Ä–∞–∂–¥–∞–Ω–µ –û–û–û',
                                'foreign_students_secondary': '–ò–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–µ –≥—Ä–∞–∂–¥–∞–Ω–µ –°–û–û',
                                'student_numbers_document': '–î–æ–∫—É–º–µ–Ω—Ç –æ —á–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç–∏ –æ–±—É—á–∞—é—â–∏—Ö—Å—è',
                                'education_languages': '–Ø–∑—ã–∫–∏, –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ',
                                'professional_programs': '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã',
                                'graduate_employment': '–¢—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤—ã–ø—É—Å–∫–Ω–∏–∫–æ–≤'
                                } %}

                                {# –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π –Ω–∞ –∞—Ç—Ä–∏–±—É—Ç—ã itemprop #}
                                {% set education_itemprops = {
                                'implemented_programs': 'eduOp',
                                'adapted_programs': 'eduAdOp',
                                'elementary_education': 'eduOp',
                                'basic_education': 'eduOp',
                                'secondary_education': 'eduOp',
                                'curriculum_elementary': 'educationPlan',
                                'curriculum_basic': 'educationPlan',
                                'curriculum_secondary': 'educationPlan',
                                'curriculum_noo': 'educationPlan',
                                'curriculum_ooo': 'educationPlan',
                                'curriculum_soo': 'educationPlan',
                                'calendar_schedule': 'educationSchedule',
                                'student_numbers_document': 'eduChislenEl',
                                'education_languages': 'languageEl',
                                'graduate_employment': 'graduateJob'
                                } %}

                                {% for field_name in education_fields %}
                                {% set field_label = education_labels.get(field_name, field_name | replace('_', ' ') |
                                title) %}
                                {% set field_value = text_data.form_data.get(field_name) %}
                                {% set is_filled = field_value and (field_value is not mapping or field_value.get('url')
                                or field_value.get('filename')) and (field_value is not string or field_value | trim) %}
                                {% set field_itemprop = education_itemprops.get(field_name, '') %}
                                {% set is_main_tag = field_name in ['implemented_programs', 'adapted_programs',
                                'elementary_education', 'basic_education', 'secondary_education'] %}
                                {% set document_itemprop_map = {
                                'curriculum_elementary': 'educationPlan',
                                'curriculum_basic': 'educationPlan',
                                'curriculum_secondary': 'educationPlan',
                                'curriculum_noo': 'educationPlan',
                                'curriculum_ooo': 'educationPlan',
                                'curriculum_soo': 'educationPlan',
                                'calendar_schedule': 'educationSchedule',
                                'student_numbers_document': 'eduChislenEl',
                                'education_languages': 'languageEl'
                                } %}
                                {% set document_itemprop = document_itemprop_map.get(field_name, 'document') %}
                                <tr role="listitem" {% if is_main_tag %}itemprop="{{ field_itemprop }}"
                                    itemscope="itemscope" itemtype="https://schema.org/EducationalProgram" {% endif %}>
                                    <td
                                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                                        {{ field_label }}</td>
                                    <td style="padding: 10px; border: 1px solid #e5e7eb;">
                                        {% if 'document' in field_name or 'curriculum' in field_name or 'schedule' in
                                        field_name %}
                                        {{ render_document_field(field_name, field_label, field_value, section.endpoint,
                                        document_itemprop) }}
                                        {% elif is_filled %}
                                        {% if field_itemprop and not is_main_tag %}<span
                                            itemprop="{{ field_itemprop }}">{{ render_field_content(field_name,
                                            field_label, field_value, section.endpoint, false) }}</span>{% else %}{{
                                        render_field_content(field_name, field_label, field_value, section.endpoint, false)
                                        }}{% endif %}
                                        {% else %}
                                        {% if field_itemprop and not is_main_tag %}<span
                                            itemprop="{{ field_itemprop }}">–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>{% else %}<span>–Ω–µ
                                            –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>{% endif %}
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% endif %}

                    <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–∏—Å–∫–ª—é—á–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ –±–ª–æ–∫–æ–≤) -->
                    {% set images_field = text_data.form_data.get('images', '') %}
                    {% if images_field %}
                    {% set page_images_raw = [] %}
                    {% set page_images = [] %}
                    {% if images_field is string %}
                    {% if ',' in images_field %}
                    {% set image_urls = images_field.split(',') %}
                    {% for image_url in image_urls %}
                    {% set image_url = image_url.strip() %}
                    {% if image_url and (image_url.startswith('/download_file/') or
                    image_url.startswith('/info/download_file/') or image_url.startswith('/sidebar/download_file/') or image_url.startswith('/static/uploads/')) %}
                    {% set _ = page_images_raw.append(image_url) %}
                    {% endif %}
                    {% endfor %}
                    {% else %}
                    {% if images_field.startswith('/download_file/') or images_field.startswith('/info/download_file/')
                    or images_field.startswith('/sidebar/download_file/') or images_field.startswith('/static/uploads/') %}
                    {% set _ = page_images_raw.append(images_field) %}
                    {% endif %}
                    {% endif %}
                    {% endif %}

                    {% for image_url in page_images_raw %}
                    {% set image_url_clean = image_url.split('|')[0] if '|' in image_url else image_url %}
                    {% set filename = image_url_clean.split('/')[-1] %}
                    {% set is_block_photo = false %}
                    {% for block_photo in all_block_photos %}
                    {% if block_photo == filename %}
                    {% set is_block_photo = true %}
                    {% endif %}
                    {% endfor %}
                    {% if not is_block_photo %}
                    {% set _ = page_images.append(image_url) %}
                    {% endif %}
                    {% endfor %}

                    {% if page_images %}
                    {% set images_title_cfg = section_headers.get('images_title') or {} %}
                    <div class="form-data-section page-images-section" itemprop="photos" itemscope="itemscope"
                        itemtype="https://schema.org/ImageGallery" role="list">
                        {% if images_title_cfg.get('visible', True) %}<h2>{{ images_title_cfg.get('text') or '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è' }}</h2>{% endif %}
                        <div class="page-images-gallery">
                            {% for image_url in page_images %}
                            {% set image_url_clean = image_url.split('|')[0] if '|' in image_url else image_url %}
                            <div class="page-image-item" role="listitem" itemprop="photo" itemscope="itemscope"
                                itemtype="https://schema.org/ImageObject" onclick="openImgPreview('{{ image_url_clean | e }}')">
                                <img src="{{ image_url_clean }}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" class="page-image"
                                    onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg%20xmlns%3D%27http%3A//www.w3.org/2000/svg%27%20width%3D%27400%27%20height%3D%27400%27%3E%3Crect%20width%3D%27100%25%27%20height%3D%27100%25%27%20fill%3D%27%23f1f5f9%27/%3E%3Ctext%20x%3D%2750%25%27%20y%3D%2750%25%27%20dominant-baseline%3D%27middle%27%20text-anchor%3D%27middle%27%20fill%3D%27%2394a3b8%27%20font-family%3D%27Arial%27%20font-size%3D%2718%27%3E%D0%A4%D0%BE%D1%82%D0%BE%3C/text%3E%3C/svg%3E';" loading="lazy" itemprop="contentUrl">
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    {% endif %}

                    {# –î–æ–∫—É–º–µ–Ω—Ç—ã –±–æ–∫–æ–≤—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ (–æ–±—â–∏–π form_data.documents) #}
                    {% set sidebar_documents_field = text_data.form_data.get('documents', '') %}
                    {% if sidebar_documents_field %}
                    {% set sidebar_docs_raw = [] %}
                    {% set sidebar_docs = [] %}
                    {% if sidebar_documents_field is string %}
                    {% if ',' in sidebar_documents_field %}
                    {% set doc_urls = sidebar_documents_field.split(',') %}
                    {% for doc_url in doc_urls %}
                    {% set doc_url = doc_url.strip() %}
                    {% set doc_url_clean = doc_url.split('|')[0] if '|' in doc_url else doc_url %}
                    {% if doc_url_clean and (doc_url_clean.startswith('/download_file/') or
                    doc_url_clean.startswith('/info/download_file/') or doc_url_clean.startswith('/sidebar/download_file/') or
                    doc_url_clean.startswith('/static/uploads/') or doc_url_clean.startswith('/food/')) %}
                    {% set _ = sidebar_docs_raw.append(doc_url) %}
                    {% endif %}
                    {% endfor %}
                    {% else %}
                    {% set doc_url_clean = sidebar_documents_field.split('|')[0] if '|' in sidebar_documents_field else sidebar_documents_field %}
                    {% if doc_url_clean.startswith('/download_file/') or doc_url_clean.startswith('/info/download_file/') or
                    doc_url_clean.startswith('/sidebar/download_file/') or doc_url_clean.startswith('/static/uploads/') or doc_url_clean.startswith('/food/') %}
                    {% set _ = sidebar_docs_raw.append(sidebar_documents_field) %}
                    {% endif %}
                    {% endif %}
                    {% endif %}

                    {% for doc_entry in sidebar_docs_raw %}
                    {% set doc_url = doc_entry.split('|')[0] if '|' in doc_entry else doc_entry %}
                    {% set doc_name = doc_entry.split('|')[-1] if '|' in doc_entry else (doc_url.split('/')[-1] if doc_url else '–î–æ–∫—É–º–µ–Ω—Ç') %}
                    {% set filename = doc_url.split('/')[-1] if doc_url else '' %}
                    {% set is_block_document = false %}
                    {% for block_doc in all_block_documents %}
                    {% if block_doc == filename %}
                    {% set is_block_document = true %}
                    {% endif %}
                    {% endfor %}
                    {% if doc_url and not is_block_document %}
                    {% set _ = sidebar_docs.append({'url': doc_url, 'name': doc_name}) %}
                    {% endif %}
                    {% endfor %}

                    {% if sidebar_docs %}
                    {% set documents_title_cfg = section_headers.get('documents_title') or {} %}
                    <div class="form-data-section" itemprop="documents" itemscope="itemscope"
                        itemtype="https://schema.org/ItemList" role="list">
                        {% if documents_title_cfg.get('visible', True) %}<h2>{{ documents_title_cfg.get('text') or '–î–æ–∫—É–º–µ–Ω—Ç—ã' }}</h2>{% endif %}
                        <div class="documents-list" style="display: flex; flex-direction: column; gap: 8px;">
                            {% for d in sidebar_docs %}
                            <div class="document-item" role="listitem" itemprop="itemListElement" itemscope="itemscope"
                                itemtype="https://schema.org/MediaObject">
                                <a href="{{ d.url }}" target="_blank" class="document-link"
                                    style="display: flex; align-items: center; gap: 10px; padding: 8px 0; text-decoration: none; color: #2563eb; transition: color 0.2s; border-bottom: 1px solid transparent;"
                                    itemprop="contentUrl">
                                    <span style="font-size: 18px; flex-shrink: 0;">üìÑ</span>
                                    <span style="font-size: 1rem; font-weight: 400; line-height: 1.5;">{{ d.name }}</span>
                                </a>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    {% endif %}

                    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –±–æ–∫–æ–≤—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ -->
                    {% if section.endpoint != 'nutrition-dishes-archive' and text_data.form_data.get('content') %}
                    <div class="form-data-section">
                        <div class="content-text">
                            {{ text_data.form_data.content | linkify_site }}
                        </div>
                    </div>
                    {% endif %}

                    {% endif %}

                    {# –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å –º–∏–∫—Ä–æ—Ä–∞–∑–º–µ—Ç–∫–æ–π –¥–ª—è —Ä–∞–∑–¥–µ–ª–æ–≤ 5-14 #}
                    {% set section_microdata = {
                    'standards': {'itemprop': 'eduStandards', 'itemtype': 'https://schema.org/ItemList',
                    'item_itemprop': None},
                    'management': {'itemprop': 'management', 'itemtype': 'https://schema.org/ItemList', 'item_itemprop':
                    'managementBody'},
                    'teachers': {'itemprop': 'teachingStaff', 'itemtype': 'https://schema.org/ItemList',
                    'item_itemprop': 'teacher'},
                    'facilities': {'itemprop': 'facilities', 'itemtype': 'https://schema.org/ItemList', 'item_itemprop':
                    None},
                    'scholarships': {'itemprop': 'scholarships', 'itemtype': 'https://schema.org/ItemList',
                    'item_itemprop': 'supportMeasure'},
                    'paid-services': {'itemprop': 'paidEduServices', 'itemtype': 'https://schema.org/ItemList',
                    'item_itemprop': 'service'},
                    'finance': {'itemprop': 'financialActivity', 'itemtype': 'https://schema.org/ItemList',
                    'item_itemprop': 'report'},
                    'vacancies': {'itemprop': 'vacantPlaces', 'itemtype': 'https://schema.org/ItemList',
                    'item_itemprop': None},
                    'international': {'itemprop': 'internationalCooperation', 'itemtype': 'https://schema.org/ItemList',
                    'item_itemprop': 'partner'},
                    'food': {'itemprop': 'cateringOrganization', 'itemtype': 'https://schema.org/ItemList',
                    'item_itemprop': None}
                    } %}

                    {% if section.endpoint in section_microdata %}
                    {% set microdata_config = section_microdata[section.endpoint] %}
                    {% if section.endpoint == 'standards' %}
                    {% set has_table_content = true %}
                    {% set standards_page_cfg = section_headers.get('page_title') or {} %}
                    <div class="form-data-section" itemprop="{{ microdata_config.itemprop }}" itemscope="itemscope"
                        itemtype="{{ microdata_config.itemtype }}" role="list">
                        {% if standards_page_cfg.get('visible', True) %}<h2>{{ standards_page_cfg.get('text') or section.title }}</h2>{% endif %}
                        <table class="info-table" style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                            <tbody>
                                {% set standards_fields = ['title', 'text', 'federal_standards', 'federal_requirements',
                                'local_standards', 'standards_documents', 'requirements_documents',
                                'implementation_info'] %}
                                {% set standards_labels = {
                                'title': '–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤',
                                'text': '–û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤',
                                'federal_standards': '–§–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã',
                                'federal_requirements': '–§–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è',
                                'local_standards': '–õ–æ–∫–∞–ª—å–Ω—ã–µ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –∞–∫—Ç—ã, —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–∏—Ä—É—é—â–∏–µ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—É—é
                                –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å',
                                'standards_documents': '–î–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º',
                                'requirements_documents': '–î–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º',
                                'implementation_info': '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤'
                                } %}
                                {# –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π –Ω–∞ –∞—Ç—Ä–∏–±—É—Ç—ã itemprop —Å–æ–≥–ª–∞—Å–Ω–æ —Ç–∞–±–ª–∏—Ü–µ 3.6.1 #}
                                {% set standards_itemprops = {
                                'federal_standards': 'eduFedDoc',
                                'standards_documents': 'eduStandartDoc',
                                'federal_requirements': 'eduFedTreb',
                                'requirements_documents': 'eduStandartTreb',
                                'local_standards': 'eduStandartTreb'
                                } %}
                                {% set standards_document_itemprops = {
                                'standards_documents': 'eduStandartDoc',
                                'requirements_documents': 'eduStandartTreb'
                                } %}
                                {% for field_name in standards_fields %}
                                {% set field_label = standards_labels.get(field_name, field_name | replace('_', ' ') |
                                title) %}
                                {% set field_value = text_data.form_data.get(field_name) if text_data and
                                text_data.form_data else None %}
                                {% set is_filled = field_value and (field_value is not mapping or field_value.get('url')
                                or field_value.get('filename')) and (field_value is not string or field_value | trim) %}
                                {% set field_itemprop = standards_itemprops.get(field_name, '') %}
                                {% set document_itemprop = standards_document_itemprops.get(field_name, 'document') %}
                                <tr role="listitem" {% if field_itemprop %}itemprop="{{ field_itemprop }}" {% endif %}>
                                    <td
                                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                                        {{ field_label }}</td>
                                    <td style="padding: 10px; border: 1px solid #e5e7eb;">
                                        {% if 'document' in field_name or 'file' in field_name %}
                                        {{ render_document_field(field_name, field_label, field_value, section.endpoint,
                                        document_itemprop) }}
                                        {% elif is_filled %}
                                        {{ render_field_content(field_name, field_label, field_value, section.endpoint, false)
                                        }}
                                        {% else %}
                                        <span>–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% elif section.endpoint == 'management' %}
                    {% set has_table_content = true %}
                    {% set management_page_cfg = section_headers.get('page_title') or {} %}
                    <div class="form-data-section" itemprop="{{ microdata_config.itemprop }}" itemscope="itemscope"
                        itemtype="{{ microdata_config.itemtype }}" role="list">
                        {% if management_page_cfg.get('visible', True) %}<h2>{{ management_page_cfg.get('text') or section.title }}</h2>{% endif %}
                        <table class="info-table" style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                            <tbody>
                                {% set management_fields = ['title', 'text', 'director_name', 'director_position',
                                'director_phone', 'director_email', 'deputy_directors', 'management_structure',
                                'management_documents'] %}
                                {% set management_labels = {
                                'title': '–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞',
                                'text': '–û–ø–∏—Å–∞–Ω–∏–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞',
                                'director_name': '–§–ò–û —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏',
                                'director_position': '–î–æ–ª–∂–Ω–æ—Å—Ç—å —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è',
                                'director_phone': '–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ —Ç–µ–ª–µ—Ñ–æ–Ω—ã —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è',
                                'director_email': '–ê–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è',
                                'deputy_directors': '–ó–∞–º–µ—Å—Ç–∏—Ç–µ–ª–∏ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è',
                                'management_structure': '–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è',
                                'management_documents': '–î–æ–∫—É–º–µ–Ω—Ç—ã —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞'
                                } %}
                                {# –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π –Ω–∞ –∞—Ç—Ä–∏–±—É—Ç—ã itemprop —Å–æ–≥–ª–∞—Å–Ω–æ —Ç–∞–±–ª–∏—Ü–µ #}
                                {% set management_itemprops = {
                                'director_name': 'fio',
                                'director_position': 'post',
                                'director_phone': 'telephone',
                                'director_email': 'email'
                                } %}

                                {% for field_name in management_fields %}
                                {% set field_label = management_labels.get(field_name, field_name | replace('_', ' ') |
                                title) %}
                                {% set field_value = text_data.form_data.get(field_name) if text_data and
                                text_data.form_data else None %}
                                {% set is_filled = field_value and (field_value is not mapping or field_value.get('url')
                                or field_value.get('filename')) and (field_value is not string or field_value | trim) %}
                                {% set field_itemprop = management_itemprops.get(field_name, '') %}
                                {% set is_director_field = field_name in ['director_name', 'director_position',
                                'director_phone', 'director_email'] %}
                                {% set is_deputy_field = field_name == 'deputy_directors' %}

                                {% if is_director_field %}
                                {# –ü–æ–ª—è —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è - –≥—Ä—É–ø–ø–∏—Ä—É–µ–º –≤ rucovodstvo #}
                                {% if field_name == 'director_name' %}
                                {# –ù–∞—á–∞–ª–æ –±–ª–æ–∫–∞ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è - –≥–ª–∞–≤–Ω—ã–π —Ç–µ–≥ #}
                                <tr role="listitem">
                                    <td colspan="2" style="padding: 0;">
                                        <div itemprop="rucovodstvo" itemscope="itemscope"
                                            itemtype="https://schema.org/Person">
                                            <table style="width: 100%; border-collapse: collapse;">
                                                <tbody>
                                                    {% endif %}
                                                    <tr>
                                                        <td
                                                            style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                                                            {{ field_label }}</td>
                                                        <td style="padding: 10px; border: 1px solid #e5e7eb;">
                                                            {% if is_filled %}
                                                            <span itemprop="{{ field_itemprop }}">{{
                                                                render_field_content(field_name, field_label,
                                                                field_value, section.endpoint, false) }}</span>
                                                            {% else %}
                                                            <span itemprop="{{ field_itemprop }}">–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>
                                                            {% endif %}
                                                        </td>
                                                    </tr>
                                                    {% if field_name == 'director_email' %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </td>
                                </tr>
                                {# –ö–æ–Ω–µ—Ü –±–ª–æ–∫–∞ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è #}
                                {% endif %}
                                {% elif is_deputy_field %}
                                {# –ó–∞–º–µ—Å—Ç–∏—Ç–µ–ª–∏ - –≥—Ä—É–ø–ø–∏—Ä—É–µ–º –≤ rucovodstvoZam #}
                                <tr role="listitem" itemprop="rucovodstvoZam" itemscope="itemscope"
                                    itemtype="https://schema.org/Person">
                                    <td
                                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                                        {{ field_label }}</td>
                                    <td style="padding: 10px; border: 1px solid #e5e7eb;">
                                        {% if is_filled %}
                                        <span itemprop="{{ field_itemprop }}">{{ render_field_content(field_name,
                                            field_label, field_value, section.endpoint, false) }}</span>
                                        {% else %}
                                        <span itemprop="{{ field_itemprop }}">–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% else %}
                                {# –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è #}
                                <tr role="listitem" itemprop="{{ field_itemprop or '' }}">
                                    <td
                                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                                        {{ field_label }}</td>
                                    <td style="padding: 10px; border: 1px solid #e5e7eb;">
                                        {% if 'document' in field_name or 'file' in field_name %}
                                        {{ render_document_field(field_name, field_label, field_value, section.endpoint, 'document', false) }}
                                        {% elif is_filled %}
                                        {% if field_itemprop %}<span itemprop="{{ field_itemprop }}">{{
                                            render_field_content(field_name, field_label, field_value, section.endpoint, false)
                                            }}</span>{% else %}{{ render_field_content(field_name, field_label,
                                        field_value, section.endpoint, false) }}{% endif %}
                                        {% else %}
                                        {% if field_itemprop %}<span itemprop="{{ field_itemprop }}">–Ω–µ
                                            –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>{% else %}<span>–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>{% endif %}
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endif %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% elif section.endpoint == 'teachers' %}
                    {% set has_table_content = true %}
                    {% set teachers_page_cfg = section_headers.get('page_title') or {} %}
                    <div class="form-data-section" itemprop="{{ microdata_config.itemprop }}" itemscope="itemscope"
                        itemtype="{{ microdata_config.itemtype }}" role="list">
                        {% if teachers_page_cfg.get('visible', True) %}<h2>{{ teachers_page_cfg.get('text') or section.title }}</h2>{% endif %}
                        <table class="info-table" style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                            <tbody>
                                {% set teachers_fields = ['title', 'text', 'total_teachers', 'teachers_with_education',
                                'teachers_with_category', 'teachers_qualification', 'teachers_development',
                                'teachers_documents'] %}
                                {% set teachers_labels = {
                                'title': '–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ –ø–µ–¥–∞–≥–æ–≥–æ–≤',
                                'text': '–û–ø–∏—Å–∞–Ω–∏–µ –ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —Å–æ—Å—Ç–∞–≤–∞',
                                'total_teachers': '–û–±—â–∞—è —á–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å –ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏—Ö —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤',
                                'teachers_with_education': '–ü–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏—Ö —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤ —Å –≤—ã—Å—à–∏–º –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ–º',
                                'teachers_with_category': '–ü–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏—Ö —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤ —Å –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π',
                                'teachers_qualification': '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏—Ö —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤',
                                'teachers_development': '–ü–æ–≤—ã—à–µ–Ω–∏–µ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏—Ö —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤',
                                'teachers_documents': '–î–æ–∫—É–º–µ–Ω—Ç—ã –ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —Å–æ—Å—Ç–∞–≤–∞'
                                } %}
                                {# –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π –Ω–∞ –∞—Ç—Ä–∏–±—É—Ç—ã itemprop —Å–æ–≥–ª–∞—Å–Ω–æ —Ç–∞–±–ª–∏—Ü–µ #}
                                {% set teachers_itemprops = {
                                'teachers_qualification': 'qualification',
                                'teachers_development': 'qualification'
                                } %}
                                {% for field_name in teachers_fields %}
                                {% set field_label = teachers_labels.get(field_name, field_name | replace('_', ' ') |
                                title) %}
                                {% set field_value = text_data.form_data.get(field_name) if text_data and
                                text_data.form_data else None %}
                                {% set is_filled = field_value and (field_value is not mapping or field_value.get('url')
                                or field_value.get('filename')) and (field_value is not string or field_value | trim) %}
                                {% set field_itemprop = teachers_itemprops.get(field_name, '') %}
                                <tr role="listitem" itemprop="{{ field_itemprop or '' }}">
                                    <td
                                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                                        {{ field_label }}</td>
                                    <td style="padding: 10px; border: 1px solid #e5e7eb;">
                                        {% if 'document' in field_name or 'file' in field_name %}
                                        {{ render_document_field(field_name, field_label, field_value, section.endpoint)
                                        }}
                                        {% elif is_filled %}
                                        {% if field_itemprop %}<span itemprop="{{ field_itemprop }}">{{
                                            render_field_content(field_name, field_label, field_value, section.endpoint, false)
                                            }}</span>{% else %}{{ render_field_content(field_name, field_label,
                                        field_value, section.endpoint, false) }}{% endif %}
                                        {% else %}
                                        {% if field_itemprop %}<span itemprop="{{ field_itemprop }}">–Ω–µ
                                            –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>{% else %}<span>–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>{% endif %}
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% elif section.endpoint == 'facilities' %}
                    {% set has_table_content = true %}
                    {% set facilities_page_cfg = section_headers.get('page_title') or {} %}
                    <div class="form-data-section" itemprop="{{ microdata_config.itemprop }}" itemscope="itemscope"
                        itemtype="{{ microdata_config.itemtype }}" role="list">
                        {% if facilities_page_cfg.get('visible', True) %}<h2>{{ facilities_page_cfg.get('text') or section.title }}</h2>{% endif %}
                        <table class="info-table" style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                            <tbody>
                                {% set facilities_fields = ['title', 'text', 'buildings_info', 'library_info',
                                'sports_facilities', 'learning_equipment', 'catering_conditions', 'health_conditions',
                                'accessible_environment', 'facilities_documents'] %}
                                {% set facilities_labels = {
                                'title': '–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ –ú–¢–û',
                                'text': '–û–ø–∏—Å–∞–Ω–∏–µ –ú–¢–û',
                                'buildings_info': '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–¥–∞–Ω–∏—è—Ö –∏ –ø–æ–º–µ—â–µ–Ω–∏—è—Ö',
                                'library_info': '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ',
                                'sports_facilities': '–°–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã',
                                'learning_equipment': '–°—Ä–µ–¥—Å—Ç–≤–∞ –æ–±—É—á–µ–Ω–∏—è –∏ –≤–æ—Å–ø–∏—Ç–∞–Ω–∏—è',
                                'catering_conditions': '–£—Å–ª–æ–≤–∏—è –ø–∏—Ç–∞–Ω–∏—è –æ–±—É—á–∞—é—â–∏—Ö—Å—è',
                                'health_conditions': '–£—Å–ª–æ–≤–∏—è –æ—Ö—Ä–∞–Ω—ã –∑–¥–æ—Ä–æ–≤—å—è –æ–±—É—á–∞—é—â–∏—Ö—Å—è',
                                'accessible_environment': '–î–æ—Å—Ç—É–ø–Ω–∞—è —Å—Ä–µ–¥–∞',
                                'facilities_documents': '–î–æ–∫—É–º–µ–Ω—Ç—ã –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω–æ-—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è'
                                } %}
                                {# –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π –Ω–∞ –∞—Ç—Ä–∏–±—É—Ç—ã itemprop —Å–æ–≥–ª–∞—Å–Ω–æ —Ç–∞–±–ª–∏—Ü–∞–º #}
                                {% set facilities_itemprops = {
                                'buildings_info': 'purposeCab',
                                'library_info': 'purposeLibr',
                                'sports_facilities': 'purposeSport',
                                'learning_equipment': 'purposeFacil',
                                'accessible_environment': 'ovz'
                                } %}
                                {% for field_name in facilities_fields %}
                                {% set field_label = facilities_labels.get(field_name, field_name | replace('_', ' ') |
                                title) %}
                                {% set field_value = text_data.form_data.get(field_name) if text_data and
                                text_data.form_data else None %}
                                {% set is_filled = field_value and (field_value is not mapping or field_value.get('url')
                                or field_value.get('filename')) and (field_value is not string or field_value | trim) %}
                                {% set field_itemprop = facilities_itemprops.get(field_name, '') %}
                                {% set is_main_tag = field_name in ['buildings_info', 'library_info',
                                'sports_facilities', 'learning_equipment'] %}
                                <tr role="listitem" itemprop="{{ field_itemprop or '' }}" {% if is_main_tag %}
                                    itemscope="itemscope" itemtype="https://schema.org/ItemList" {% endif %}>
                                    <td
                                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                                        {{ field_label }}</td>
                                    <td style="padding: 10px; border: 1px solid #e5e7eb;">
                                        {% if 'document' in field_name or 'file' in field_name %}
                                        {{ render_document_field(field_name, field_label, field_value, section.endpoint)
                                        }}
                                        {% elif is_filled %}
                                        {% if field_itemprop and not is_main_tag %}<span
                                            itemprop="{{ field_itemprop }}">{{ render_field_content(field_name,
                                            field_label, field_value, section.endpoint, false) }}</span>{% else %}{{
                                        render_field_content(field_name, field_label, field_value, section.endpoint, false)
                                        }}{% endif %}
                                        {% else %}
                                        {% if field_itemprop and not is_main_tag %}<span
                                            itemprop="{{ field_itemprop }}">–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>{% else %}<span>–Ω–µ
                                            –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>{% endif %}
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% elif section.endpoint == 'scholarships' %}
                    {% set has_table_content = true %}
                    {% set scholarships_page_cfg = section_headers.get('page_title') or {} %}
                    <div class="form-data-section" itemprop="{{ microdata_config.itemprop }}" itemscope="itemscope"
                        itemtype="{{ microdata_config.itemtype }}" role="list">
                        {% if scholarships_page_cfg.get('visible', True) %}<h2>{{ scholarships_page_cfg.get('text') or section.title }}</h2>{% endif %}
                        <table class="info-table" style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                            <tbody>
                                {% set scholarships_fields = ['title', 'scholarships_info', 'support_measures',
                                'social_support', 'financial_aid', 'scholarship_documents'] %}
                                {% set scholarships_labels = {
                                'title': '–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã',
                                'scholarships_info': '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–∏–ø–µ–Ω–¥–∏—è—Ö',
                                'support_measures': '–ú–µ—Ä—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –æ–±—É—á–∞—é—â–∏—Ö—Å—è',
                                'social_support': '–°–æ—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞',
                                'financial_aid': '–ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω–∞—è –ø–æ–º–æ—â—å',
                                'scholarship_documents': '–î–æ–∫—É–º–µ–Ω—Ç—ã –æ —Å—Ç–∏–ø–µ–Ω–¥–∏—è—Ö –∏ –º–µ—Ä–∞—Ö –ø–æ–¥–¥–µ—Ä–∂–∫–∏'
                                } %}
                                {# –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π –Ω–∞ –∞—Ç—Ä–∏–±—É—Ç—ã itemprop —Å–æ–≥–ª–∞—Å–Ω–æ —Ç–∞–±–ª–∏—Ü–µ #}
                                {% set scholarships_itemprops = {
                                'scholarships_info': 'grant',
                                'support_measures': 'support',
                                'social_support': 'support',
                                'scholarship_documents': 'localAct'
                                } %}
                                {% set scholarships_document_itemprops = {
                                'scholarship_documents': 'localAct'
                                } %}
                                {% for field_name in scholarships_fields %}
                                {% set field_label = scholarships_labels.get(field_name, field_name | replace('_', ' ')
                                | title) %}
                                {% set field_value = text_data.form_data.get(field_name) if text_data and
                                text_data.form_data else None %}
                                {% set is_filled = field_value and (field_value is not mapping or field_value.get('url')
                                or field_value.get('filename')) and (field_value is not string or field_value | trim) %}
                                {% set field_itemprop = scholarships_itemprops.get(field_name, '') %}
                                {% set document_itemprop = scholarships_document_itemprops.get(field_name, 'document')
                                %}
                                <tr role="listitem" itemprop="{{ field_itemprop or 'supportMeasure' }}">
                                    <td
                                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                                        {{ field_label }}</td>
                                    <td style="padding: 10px; border: 1px solid #e5e7eb;">
                                        {% if 'document' in field_name or 'file' in field_name %}
                                        {{ render_document_field(field_name, field_label, field_value, section.endpoint,
                                        document_itemprop) }}
                                        {% elif is_filled %}
                                        <span itemprop="{{ field_itemprop or 'supportMeasure' }}">{{
                                            render_field_content(field_name, field_label, field_value, section.endpoint, false)
                                            }}</span>
                                        {% else %}
                                        <span itemprop="{{ field_itemprop or 'supportMeasure' }}">–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% elif section.endpoint == 'paid-services' %}
                    {% set has_table_content = true %}
                    {% set paid_services_page_cfg = section_headers.get('page_title') or {} %}
                    <div class="form-data-section" itemprop="{{ microdata_config.itemprop }}" itemscope="itemscope"
                        itemtype="{{ microdata_config.itemtype }}" role="list">
                        {% if paid_services_page_cfg.get('visible', True) %}<h2>{{ paid_services_page_cfg.get('text') or section.title }}</h2>{% endif %}
                        <table class="info-table" style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                            <tbody>
                                {% set paid_services_fields = ['title', 'text', 'services_list', 'services_prices',
                                'services_procedure', 'services_contract', 'services_documents'] %}
                                {% set paid_services_labels = {
                                'title': '–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ –ø–ª–∞—Ç–Ω—ã—Ö —É—Å–ª—É–≥',
                                'text': '–û–ø–∏—Å–∞–Ω–∏–µ –ø–ª–∞—Ç–Ω—ã—Ö —É—Å–ª—É–≥',
                                'services_list': '–ü–µ—Ä–µ—á–µ–Ω—å –ø–ª–∞—Ç–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —É—Å–ª—É–≥',
                                'services_prices': '–¶–µ–Ω—ã –Ω–∞ –ø–ª–∞—Ç–Ω—ã–µ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏',
                                'services_procedure': '–ü–æ—Ä—è–¥–æ–∫ –æ–∫–∞–∑–∞–Ω–∏—è –ø–ª–∞—Ç–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —É—Å–ª—É–≥',
                                'services_contract': '–û–±—Ä–∞–∑–µ—Ü –¥–æ–≥–æ–≤–æ—Ä–∞ –æ–± –æ–∫–∞–∑–∞–Ω–∏–∏ –ø–ª–∞—Ç–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —É—Å–ª—É–≥',
                                'services_documents': '–î–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ –ø–ª–∞—Ç–Ω—ã–º —É—Å–ª—É–≥–∞–º'
                                } %}
                                {# –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π –Ω–∞ –∞—Ç—Ä–∏–±—É—Ç—ã itemprop —Å–æ–≥–ª–∞—Å–Ω–æ —Ç–∞–±–ª–∏—Ü–µ #}
                                {% set paid_services_itemprops = {
                                'services_prices': 'paidSt'
                                } %}
                                {% set paid_services_document_itemprops = {
                                'services_procedure': 'paidEdu',
                                'services_contract': 'paidDog',
                                'services_documents': 'paidSt'
                                } %}
                                {% for field_name in paid_services_fields %}
                                {% set field_label = paid_services_labels.get(field_name, field_name | replace('_', ' ')
                                | title) %}
                                {% set field_value = text_data.form_data.get(field_name) if text_data and
                                text_data.form_data else None %}
                                {% set is_filled = field_value and (field_value is not mapping or field_value.get('url')
                                or field_value.get('filename')) and (field_value is not string or field_value | trim) %}
                                {% set field_itemprop = paid_services_itemprops.get(field_name, '') %}
                                {% set document_itemprop = paid_services_document_itemprops.get(field_name, 'document')
                                %}
                                <tr role="listitem" itemprop="{{ field_itemprop or 'service' }}">
                                    <td
                                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                                        {{ field_label }}</td>
                                    <td style="padding: 10px; border: 1px solid #e5e7eb;">
                                        {% if 'document' in field_name or 'file' in field_name or 'contract' in
                                        field_name %}
                                        {{ render_document_field(field_name, field_label, field_value, section.endpoint,
                                        document_itemprop) }}
                                        {% elif is_filled %}
                                        <span itemprop="{{ field_itemprop or 'service' }}">{{
                                            render_field_content(field_name, field_label, field_value, section.endpoint, false)
                                            }}</span>
                                        {% else %}
                                        <span itemprop="{{ field_itemprop or 'service' }}">–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% elif section.endpoint == 'finance' %}
                    {% set has_table_content = true %}
                    {% set finance_page_cfg = section_headers.get('page_title') or {} %}
                    <div class="form-data-section" itemprop="{{ microdata_config.itemprop }}" itemscope="itemscope"
                        itemtype="{{ microdata_config.itemtype }}" role="list">
                        {% if finance_page_cfg.get('visible', True) %}<h2>{{ finance_page_cfg.get('text') or section.title }}</h2>{% endif %}
                        <table class="info-table" style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                            <tbody>
                                {% set finance_fields = ['title', 'text', 'budget_volume', 'extrabudgetary_income',
                                'extrabudgetary_expenses', 'financial_plans', 'financial_documents'] %}
                                {% set finance_labels = {
                                'title': '–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤',
                                'text': '–û–ø–∏—Å–∞–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏',
                                'budget_volume': '–û–±—ä–µ–º –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–π
                                –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –∑–∞ —Å—á–µ—Ç –±—é–¥–∂–µ—Ç–Ω—ã—Ö –∞—Å—Å–∏–≥–Ω–æ–≤–∞–Ω–∏–π',
                                'extrabudgetary_income': '–ü–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –∏ –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤ –ø–æ –∏—Ç–æ–≥–∞–º
                                —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –≥–æ–¥–∞',
                                'extrabudgetary_expenses': '–†–∞—Å—Ö–æ–¥—ã –ø–æ –ø–æ—Å—Ç—É–ø–∏–≤—à–∏–º —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –∏ –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–º —Å—Ä–µ–¥—Å—Ç–≤–∞–º
                                –ø–æ –∏—Ç–æ–≥–∞–º —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –≥–æ–¥–∞',
                                'financial_plans': '–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–ª–∞–Ω—ã –∏ –æ—Ç—á–µ—Ç—ã',
                                'financial_documents': '–î–æ–∫—É–º–µ–Ω—Ç—ã —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ-—Ö–æ–∑—è–π—Å—Ç–≤–µ–Ω–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏'
                                } %}
                                {# –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π –Ω–∞ –∞—Ç—Ä–∏–±—É—Ç—ã itemprop —Å–æ–≥–ª–∞—Å–Ω–æ —Ç–∞–±–ª–∏—Ü–µ #}
                                {% set finance_itemprops = {
                                'extrabudgetary_income': 'finPost',
                                'extrabudgetary_expenses': 'finRas'
                                } %}
                                {% set finance_document_itemprops = {
                                'financial_plans': 'finPlanDocLink'
                                } %}
                                {% for field_name in finance_fields %}
                                {% set field_label = finance_labels.get(field_name, field_name | replace('_', ' ') |
                                title) %}
                                {% set field_value = text_data.form_data.get(field_name) if text_data and
                                text_data.form_data else None %}
                                {% set is_filled = field_value and (field_value is not mapping or field_value.get('url')
                                or field_value.get('filename')) and (field_value is not string or field_value | trim) %}
                                {% set field_itemprop = finance_itemprops.get(field_name, '') %}
                                {% set document_itemprop = finance_document_itemprops.get(field_name, 'document') %}
                                {% set is_volume_field = field_name == 'budget_volume' %}
                                {% set is_income_expenses = field_name in ['extrabudgetary_income',
                                'extrabudgetary_expenses'] %}

                                {% if is_volume_field %}
                                {# –û–±—ä–µ–º –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ - –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–∞–∑–Ω—ã—Ö –±—é–¥–∂–µ—Ç–∞—Ö #}
                                <tr role="listitem" itemprop="volume" itemscope="itemscope"
                                    itemtype="https://schema.org/ItemList">
                                    <td
                                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                                        {{ field_label }}</td>
                                    <td style="padding: 10px; border: 1px solid #e5e7eb;">
                                        {% if is_filled %}
                                        <span itemprop="volume">{{ render_field_content(field_name, field_label,
                                            field_value, section.endpoint) }}</span>
                                        {% else %}
                                        <span itemprop="volume">–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% elif is_income_expenses %}
                                {# –ü–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –∏ —Ä–∞—Å—Ö–æ–¥—ã - –≤–Ω—É—Ç—Ä–∏ volume #}
                                <tr role="listitem" itemprop="volume" itemscope="itemscope"
                                    itemtype="https://schema.org/ItemList">
                                    <td
                                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                                        {{ field_label }}</td>
                                    <td style="padding: 10px; border: 1px solid #e5e7eb;">
                                        {% if is_filled %}
                                        <span itemprop="{{ field_itemprop }}">{{ render_field_content(field_name,
                                            field_label, field_value, section.endpoint) }}</span>
                                        {% else %}
                                        <span itemprop="{{ field_itemprop }}">–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% else %}
                                {# –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è #}
                                <tr role="listitem" itemprop="{{ field_itemprop or 'report' }}">
                                    <td
                                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                                        {{ field_label }}</td>
                                    <td style="padding: 10px; border: 1px solid #e5e7eb;">
                                        {% if 'document' in field_name or 'file' in field_name or 'plan' in field_name
                                        %}
                                        {{ render_document_field(field_name, field_label, field_value, section.endpoint,
                                        document_itemprop) }}
                                        {% elif is_filled %}
                                        <span itemprop="{{ field_itemprop or 'report' }}">{{
                                            render_field_content(field_name, field_label, field_value, section.endpoint, false)
                                            }}</span>
                                        {% else %}
                                        <span itemprop="{{ field_itemprop or 'report' }}">–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endif %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% elif section.endpoint == 'vacancies' %}
                    {% set has_table_content = true %}
                    {% set vacancies_page_cfg = section_headers.get('page_title') or {} %}
                    <div class="form-data-section" itemprop="{{ microdata_config.itemprop }}" itemscope="itemscope"
                        itemtype="{{ microdata_config.itemtype }}" role="list">
                        {% if vacancies_page_cfg.get('visible', True) %}<h2>{{ vacancies_page_cfg.get('text') or section.title }}</h2>{% endif %}
                        <table class="info-table" style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                            <tbody>
                                {% set vacancies_fields = ['title', 'text', 'elementary_vacancies', 'basic_vacancies',
                                'secondary_vacancies', 'special_programs_vacancies', 'vacancies_documents'] %}
                                {% set vacancies_labels = {
                                'title': '–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ –≤–∞–∫–∞–Ω—Å–∏–π',
                                'text': '–û–ø–∏—Å–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Ç–Ω—ã—Ö –º–µ—Å—Ç',
                                'elementary_vacancies': '–í–∞–∫–∞–Ω—Ç–Ω—ã–µ –º–µ—Å—Ç–∞ –≤ 1-4 –∫–ª–∞—Å—Å–∞—Ö',
                                'basic_vacancies': '–í–∞–∫–∞–Ω—Ç–Ω—ã–µ –º–µ—Å—Ç–∞ –≤ 5-9 –∫–ª–∞—Å—Å–∞—Ö',
                                'secondary_vacancies': '–í–∞–∫–∞–Ω—Ç–Ω—ã–µ –º–µ—Å—Ç–∞ –≤ 10-11 –∫–ª–∞—Å—Å–∞—Ö',
                                'special_programs_vacancies': '–í–∞–∫–∞–Ω—Ç–Ω—ã–µ –º–µ—Å—Ç–∞ –ø–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø—Ä–æ–≥—Ä–∞–º–º–∞–º',
                                'vacancies_documents': '–î–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ –≤–∞–∫–∞–Ω—Ç–Ω—ã–º –º–µ—Å—Ç–∞–º'
                                } %}
                                {# –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π –Ω–∞ –∞—Ç—Ä–∏–±—É—Ç—ã itemprop —Å–æ–≥–ª–∞—Å–Ω–æ —Ç–∞–±–ª–∏—Ü–µ #}
                                {% set vacancies_itemprops = {
                                'elementary_vacancies': 'vacant',
                                'basic_vacancies': 'vacant',
                                'secondary_vacancies': 'vacant',
                                'special_programs_vacancies': 'vacant'
                                } %}
                                
                                {# –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–æ–ª—è —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–π –º–µ–∂–¥—É –ù–û–û, –û–û–û –∏ –°–û–û #}
                                {% set previous_education_level = '' %}
                                {% for field_name in vacancies_fields %}
                                {% set current_education_level = '' %}
                                {% if field_name == 'elementary_vacancies' %}
                                    {% set current_education_level = '–ù–û–û' %}
                                {% elif field_name == 'basic_vacancies' %}
                                    {% set current_education_level = '–û–û–û' %}
                                {% elif field_name == 'secondary_vacancies' %}
                                    {% set current_education_level = '–°–û–û' %}
                                {% endif %}
                                
                                {# –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –ø–µ—Ä–µ–¥ –≥—Ä—É–ø–ø–æ–π, –µ—Å–ª–∏ —É—Ä–æ–≤–µ–Ω—å –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–∏–ª—Å—è #}
                                {% if current_education_level and current_education_level != previous_education_level %}
                                {# –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à—É—é –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –ø–µ—Ä–µ–¥ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–º, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –ø–µ—Ä–≤–∞—è –≥—Ä—É–ø–ø–∞ #}
                                {% if previous_education_level %}
                                <tr>
                                    <td colspan="2" style="padding: 8px; border: none; background: transparent;"></td>
                                </tr>
                                {% endif %}
                                <tr>
                                    <td colspan="2" style="padding: 12px 16px; background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; font-weight: 600; font-size: 1.1em; border: 1px solid #2563eb; border-radius: 6px; margin: 8px 0; box-shadow: 0 2px 4px rgba(37, 99, 235, 0.2);">
                                        {% if current_education_level == '–ù–û–û' %}
                                            üìö –ù–∞—á–∞–ª—å–Ω–æ–µ –æ–±—â–µ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ (–ù–û–û)
                                        {% elif current_education_level == '–û–û–û' %}
                                            üìñ –û—Å–Ω–æ–≤–Ω–æ–µ –æ–±—â–µ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ (–û–û–û)
                                        {% elif current_education_level == '–°–û–û' %}
                                            üìò –°—Ä–µ–¥–Ω–µ–µ –æ–±—â–µ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ (–°–û–û)
                                        {% endif %}
                                    </td>
                                </tr>
                                {% set previous_education_level = current_education_level %}
                                {% endif %}
                                {% set field_label = vacancies_labels.get(field_name, field_name | replace('_', ' ') |
                                title) %}
                                {% set field_value = text_data.form_data.get(field_name) if text_data and
                                text_data.form_data else None %}
                                {% set is_filled = field_value and (field_value is not mapping or field_value.get('url')
                                or field_value.get('filename')) and (field_value is not string or field_value | trim) %}
                                {% set field_itemprop = vacancies_itemprops.get(field_name, '') %}
                                {% set is_vacant_field = field_name in ['elementary_vacancies', 'basic_vacancies',
                                'secondary_vacancies', 'special_programs_vacancies'] %}
                                <tr role="listitem" itemprop="{{ field_itemprop or '' }}" {% if is_vacant_field %}
                                    itemscope="itemscope" itemtype="https://schema.org/ItemList" {% endif %}>
                                    <td
                                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                                        {{ field_label }}</td>
                                    <td style="padding: 10px; border: 1px solid #e5e7eb;">
                                        {% if 'document' in field_name or 'file' in field_name %}
                                        {{ render_document_field(field_name, field_label, field_value, section.endpoint)
                                        }}
                                        {% elif is_filled %}
                                        {% if field_itemprop and not is_vacant_field %}<span
                                            itemprop="{{ field_itemprop }}">{{ render_field_content(field_name,
                                            field_label, field_value, section.endpoint, false) }}</span>{% else %}{{
                                        render_field_content(field_name, field_label, field_value, section.endpoint, false)
                                        }}{% endif %}
                                        {% else %}
                                        {% if field_itemprop and not is_vacant_field %}<span
                                            itemprop="{{ field_itemprop }}">–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>{% else %}<span>–Ω–µ
                                            –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>{% endif %}
                                        {% endif %}
                                    </td>
                                </tr>
                                {# –î–æ–±–∞–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –≥—Ä—É–ø–ø—ã –≤–∞–∫–∞–Ω—Å–∏–π, –µ—Å–ª–∏ —Å–ª–µ–¥—É—é—â–µ–µ –ø–æ–ª–µ - –¥—Ä—É–≥–∞—è –≥—Ä—É–ø–ø–∞ #}
                                {% if current_education_level %}
                                    {% set next_field_index = loop.index0 + 1 %}
                                    {% if next_field_index < vacancies_fields|length %}
                                        {% set next_field = vacancies_fields[next_field_index] %}
                                        {% set next_education_level = '' %}
                                        {% if next_field == 'elementary_vacancies' %}
                                            {% set next_education_level = '–ù–û–û' %}
                                        {% elif next_field == 'basic_vacancies' %}
                                            {% set next_education_level = '–û–û–û' %}
                                        {% elif next_field == 'secondary_vacancies' %}
                                            {% set next_education_level = '–°–û–û' %}
                                        {% endif %}
                                        {# –ï—Å–ª–∏ —Å–ª–µ–¥—É—é—â–µ–µ –ø–æ–ª–µ - –¥—Ä—É–≥–∞—è –≥—Ä—É–ø–ø–∞ –≤–∞–∫–∞–Ω—Å–∏–π, –¥–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à–æ–π –æ—Ç—Å—Ç—É–ø #}
                                        {% if next_education_level and next_education_level != current_education_level %}
                                        <tr>
                                            <td colspan="2" style="padding: 6px; border: none; background: #f8f9fa; border-bottom: 2px solid #e5e7eb;"></td>
                                        </tr>
                                        {% endif %}
                                    {% endif %}
                                {% endif %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% elif section.endpoint == 'international' %}
                    {% set has_table_content = true %}
                    {% set international_page_cfg = section_headers.get('page_title') or {} %}
                    <div class="form-data-section" itemprop="{{ microdata_config.itemprop }}" itemscope="itemscope"
                        itemtype="{{ microdata_config.itemtype }}" role="list">
                        {% if international_page_cfg.get('visible', True) %}<h2>{{ international_page_cfg.get('text') or section.title }}</h2>{% endif %}
                        <table class="info-table" style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                            <tbody>
                                {% set international_fields = ['title', 'text', 'partnerships', 'exchange_programs',
                                'joint_projects', 'international_documents'] %}
                                {% set international_labels = {
                                'title': '–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã',
                                'text': '–û–ø–∏—Å–∞–Ω–∏–µ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞',
                                'partnerships': '–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ –ø–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–∞ –∏ —Å–æ–≥–ª–∞—à–µ–Ω–∏—è',
                                'exchange_programs': '–ü—Ä–æ–≥—Ä–∞–º–º—ã –æ–±–º–µ–Ω–∞ –æ–±—É—á–∞—é—â–∏–º–∏—Å—è',
                                'joint_projects': '–°–æ–≤–º–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã –∏ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã',
                                'international_documents': '–î–æ–∫—É–º–µ–Ω—Ç—ã –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞'
                                } %}
                                {# –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π –Ω–∞ –∞—Ç—Ä–∏–±—É—Ç—ã itemprop —Å–æ–≥–ª–∞—Å–Ω–æ —Ç–∞–±–ª–∏—Ü–µ #}
                                {% set international_itemprops = {
                                'partnerships': 'internationalDog'
                                } %}
                                {% for field_name in international_fields %}
                                {% set field_label = international_labels.get(field_name, field_name | replace('_', ' ')
                                | title) %}
                                {% set field_value = text_data.form_data.get(field_name) if text_data and
                                text_data.form_data else None %}
                                {% set is_filled = field_value and (field_value is not mapping or field_value.get('url')
                                or field_value.get('filename')) and (field_value is not string or field_value | trim) %}
                                {% set field_itemprop = international_itemprops.get(field_name, '') %}
                                {% set is_partnerships_field = field_name == 'partnerships' %}
                                <tr role="listitem" itemprop="{{ field_itemprop or 'partner' }}" {% if
                                    is_partnerships_field %} itemscope="itemscope"
                                    itemtype="https://schema.org/ItemList" {% endif %}>
                                    <td
                                        style="padding: 10px; border: 1px solid #e5e7eb; background-color: #f9fafb; font-weight: 600; width: 40%;">
                                        {{ field_label }}</td>
                                    <td style="padding: 10px; border: 1px solid #e5e7eb;">
                                        {% if 'document' in field_name or 'file' in field_name %}
                                        {{ render_document_field(field_name, field_label, field_value, section.endpoint)
                                        }}
                                        {% elif is_filled %}
                                        {% if field_itemprop and not is_partnerships_field %}<span
                                            itemprop="{{ field_itemprop }}">{{ render_field_content(field_name,
                                            field_label, field_value, section.endpoint, false) }}</span>{% else %}{{
                                        render_field_content(field_name, field_label, field_value, section.endpoint, false)
                                        }}{% endif %}
                                        {% else %}
                                        {% if field_itemprop and not is_partnerships_field %}<span
                                            itemprop="{{ field_itemprop }}">–Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>{% else %}<span>–Ω–µ
                                            –∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>{% endif %}
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% elif section.endpoint == 'food' %}
                    {% set has_table_content = true %}
                    {% set food_page_cfg = section_headers.get('page_title') or {} %}
                    <div class="form-data-section" itemprop="cateringOrganization" itemscope="itemscope"
                        itemtype="https://schema.org/ItemList" role="list">
                        {% if food_page_cfg.get('visible', True) %}<h2>{{ food_page_cfg.get('text') or section.title }}</h2>{% endif %}
                        {# –¢–∞–±–ª–∏—Ü—É —Å –ø–æ–ª—è–º–∏ –ø–∏—Ç–∞–Ω–∏—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ "–ü–∏—Ç–∞–Ω–∏–µ" –æ—Ç–∫–ª—é—á–∏–ª–∏ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é; –∫–æ–Ω—Ç–µ–Ω—Ç ‚Äî –±–ª–æ–∫–∏ –∏ –º–µ–Ω—é –Ω–∏–∂–µ #}
                    </div>
                    {% endif %}
                    {% endif %}

                    {# –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ "–ü–∏—Ç–∞–Ω–∏–µ" –±–ª–æ–∫ "–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –º–µ–Ω—é" –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º (–æ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ–π) #}

                    <div class="content-blocks" role="list" {% if section.endpoint not in section_microdata
                        %}itemprop="contentBlocks" {% endif %}>
                        {% for block in section.get_content_blocks() %}
                        {% set block_idx = loop.index0 %}
                        {% set block_type = block.get('type', 'text') %}
                        {% set has_title = block.get('title') and block.get('show_title', True) %}
                        {% set has_content = False %}
                        {% if block_type == 'text' %}
                        {% set has_content = block.get('content') or block.get('documents') or block.get('photos') %}
                        {% elif block_type == 'table' %}
                        {% set has_content = block.get('headers') or block.get('rows') %}
                        {% elif block_type == 'list' %}
                        {% set has_content = block.get('items') %}
                        {% elif block_type == 'documents' %}
                        {% set has_content = block.get('documents') %}
                        {% elif block_type == 'photos' %}
                        {% set has_content = block.get('photos') %}
                        {% elif block_type == 'person' %}
                        {% set has_content = block.get('persons') %}
                        {% elif block_type == 'dishes' %}
                        {% set has_content = block.get('dishes') %}
                        {% elif block_type == 'daily-dish' %}
                        {% set has_content = block.get('dish') %}
                        {% endif %}
                        {% if has_title or has_content %}
                        {% set block_itemprop = block.get('itemprop') if (use_new_sveden_layout and block_type == 'table') else none %}
                        <div class="content-block content-block-{{ block_type }}" role="listitem" {% if block_itemprop %}itemprop="{{ block_itemprop }}" {% elif section.endpoint
                            in section_microdata %}{% set
                            item_itemprop=section_microdata[section.endpoint].item_itemprop %}{% if item_itemprop
                            %}itemprop="{{ item_itemprop }}" {% endif %}{% else %}itemprop="contentBlock" {% endif %}>
                            {% if has_title %}
                            <h2>{{ block.get('title') }}</h2>
                            {% if section.endpoint == 'nutrition-dishes-archive'
                            and block.get('type') == 'dishes'
                            and block.get('title') == '–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –º–µ–Ω—é'
                            and current_user.is_authenticated %}
                            <div style="margin-top: 12px; margin-bottom: 8px;">
                                <button onclick="openEditDailyMenuDishes()" class="btn btn-primary"
                                    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 10px 18px; border-radius: 12px; border: none; color: white; cursor: pointer; font-size: 14px; font-weight: 700;">
                                    ‚ûï –î–æ–±–∞–≤–∏—Ç—å / —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –±–ª—é–¥–∞
                                </button>
                            </div>
                            {% endif %}
                            {% endif %}

                            {% if block.get('type') == 'text' %}
                            {% set has_content = block.get('content') or block.get('documents') or block.get('photos')
                            %}
                            {% if has_content or block.get('title') %}
                            <div class="text-content">
                                {% if block.get('content') %}
                                <div class="text-content-text">{{ block.get('content') | safe }}</div>
                                {% endif %}
                                {% if block.get('documents') %}
                                <div class="text-content-documents"
                                    style="margin-top: 24px; padding-top: 24px; border-top: 1px solid #e5e7eb;"
                                    role="list">
                                    <h4 style="margin: 0 0 12px 0; font-size: 16px; font-weight: 600; color: #374151;">
                                        –î–æ–∫—É–º–µ–Ω—Ç—ã:</h4>
                                    <div class="documents-list"
                                        style="display: flex; flex-direction: column; gap: 8px;">
                                        {% for doc in block.get('documents', []) %}
                                        {% set doc_url = doc.get('url', '') if doc is mapping else doc %}
                                        {% set doc_name = doc.get('name', '') if doc is mapping else (doc.split('/')[-1]
                                        if doc else '–î–æ–∫—É–º–µ–Ω—Ç') %}
                                        {% if doc_url %}
                                        <div role="listitem" itemprop="document" itemscope="itemscope"
                                            itemtype="https://schema.org/MediaObject">
                                            <a href="{{ doc_url }}" target="_blank" class="document-link" {% if
                                                doc_url.startswith('/download_file/') %}download{% endif %}
                                                style="display: flex; align-items: center; gap: 10px; padding: 8px 0; text-decoration: none; color: #2563eb; transition: color 0.2s; border-bottom: 1px solid transparent;"
                                                itemprop="contentUrl">
                                                <span style="font-size: 18px; flex-shrink: 0;">üìÑ</span>
                                                <span style="font-size: 1rem; font-weight: 400; line-height: 1.5;">{{ doc_name }}</span>
                                            </a>
                                        </div>
                                        {% endif %}
                                        {% endfor %}
                                    </div>
                                </div>
                                {% endif %}
                                {% if block.get('photos') %}
                                <div class="text-content-photos" itemprop="photos" role="list">
                                    <div class="info-photo-row">
                                        {% for photo_url in block.get('photos', []) %}
                                        {% if photo_url %}
                                        <div class="info-photo-item" role="listitem" itemprop="photo" itemscope="itemscope"
                                            itemtype="https://schema.org/ImageObject">
                                            <img class="js-previewable" src="{{ photo_url }}" data-full="{{ photo_url }}" alt="–§–æ—Ç–æ"
                                                style="width: 100%; height: 170px; object-fit: cover; border-radius: 12px; cursor: pointer; display: block; transition: box-shadow 0.2s;"
                                                onmouseover="this.style.boxShadow='0 8px 24px rgba(0,0,0,0.2)'"
                                                onmouseout="this.style.boxShadow='none'"
                                                onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg%20xmlns%3D%27http%3A//www.w3.org/2000/svg%27%20width%3D%27400%27%20height%3D%27400%27%3E%3Crect%20width%3D%27100%25%27%20height%3D%27100%25%27%20fill%3D%27%23f1f5f9%27/%3E%3Ctext%20x%3D%2750%25%27%20y%3D%2750%25%27%20dominant-baseline%3D%27middle%27%20text-anchor%3D%27middle%27%20fill%3D%27%2394a3b8%27%20font-family%3D%27Arial%27%20font-size%3D%2718%27%3E%D0%A4%D0%BE%D1%82%D0%BE%3C/text%3E%3C/svg%3E';"
                                                loading="lazy" itemprop="contentUrl">
                                        </div>
                                        {% endif %}
                                        {% endfor %}
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                            {% endif %}

                            {% elif block.get('type') == 'table' %}
                            {# –î–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ —Å–≤–µ–¥–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–π –º–∞–∫–µ—Ç —Ç–∞–±–ª–∏—Ü (2 —Å—Ç–æ–ª–±—Ü–∞) #}
                            {% if use_new_sveden_layout %}
                            <div class="table-content">
                                {% set rows = block.get('rows') or [] %}
                                {% set row_itemprops = block.get('row_itemprops') or [] %}
                                {% if rows %}
                                <div class="table-wrapper table-wrapper-sveden">
                                    <table class="content-table content-table-sveden">
                                        <tbody>
                                            {% for row in rows %}
                                            {% set left_cell = (row[0] if row and row|length > 0 else '') %}
                                            {% set right_cell = (row[1] if row and row|length > 1 else '') %}
                                            {% set sub_rows = (row[2] if row and row|length > 2 and row[2] is iterable and row[2] is not string else []) %}
                                            {% set left_stripped = (left_cell|default('')|string|trim) %}
                                            {% set left_blank = not left_stripped or left_stripped|length == 0 %}
                                            {% set right_stripped = (right_cell|default('')|string|trim) %}
                                            {% set right_blank = not right_stripped or right_stripped|length == 0 %}
                                            {% set right_has_files = right_cell is string and (('/info/download_file/' in right_cell or '/download_file/' in right_cell or right_cell.startswith('/info/download_file/') or right_cell.startswith('/download_file/') or right_cell.startswith('/static/uploads/') or ',' in right_cell)) %}
                                            {% set row_itemprop = (row_itemprops[loop.index0] if row_itemprops and row_itemprops|length > loop.index0 else '') %}
                                            <tr>
                                                {% if left_blank and right_has_files %}
                                                <td colspan="2" class="table-cell-file-full"{% if row_itemprop %} itemprop="{{ row_itemprop }}"{% endif %}>
                                                    {% if ',' in right_cell %}
                                                    {# –ù–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é #}
                                                    {% set files = right_cell.split(',') %}
                                                    <div class="files-list">
                                                        {% for file_item in files %}
                                                        {% set file_trimmed = file_item|trim %}
                                                        {% if file_trimmed %}
                                                        {{ render_field_content('table_cell', '', file_trimmed, section.endpoint, false) }}
                                                        {% endif %}
                                                        {% endfor %}
                                                    </div>
                                                    {% else %}
                                                    {{ render_field_content('table_cell', '', right_cell, section.endpoint, false) }}
                                                    {% endif %}
                                                    {% if sub_rows %}
                                                    <div class="subrows-container" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e5e7eb;">
                                                        {% for sub_row in sub_rows %}
                                                        <div class="subrow-item" style="margin-bottom: 10px; padding: 10px; background: #f8fafc; border-radius: 6px; border: 1px solid #e5e7eb;">
                                                            {% if sub_row.name %}
                                                            <div style="font-weight: 600; margin-bottom: 5px; font-size: 1rem;">{{ sub_row.name }}</div>
                                                            {% endif %}
                                                            {% if sub_row.text %}
                                                            <div>{{ render_field_content('table_cell', '', sub_row.text, section.endpoint, false) }}</div>
                                                            {% endif %}
                                                        </div>
                                                        {% endfor %}
                                                    </div>
                                                    {% endif %}
                                                </td>
                                                {% else %}
                                                {# –ï—Å–ª–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü (–≤—Ç–æ—Ä–æ–π –ø—É—Å—Ç–æ–π –∏ –±–µ–∑ —Ñ–∞–π–ª–æ–≤/–ø–æ–¥—Å—Ç—Ä–æ–∫) ‚Äî —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –µ–≥–æ –Ω–∞ –≤—Å—é —Å—Ç—Ä–æ–∫—É #}
                                                {% if not left_blank and right_blank and not right_has_files and not sub_rows %}
                                                <td colspan="2"{% if row_itemprop %} itemprop="{{ row_itemprop }}"{% endif %}>{{ left_cell }}</td>
                                                {% else %}
                                                <td>{{ left_cell }}</td>
                                                <td{% if row_itemprop %} itemprop="{{ row_itemprop }}"{% endif %}>
                                                    {% if ',' in right_cell and right_has_files %}
                                                    {# –ù–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é #}
                                                    {% set files = right_cell.split(',') %}
                                                    <div class="files-list">
                                                        {% for file_item in files %}
                                                        {% set file_trimmed = file_item|trim %}
                                                        {% if file_trimmed %}
                                                        {{ render_field_content('table_cell', '', file_trimmed, section.endpoint, false) }}
                                                        {% endif %}
                                                        {% endfor %}
                                                    </div>
                                                    {% else %}
                                                    {{ render_field_content('table_cell', '', right_cell, section.endpoint, false) }}
                                                    {% endif %}
                                                    {% if sub_rows %}
                                                    <div class="subrows-container" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e5e7eb;">
                                                        {% for sub_row in sub_rows %}
                                                        <div class="subrow-item" style="margin-bottom: 10px; padding: 10px; background: #f8fafc; border-radius: 6px; border: 1px solid #e5e7eb;">
                                                            {% if sub_row.name %}
                                                            <div style="font-weight: 600; margin-bottom: 5px; font-size: 1rem;">{{ sub_row.name }}</div>
                                                            {% endif %}
                                                            {% if sub_row.text %}
                                                            <div>{{ render_field_content('table_cell', '', sub_row.text, section.endpoint, false) }}</div>
                                                            {% endif %}
                                                        </div>
                                                        {% endfor %}
                                                    </div>
                                                    {% endif %}
                                                </td>
                                                {% endif %}
                                                {% endif %}
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                {% endif %}
                            </div>
                            {% else %}
                            <div class="table-content">
                                {% if block.get('headers') or block.get('rows') %}
                                <div class="table-wrapper">
                                    <table class="content-table">
                                        {% if block.get('headers') %}
                                        <thead>
                                            <tr>
                                                {% for header in block.get('headers', []) %}
                                                <th>{{ header }}</th>
                                                {% endfor %}
                                            </tr>
                                        </thead>
                                        {% endif %}
                                        {% if block.get('rows') %}
                                        <tbody>
                                            {% for row in block.get('rows', []) %}
                                            <tr>
                                                {% for cell in row %}
                                                <td>{{ cell }}</td>
                                                {% endfor %}
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                        {% endif %}
                                    </table>
                                </div>
                                {% endif %}
                            </div>
                            {% endif %}

                            {% elif block.get('type') == 'list' %}
                            <div class="list-content">
                                {% if block.get('items') %}
                                {% set has_file_items = False %}
                                {% for item in block.get('items', []) %}
                                {% if item is mapping and (item.get('file') or item.get('url') or item.get('document'))
                                %}
                                {% set has_file_items = True %}
                                {% elif item is string and (item.startswith('/download_file/') or
                                item.startswith('/info/download_file/') or item.startswith('/static/uploads/') or
                                item.startswith('http') and ('download_file' in item or 'uploads' in item)) %}
                                {% set has_file_items = True %}
                                {% endif %}
                                {% endfor %}

                                {% if has_file_items %}
                                {# –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–∞–∫ –¥–æ–∫—É–º–µ–Ω—Ç—ã, –µ—Å–ª–∏ –µ—Å—Ç—å —Ñ–∞–π–ª—ã #}
                                <div class="documents-list" style="display: flex; flex-direction: column; gap: 8px;">
                                    {% for item in block.get('items', []) %}
                                    {% if item is mapping %}
                                    {# –û–±—ä–µ–∫—Ç —Å —Ñ–∞–π–ª–æ–º #}
                                    {% set doc_url = item.get('file') or item.get('url') or item.get('document') or
                                    item.get('document_url') %}
                                    {% set doc_name = item.get('name') or item.get('title') or item.get('text') or
                                    (doc_url.split('/')[-1] if doc_url else '–î–æ–∫—É–º–µ–Ω—Ç') %}
                                    {% if doc_url %}
                                    {% set filename = doc_url.split('/')[-1] %}
                                    {% set is_info_file = doc_url.startswith('/info/download_file/') or
                                    doc_url.startswith('/download_file/') %}
                                    <div role="listitem" itemprop="document" itemscope="itemscope"
                                        itemtype="https://schema.org/MediaObject">
                                        <a href="{% if is_info_file %}{{ filename | info_file_url(section.endpoint) }}{% else %}{{ doc_url }}{% endif %}"
                                            target="_blank" class="document-link" {% if is_info_file %}download{% endif
                                            %}
                                            style="display: flex; align-items: center; gap: 10px; padding: 8px 0; text-decoration: none; color: #2563eb; transition: color 0.2s; border-bottom: 1px solid transparent;"
                                            itemprop="contentUrl">
                                            <span style="font-size: 18px; flex-shrink: 0;">üìÑ</span>
                                            <span style="font-weight: 400; line-height: 1.5;">{{ doc_name }}</span>
                                        </a>
                                    </div>
                                    {% elif item.get('text') %}
                                    {# –û–±—ä–µ–∫—Ç —Å —Ç–µ–∫—Å—Ç–æ–º, –Ω–æ –±–µ–∑ —Ñ–∞–π–ª–∞ #}
                                    <div role="listitem">
                                        <span style="display: flex; align-items: center; gap: 10px; padding: 8px 0;">{{
                                            item.get('text') }}</span>
                                    </div>
                                    {% endif %}
                                    {% elif item is string %}
                                    {# –°—Ç—Ä–æ–∫–∞ - –ø—Ä–æ–≤–µ—Ä—è–µ–º, —ç—Ç–æ —Ñ–∞–π–ª –∏–ª–∏ —Ç–µ–∫—Å—Ç #}
                                    {% if item.startswith('/download_file/') or item.startswith('/info/download_file/')
                                    or item.startswith('/static/uploads/') or (item.startswith('http') and
                                    ('download_file' in item or 'uploads' in item)) %}
                                    {# –≠—Ç–æ URL —Ñ–∞–π–ª–∞ #}
                                    {% set doc_url = item.split('|')[0] if '|' in item else item %}
                                    {% set doc_name = item.split('|')[-1] if '|' in item else item.split('/')[-1] %}
                                    {% set filename = doc_url.split('/')[-1] %}
                                    {% set is_info_file = doc_url.startswith('/info/download_file/') or
                                    doc_url.startswith('/download_file/') %}
                                    <div role="listitem" itemprop="document" itemscope="itemscope"
                                        itemtype="https://schema.org/MediaObject">
                                        <a href="{% if is_info_file %}{{ filename | info_file_url(section.endpoint) }}{% else %}{{ doc_url }}{% endif %}"
                                            target="_blank" class="document-link" {% if is_info_file %}download{% endif
                                            %}
                                            style="display: flex; align-items: center; gap: 10px; padding: 8px 0; text-decoration: none; color: #2563eb; transition: color 0.2s; border-bottom: 1px solid transparent;"
                                            itemprop="contentUrl">
                                            <span style="font-size: 18px; flex-shrink: 0;">üìÑ</span>
                                            <span style="font-weight: 400; line-height: 1.5;">{{ doc_name }}</span>
                                        </a>
                                    </div>
                                    {% else %}
                                    {# –û–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç #}
                                    <div role="listitem">
                                        <span style="display: flex; align-items: center; gap: 10px; padding: 8px 0;">{{
                                            item }}</span>
                                    </div>
                                    {% endif %}
                                    {% else %}
                                    {# –î—Ä—É–≥–æ–π —Ç–∏–ø - –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å #}
                                    <div role="listitem">
                                        <span style="display: flex; align-items: center; gap: 10px; padding: 8px 0;">{{
                                            item }}</span>
                                    </div>
                                    {% endif %}
                                    {% endfor %}
                                </div>
                                {% else %}
                                {# –û–±—ã—á–Ω—ã–π —Å–ø–∏—Å–æ–∫ –±–µ–∑ —Ñ–∞–π–ª–æ–≤ #}
                                <ul>
                                    {% for item in block.get('items', []) %}
                                    {% if item is mapping %}
                                    <li>{{ item.get('text') or item.get('title') or item.get('name') or item }}</li>
                                    {% else %}
                                    <li>{{ item }}</li>
                                    {% endif %}
                                    {% endfor %}
                                </ul>
                                {% endif %}
                                {% endif %}
                            </div>

                            {% elif block.get('type') == 'documents' %}
                            <div class="documents-content" role="list">
                                {% if block.get('documents') %}
                                <div class="documents-list" style="display: flex; flex-direction: column; gap: 8px;">
                                    {% for doc in block.get('documents', []) %}
                                    {% set doc_url = doc.get('url', '') if doc is mapping else doc %}
                                    {% set doc_name = doc.get('name', '') if doc is mapping else (doc.split('/')[-1] if
                                    doc else '–î–æ–∫—É–º–µ–Ω—Ç') %}
                                    {% if doc_url %}
                                    <div role="listitem" itemprop="document" itemscope="itemscope"
                                        itemtype="https://schema.org/MediaObject">
                                        <a href="{{ doc_url }}" target="_blank" class="document-link" {% if
                                            doc_url.startswith('/download_file/') %}download{% endif %}
                                            style="display: flex; align-items: center; gap: 10px; padding: 8px 0; text-decoration: none; color: #2563eb; transition: color 0.2s; border-bottom: 1px solid transparent;"
                                            itemprop="contentUrl">
                                            <span style="font-size: 18px; flex-shrink: 0;">üìÑ</span>
                                            <span style="font-weight: 400; line-height: 1.5;">{{ doc_name }}</span>
                                        </a>
                                    </div>
                                    {% endif %}
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>

                            {% elif block.get('type') == 'photos' %}
                            <div class="photos-content" itemprop="photos" role="list">
                                {% if block.get('photos') %}
                                <div class="info-photo-row">
                                    {% for photo_url in block.get('photos', []) %}
                                    {% if photo_url %}
                                    <div class="info-photo-item" role="listitem" itemprop="photo" itemscope="itemscope"
                                        itemtype="https://schema.org/ImageObject">
                                        <img class="js-previewable" src="{{ photo_url }}" data-full="{{ photo_url }}" alt="–§–æ—Ç–æ"
                                            style="width: 100%; height: 170px; object-fit: cover; border-radius: 12px; cursor: pointer; display: block; transition: box-shadow 0.2s;"
                                            onmouseover="this.style.boxShadow='0 8px 24px rgba(0,0,0,0.2)'"
                                            onmouseout="this.style.boxShadow='none'"
                                            onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg%20xmlns%3D%27http%3A//www.w3.org/2000/svg%27%20width%3D%27400%27%20height%3D%27400%27%3E%3Crect%20width%3D%27100%25%27%20height%3D%27100%25%27%20fill%3D%27%23f1f5f9%27/%3E%3Ctext%20x%3D%2750%25%27%20y%3D%2750%25%27%20dominant-baseline%3D%27middle%27%20text-anchor%3D%27middle%27%20fill%3D%27%2394a3b8%27%20font-family%3D%27Arial%27%20font-size%3D%2718%27%3E%D0%A4%D0%BE%D1%82%D0%BE%3C/text%3E%3C/svg%3E';"
                                            loading="lazy" itemprop="contentUrl">
                                    </div>
                                    {% endif %}
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>

                            {% elif block.get('type') == 'person' %}
                            {% set person_ip = block.get('person_itemprop_mapping') or {} %}
                            {% set block_itemprop = block.get('itemprop') or '' %}
                            {% set list_itemprop = block_itemprop or ('teachingStaff' if section.endpoint == 'teachers' else '') %}
                            {% set card_itemprop = block_itemprop or ('teacher' if section.endpoint == 'teachers' else '') %}
                            {% set ip_name = person_ip.get('name') or ('fio' if section.endpoint == 'teachers' else 'name') %}
                            {% set ip_position = person_ip.get('position') or ('post' if section.endpoint == 'teachers' else 'jobTitle') %}
                            {% set ip_photo = person_ip.get('photo') or 'image' %}
                            {% set ip_email = person_ip.get('email') or 'email' %}
                            {% set ip_phone = person_ip.get('phone') or 'telephone' %}
                            {% set ip_education = person_ip.get('education') or ('teachingLevel' if section.endpoint == 'teachers' else 'education') %}
                            {% set ip_experience = person_ip.get('experience') or ('specExperience' if section.endpoint == 'teachers' else 'experience') %}
                            {% set ip_description = person_ip.get('description') or 'description' %}
                            {% set ip_retraining = person_ip.get('professional_retraining') or 'hasCredential' %}
                            {% set ip_awards = person_ip.get('awards') or 'award' %}
                            {% set ip_courses = person_ip.get('courses') or 'knowsAbout' %}
                            <div class="persons-content">
                                {% if block.get('persons') %}
                                <div class="persons-grid persons-cards-grid" {% if list_itemprop %}itemprop="{{ list_itemprop }}" itemscope="itemscope" itemtype="https://schema.org/ItemList" role="list"{% endif %}>
                                    {% for person in block.get('persons', []) %}
                                    {% if person.get('name') or person.get('position') %}
                                    {% set person_photo_raw = person.get('photo') or person.get('photo_url') or '' %}
                                    {% set person_photo_src = person_photo_raw.split('|')[0].strip() if person_photo_raw and '|' in person_photo_raw else person_photo_raw %}
                                    <div class="person-card person-card-clickable" role="button" tabindex="0" data-person-data-id="person-data-{{ block_idx }}-{{ loop.index0 }}" {% if card_itemprop %}itemprop="{{ card_itemprop }}" itemscope="itemscope" itemtype="https://schema.org/Person"{% endif %}>
                                        <div class="person-card-preview">
                                            <div class="person-card-photo-wrap" {% if ip_photo %}itemprop="{{ ip_photo }}"{% endif %}>
                                                {% if person_photo_src and person_photo_src.strip() %}
                                                <img src="{{ person_photo_src }}" alt="{{ person.get('name', '') }}" class="person-card-image" loading="lazy" onerror="this.style.display='none'; this.parentElement.classList.add('person-card-photo-placeholder');">
                                                {% else %}
                                                <div class="person-card-photo-placeholder">–§–æ—Ç–æ</div>
                                                {% endif %}
                                            </div>
                                            <h3 class="person-card-name" {% if ip_name %}itemprop="{{ ip_name }}"{% endif %}>{{ person.get('name', '') or '‚Äî' }}</h3>
                                            <p class="person-card-position" {% if ip_position %}itemprop="{{ ip_position }}"{% endif %}>{{ person.get('position', '') or '‚Äî' }}</p>
                                        </div>
                                    </div>
                                    <script type="application/json" id="person-data-{{ block_idx }}-{{ loop.index0 }}" class="person-data-json">{{ person | tojson }}</script>
                                    {% endif %}
                                    {% endfor %}
                                </div>
                                {% endif %}
                            </div>

                            {% elif block.get('type') == 'daily-dish' %}
                            {# –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–∏—Ç–∞–Ω–∏—è –±–ª—é–¥–∞ —Ç–∏–ø–∞ daily-dish –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ content-blocks, –æ–Ω–∏
                            –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–º –±–ª–æ–∫–µ "–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –º–µ–Ω—é" #}
                            {% if section.endpoint != 'food' %}
                            <div class="daily-dish-content">
                                {% set dish = block.get('dish', {}) %}
                                {% if dish %}
                                <div class="dish-item"
                                    style="display: flex; gap: 16px; padding: 16px; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 12px; margin-bottom: 16px; transition: all 0.2s;">
                                    {% if dish.get('photo') %}
                                    <div class="dish-photo" style="flex-shrink: 0; cursor: pointer;" onclick="openImgPreview('{{ dish.get('photo') | e }}')">
                                        <img src="{{ dish.get('photo') }}" alt="{{ dish.get('title', '') }}"
                                            class="dish-image"
                                            style="width: 120px; height: 120px; object-fit: cover; border-radius: 8px; border: 1px solid #e5e7eb;"
                                            onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg%20xmlns%3D%27http%3A//www.w3.org/2000/svg%27%20width%3D%27400%27%20height%3D%27400%27%3E%3Crect%20width%3D%27100%25%27%20height%3D%27100%25%27%20fill%3D%27%23f1f5f9%27/%3E%3Ctext%20x%3D%2750%25%27%20y%3D%2750%25%27%20dominant-baseline%3D%27middle%27%20text-anchor%3D%27middle%27%20fill%3D%27%2394a3b8%27%20font-family%3D%27Arial%27%20font-size%3D%2718%27%3E%D0%A4%D0%BE%D1%82%D0%BE%3C/text%3E%3C/svg%3E';" loading="lazy">
                                    </div>
                                    {% endif %}
                                    <div class="dish-info" style="flex: 1;">
                                        {% if dish.get('title') %}
                                        <h3 class="dish-title"
                                            style="margin: 0 0 8px 0; font-size: 1.25rem; color: #1f2937; font-weight: 600;">
                                            {{ dish.get('title') }}</h3>
                                        {% endif %}
                                        {% if dish.get('date') %}
                                        <p class="dish-date" style="margin: 0; color: #6b7280; font-size: 0.95rem;">
                                            <strong>–î–∞—Ç–∞:</strong> {{ dish.get('date') }}
                                        </p>
                                        {% endif %}
                                        {% if dish.get('publish_date') %}
                                        <p class="dish-publish-date"
                                            style="margin: 4px 0 0 0; color: #9ca3af; font-size: 0.85rem;">
                                            <strong>–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ:</strong> {{ dish.get('publish_date') }}
                                        </p>
                                        {% endif %}
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                            {% endif %}

                            {% elif block.get('type') == 'dishes' %}
                            {% if section.endpoint != 'food' %}
                            <div class="dishes-content">
                                {% set archive_dishes = block.get('dishes', []) %}
                                {% set all_dishes = [] %}
                                {% if section.endpoint == 'nutrition-dishes-archive' %}
                                {# –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∞—Ä—Ö–∏–≤–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –±–ª—é–¥–∞ –∏–∑ –±–ª–æ–∫–∞ "–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –º–µ–Ω—é" #}
                                {% for dish in archive_dishes %}
                                {% set _ = all_dishes.append(dish) %}
                                {% endfor %}
                                {% else %}
                                {# –ï—Å–ª–∏ –Ω–µ –∞—Ä—Ö–∏–≤, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –±–ª—é–¥–∞ –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –±–ª–æ–∫–∞ #}
                                {% for dish in archive_dishes %}
                                {% set _ = all_dishes.append(dish) %}
                                {% endfor %}
                                {% endif %}
                                {# –°–æ—Ä—Ç–∏—Ä—É–µ–º –±–ª—é–¥–∞: –Ω–æ–≤—ã–µ –≤–≤–µ—Ä—Ö—É, –∑–∞—Ç–µ–º –ø–æ –¥–∞—Ç–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø–æ —É–±—ã–≤–∞–Ω–∏—é #}
                                {% set all_dishes = all_dishes | sort_dishes_by_date %}
                                {% if all_dishes %}
                                <style>
                                    .daily-dish-card {
                                        display: flex;
                                        gap: 18px;
                                        padding: 18px;
                                        border-radius: 22px;
                                        border: 1px solid #e5e7eb;
                                        background: #f9fafb;
                                        box-shadow: 0 1px 3px rgba(0,0,0,0.06);
                                        position: relative;
                                        overflow: hidden;
                                    }

                                    .daily-dish-card::before {
                                        content: "";
                                        position: absolute;
                                        inset: 0;
                                        border-radius: 22px;
                                        pointer-events: none;
                                        box-shadow: inset 0 0 0 1px rgba(0,0,0,0.04);
                                    }

                                    .daily-dish-photo {
                                        width: 160px;
                                        height: 160px;
                                        border-radius: 26px;
                                        border: 1px solid #e5e7eb;
                                        background: #ffffff;
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                        overflow: hidden;
                                        flex-shrink: 0;
                                        position: relative;
                                    }

                                    .daily-dish-photo img {
                                        width: 100%;
                                        height: 100%;
                                        object-fit: cover;
                                        display: block;
                                    }

                                    .daily-dish-meta {
                                        flex: 1;
                                        min-width: 0;
                                        padding-right: 110px;
                                    }

                                    .daily-dish-meta .label {
                                        margin: 0 0 6px 0;
                                        font-size: 12px;
                                        font-weight: 800;
                                        letter-spacing: 0.02em;
                                        color: #6b7280;
                                        text-transform: uppercase;
                                    }

                                    .daily-dish-meta .value {
                                        margin: 0 0 14px 0;
                                        font-size: 18px;
                                        font-weight: 800;
                                        color: #111827;
                                        overflow: hidden;
                                        text-overflow: ellipsis;
                                        white-space: nowrap;
                                    }

                                    .daily-dish-actions {
                                        position: absolute;
                                        top: 14px;
                                        right: 14px;
                                        display: flex;
                                        gap: 10px;
                                        z-index: 2;
                                    }

                                    .daily-dish-action-btn {
                                        width: 44px;
                                        height: 44px;
                                        border-radius: 12px;
                                        border: 1px solid #e5e7eb;
                                        background: #ffffff;
                                        color: #111827;
                                        cursor: pointer;
                                        display: inline-flex;
                                        align-items: center;
                                        justify-content: center;
                                        font-weight: 900;
                                        transition: transform 0.12s ease, background 0.12s ease;
                                    }

                                    .daily-dish-action-btn:hover {
                                        transform: translateY(-1px);
                                        background: #f3f4f6;
                                    }

                                    .daily-dish-action-btn.delete {
                                        background: #ef4444;
                                        border-color: #ef4444;
                                        color: #ffffff;
                                    }

                                    .daily-dish-action-btn.delete:hover {
                                        background: #dc2626;
                                    }

                                    .daily-dish-focus {
                                        animation: dailyDishFocusPulse 1.1s ease-out 1;
                                        outline: 3px solid rgba(245, 158, 11, 0.9);
                                        outline-offset: 2px;
                                    }

                                    @keyframes dailyDishFocusPulse {
                                        0% {
                                            box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.65);
                                        }
                                        100% {
                                            box-shadow: 0 0 0 18px rgba(245, 158, 11, 0);
                                        }
                                    }
                                </style>

                                <div class="dishes-list" id="daily-menu-dishes-list"
                                    style="display: flex; flex-direction: column; gap: 18px;">
                                    {% for dish in all_dishes %}
                                    {% set dish_publish = dish.get('publish_date') or dish.get('date') %}
                                    {% set dp = (dish_publish|string)|trim %}
                                    {% set month_num = '' %}
                                    {% set year_num = '' %}
                                    {% if dp and '.' in dp %}
                                        {% set parts = dp.split('.') %}
                                        {% if parts|length >= 3 %}
                                            {% set month_num = parts[1] %}
                                            {% set year_num = parts[2] %}
                                        {% endif %}
                                    {% elif dp and '-' in dp %}
                                        {% set parts = dp.split('-') %}
                                        {% if parts|length >= 3 %}
                                            {% set year_num = parts[0] %}
                                            {% set month_num = parts[1] %}
                                        {% endif %}
                                    {% endif %}
                                    {% set month_key = (year_num ~ '-' ~ month_num) if (year_num and month_num) else 'unknown' %}
                                    {% set menu_file_url = dish.get('menu_file_url') or dish.get('menu_file') %}
                                    {% set menu_file_name = dish.get('menu_file_name') or (menu_file_url.split('/')[-1] if menu_file_url else '–§–∞–π–ª –º–µ–Ω—é') %}

                                    <div class="daily-dish-card" data-dish-index="{{ loop.index0 }}" data-month-key="{{ month_key }}">
                                        <div class="daily-dish-photo" {% if dish.get('photo') %}onclick="openImgPreview('{{ dish.get('photo') | e }}')" style="cursor: pointer;"{% endif %}>
                                        {% if dish.get('photo') %}
                                            <img src="{{ dish.get('photo') }}" alt="{{ dish.get('title', '') }}"
                                                onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg%20xmlns%3D%27http%3A//www.w3.org/2000/svg%27%20width%3D%27400%27%20height%3D%27400%27%3E%3Crect%20width%3D%27100%25%27%20height%3D%27100%25%27%20fill%3D%27%23f1f5f9%27/%3E%3Ctext%20x%3D%2750%25%27%20y%3D%2750%25%27%20dominant-baseline%3D%27middle%27%20text-anchor%3D%27middle%27%20fill%3D%27%2394a3b8%27%20font-family%3D%27Arial%27%20font-size%3D%2718%27%3E%D0%A4%D0%BE%D1%82%D0%BE%3C/text%3E%3C/svg%3E';" loading="lazy">
                                            {% endif %}
                                        </div>

                                        <div class="daily-dish-meta">
                                            <div class="value">{{ dish.get('title', '‚Äî') }}</div>

                                            <div class="label">–î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</div>
                                            <div class="value" style="font-size: 16px; font-weight: 800;">{{ dish_publish or '‚Äî' }}</div>

                                            <div class="label">–§–∞–π–ª –ø–∏—Ç–∞–Ω–∏—è</div>
                                            <div class="value" style="font-size: 14px; font-weight: 800;">
                                                {% if menu_file_url %}
                                                <a href="{{ menu_file_url }}" target="_blank"
                                                    style="color:#2563eb; text-decoration:none; font-weight:900;">{{ menu_file_name }}</a>
                                                {% else %}
                                                ‚Äî
                                            {% endif %}
                                        </div>
                                        </div>

                                        {% if section.endpoint == 'nutrition-dishes-archive' and current_user.is_authenticated %}
                                        <div class="daily-dish-actions">
                                            <button type="button" class="daily-dish-action-btn" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –±–ª—é–¥–æ"
                                                onclick="openEditDailyMenuDishes({ focusIndex: {{ loop.index0 }} })">‚úèÔ∏è</button>
                                            <button type="button" class="daily-dish-action-btn delete" title="–£–¥–∞–ª–∏—Ç—å –±–ª—é–¥–æ"
                                                onclick="deleteDishFromArchive('{{ dish.get('publish_date', dish.get('date', '')) }}', '{{ dish.get('title', '')|e }}')">üóëÔ∏è</button>
                                        </div>
                                        {% endif %}
                                    </div>
                                    {% endfor %}
                                </div>

                                {% if section.endpoint == 'nutrition-dishes-archive' and block.get('title') == '–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –º–µ–Ω—é' %}
                                <script>
                                    (function () {
                                        function parseTodayMonthKey(todayStr) {
                                            const s = String(todayStr || '').trim();
                                            if (!s) return null;
                                            // expected dd.mm.yyyy
                                            const parts = s.split('.');
                                            if (parts.length !== 3) return null;
                                            const mm = parts[1];
                                            const yyyy = parts[2];
                                            if (!mm || !yyyy) return null;
                                            return `${yyyy}-${mm}`;
                                        }

                                        const monthNames = {
                                            '01': '–Ø–Ω–≤–∞—Ä—å',
                                            '02': '–§–µ–≤—Ä–∞–ª—å',
                                            '03': '–ú–∞—Ä—Ç',
                                            '04': '–ê–ø—Ä–µ–ª—å',
                                            '05': '–ú–∞–π',
                                            '06': '–ò—é–Ω—å',
                                            '07': '–ò—é–ª—å',
                                            '08': '–ê–≤–≥—É—Å—Ç',
                                            '09': '–°–µ–Ω—Ç—è–±—Ä—å',
                                            '10': '–û–∫—Ç—è–±—Ä—å',
                                            '11': '–ù–æ—è–±—Ä—å',
                                            '12': '–î–µ–∫–∞–±—Ä—å'
                                        };

                                        function monthLabel(monthKey) {
                                            if (!monthKey || monthKey === 'unknown') return '–ë–µ–∑ –¥–∞—Ç—ã';
                                            const [yyyy, mm] = monthKey.split('-');
                                            const name = monthNames[mm] || mm;
                                            return `${name} ${yyyy}`;
                                        }

                                        const list = document.getElementById('daily-menu-dishes-list');
                                        if (!list) return;

                                        const cards = Array.from(list.querySelectorAll('.daily-dish-card'));
                                        if (cards.length === 0) return;

                                        const monthsSet = new Set();
                                        cards.forEach(c => monthsSet.add(c.getAttribute('data-month-key') || 'unknown'));

                                        const months = Array.from(monthsSet).sort((a, b) => {
                                            if (a === 'unknown' && b !== 'unknown') return 1;
                                            if (b === 'unknown' && a !== 'unknown') return -1;
                                            // desc
                                            return String(b).localeCompare(String(a));
                                        });

                                        const currentKey = parseTodayMonthKey('{{ today }}') || months[0];

                                        // Build accordion container above current list, then move cards into month groups.
                                        const accordion = document.createElement('div');
                                        accordion.id = 'daily-menu-months-accordion';
                                        accordion.style.cssText = 'display:flex; flex-direction:column; gap: 12px; margin-top: 6px;';
                                        list.parentNode.insertBefore(accordion, list);

                                        const style = document.createElement('style');
                                        style.textContent = `
                                            .dm-month-btn{
                                                width: 100%;
                                                text-align: left;
                                                padding: 14px 18px;
                                                border-radius: 14px;
                                                border: 1px solid #e5e7eb;
                                                background: #ffffff;
                                                cursor: pointer;
                                                font-weight: 900;
                                                color: #111827;
                                                display:flex;
                                                justify-content: space-between;
                                                align-items: center;
                                                gap: 12px;
                                                box-shadow: 0 1px 2px rgba(0,0,0,0.04);
                                                transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease, border-color 0.12s ease, color 0.12s ease;
                                            }
                                            .dm-month-btn:hover{
                                                transform: translateY(-1px);
                                                border-color: #cbd5e1;
                                                box-shadow: 0 6px 16px rgba(15, 23, 42, 0.06);
                                            }
                                            .dm-month-btn.active{
                                                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                                border-color: rgba(118, 75, 162, 0.45);
                                                color: #ffffff;
                                                box-shadow: 0 10px 24px rgba(102, 126, 234, 0.18);
                                            }
                                            .dm-month-caret{
                                                font-weight: 900;
                                                opacity: 0.9;
                                            }
                                            .dm-month-panel{
                                                display: none;
                                                padding-top: 12px;
                                            }
                                            .dm-month-panel.open{
                                                display: flex;
                                                flex-direction: column;
                                                gap: 18px;
                                            }
                                        `;
                                        document.head.appendChild(style);

                                        function setOpenMonth(key) {
                                            const sections = Array.from(accordion.querySelectorAll('[data-month-section]'));
                                            sections.forEach(sec => {
                                                const mk = sec.getAttribute('data-month-section') || 'unknown';
                                                const btn = sec.querySelector('.dm-month-btn');
                                                const panel = sec.querySelector('.dm-month-panel');
                                                const caret = sec.querySelector('.dm-month-caret');
                                                const isOpen = mk === key;
                                                if (btn) btn.classList.toggle('active', isOpen);
                                                if (panel) panel.classList.toggle('open', isOpen);
                                                if (caret) caret.textContent = isOpen ? '‚ñæ' : '‚ñ∏';
                                            });
                                        }

                                        months.forEach(mk => {
                                            const sec = document.createElement('div');
                                            sec.setAttribute('data-month-section', mk);

                                            const btn = document.createElement('button');
                                            btn.type = 'button';
                                            btn.className = 'dm-month-btn';
                                            btn.innerHTML = `<span>${monthLabel(mk)}</span><span class="dm-month-caret">‚ñ∏</span>`;

                                            const panel = document.createElement('div');
                                            panel.className = 'dm-month-panel';

                                            // Move cards of this month into panel
                                            cards
                                                .filter(c => (c.getAttribute('data-month-key') || 'unknown') === mk)
                                                .forEach(c => panel.appendChild(c));

                                            btn.addEventListener('click', () => {
                                                setOpenMonth(mk);
                                                btn.scrollIntoView({ behavior: 'smooth', block: 'start' });
                                            });

                                            sec.appendChild(btn);
                                            sec.appendChild(panel);
                                            accordion.appendChild(sec);
                                        });

                                        // Hide the original list container; cards are moved into accordion panels.
                                        list.style.display = 'none';
                                        setOpenMonth(currentKey);
                                    })();
                                </script>
                                {% endif %}
                                {% endif %}
                            </div>
                            {% else %}
                            <div style="padding: 16px; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 12px;">
                                <a href="{{ url_for('sidebar.nutrition_dishes_archive') }}"
                                    style="color: #2563eb; text-decoration: none; font-weight: 700;">üçΩÔ∏è –ë–ª—é–¥–∞ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ —Ä–∞–∑–¥–µ–ª–µ ¬´–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –º–µ–Ω—é¬ª</a>
                            </div>
                            {% endif %}
                            {% endif %}
                        </div>
                        {% endif %}
                        {% endfor %}
                    </div>

                    {% if section.endpoint == 'food' %}
                    <!-- –†–∞–∑–¥–µ–ª –º–µ–Ω—é –ø–∏—Ç–∞–Ω–∏—è (Excel —Ñ–∞–π–ª—ã) - –≤—Å–µ–≥–¥–∞ –≤ –∫–æ–Ω—Ü–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
                    <div class="nutrition-menu-section" id="nutrition-menu-section"
                        style="margin-top: 60px; padding-top: 40px; border-top: 2px solid #e5e7eb;">
                        <h2 class="nutrition-menu-title">üìã –ú–µ–Ω—é –Ω–∞ –¥–µ–Ω—å (Excel —Ñ–∞–π–ª—ã)</h2>

                        <div class="nutrition-menu-info">
                            <p>
                                –ù–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –ø–∏—Å—å–º–∞ –ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–∞ –ø—Ä–æ—Å–≤–µ—â–µ–Ω–∏—è –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏ ‚Ññ –ì–î-1158/01 –æ—Ç
                                17.05.2021,
                                –≤ —Ü–µ–ª—è—Ö –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∞–Ω–∞–ª–∏–∑–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –≥–æ—Ä—è—á–µ–≥–æ
                                –ø–∏—Ç–∞–Ω–∏—è –æ–±—É—á–∞—é—â–∏—Ö—Å—è
                                –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–∞–º –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –æ–±—â–µ–≥–æ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏ –º—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω—ã–µ
                                –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
                                –æ–±—è–∑–∞–Ω—ã –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –º–µ–Ω—é –≤ —Ñ–æ—Ä–º–∞—Ç–µ XLSX –Ω–∞ —Å–≤–æ–∏—Ö —Å–∞–π—Ç–∞—Ö, –Ω–∞—á–∏–Ω–∞—è —Å 19 –º–∞—è 2021
                                –≥–æ–¥–∞.
                            </p>
                            <p>
                                –†–∞–∑–¥–µ–ª "–ü–∏—Ç–∞–Ω–∏–µ" —Å–æ–∑–¥–∞–Ω –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã —à–∫–æ–ª—å–Ω–æ–≥–æ –ø–∏—Ç–∞–Ω–∏—è –∏ –ø–æ–≤—ã—à–µ–Ω–∏—è
                                –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ —Ä–æ–¥–∏—Ç–µ–ª–µ–π.
                                –î–∞–Ω–Ω—ã–π —Ä–∞–∑–¥–µ–ª –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ —É–ø—Ä–æ—â–µ–Ω–∏–µ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–µ–Ω—é, –ø–æ–∑–≤–æ–ª—è–µ—Ç
                                –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –º–µ–Ω—é
                                –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –Ω–æ—Ä–º–∞–º –∑–¥–æ—Ä–æ–≤–æ–≥–æ –ø–∏—Ç–∞–Ω–∏—è.
                            </p>
                        </div>

                        <!-- –§–∏–ª—å—Ç—Ä—ã –¥–ª—è —Ñ–∞–π–ª–æ–≤ –º–µ–Ω—é -->
                        <div class="menu-filters">
                            <div class="filters-row">
                                <label class="filter-label">
                                    <strong>–ì–æ–¥:</strong>
                                    <select id="menu-year-filter" class="filter-select">
                                        <option value="">–í—Å–µ –≥–æ–¥—ã</option>
                                    </select>
                                </label>

                                <label class="filter-label">
                                    <strong>–ú–µ—Å—è—Ü:</strong>
                                    <select id="menu-month-filter" class="filter-select">
                                        <option value="">–í—Å–µ –º–µ—Å—è—Ü—ã</option>
                                    </select>
                                </label>

                                <label class="filter-label">
                                    <strong>–î–µ–Ω—å:</strong>
                                    <select id="menu-day-filter" class="filter-select">
                                        <option value="">–í—ã–±—Ä–∞—Ç—å –¥–µ–Ω—å</option>
                                    </select>
                                </label>

                                <button onclick="resetMenuFilters()" class="btn btn-reset">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
                            </div>
                        </div>

                        {% if current_user.is_authenticated %}
                        <!-- –§–æ—Ä–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ –º–µ–Ω—é (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤) -->
                        <div class="menu-upload-form">
                            <h3 class="upload-title">üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª—ã –º–µ–Ω—é</h3>
                            <p style="margin: 0 0 16px 0; color: #92400e; font-size: 14px; line-height: 1.5;">
                                <strong>–í–∞–∂–Ω–æ:</strong> –î–∞—Ç–∞ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∞ –∏–∑ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞. –ò–º—è —Ñ–∞–π–ª–∞
                                –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ <code>YYYY-MM-DD-sm.xlsx</code> (–Ω–∞–ø—Ä–∏–º–µ—Ä:
                                <code>2025-10-02-sm.xlsx</code>).
                                –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å –¥–æ–ø. —Ñ–∞–π–ª—ã: <code>tmYYYY-sm.xlsx</code>, <code>kpYYYY.xlsx</code>,
                                <code>findex.xlsx</code>.
                            </p>
                            <form id="menu-upload-form" onsubmit="uploadMenuFiles(event)" class="upload-form">
                                <div class="upload-field upload-field-file">
                                    <label class="upload-label">–§–∞–π–ª—ã Excel:</label>
                                    <input type="file" id="menu-files" name="files" accept=".xlsx,.xls" multiple
                                        required class="upload-input upload-file">
                                    <div id="selected-files" class="selected-files"></div>
                                </div>
                                <button type="submit" class="btn btn-upload">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                            </form>
                            <div id="menu-upload-status" class="upload-status"></div>
                        </div>
                        {% endif %}

                        <!-- –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –º–µ–Ω—é -->
                        <div class="menu-files-list">
                            <h3 class="files-title">üìÑ –§–∞–π–ª—ã –º–µ–Ω—é</h3>
                            <div id="menu-files-container" class="files-container">
                                <div class="loading-state">
                                    <div class="spinner"></div>
                                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤...</p>
                                </div>
                            </div>

                            <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã (tmYYYY-sm.xlsx, kpYYYY.xlsx, findex.xlsx) -->
                            <div class="menu-files-list" style="margin-top: 18px;">
                                <h3 class="files-title">üìé –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã</h3>
                                <div id="menu-static-files-container" class="files-container"></div>
                            </div>
                        </div>
                    </div>

                    <style>
                        .nutrition-menu-section {
                            margin-top: 60px;
                            padding-top: 40px;
                            border-top: 2px solid #e5e7eb;
                        }

                        .nutrition-menu-title {
                            margin: 0 0 24px 0;
                            color: #1f2937;
                            font-size: 1.75rem;
                            font-weight: 600;
                            border-bottom: 3px solid #3b82f6;
                            padding-bottom: 12px;
                        }

                        .nutrition-menu-info {
                            background: #f8fafc;
                            border: 1px solid #e5e7eb;
                            border-radius: 10px;
                            padding: 24px;
                            margin-bottom: 24px;
                            line-height: 1.7;
                        }

                        .nutrition-menu-info p {
                            margin: 0 0 16px 0;
                            color: #4b5563;
                            font-size: 15px;
                        }

                        .nutrition-menu-info p:last-child {
                            margin-bottom: 0;
                        }

                        .menu-filters {
                            background: white;
                            border: 1px solid #e5e7eb;
                            border-radius: 10px;
                            padding: 24px;
                            margin-bottom: 24px;
                            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
                        }

                        .filters-row {
                            display: flex;
                            gap: 16px;
                            align-items: flex-end;
                            flex-wrap: wrap;
                        }

                        .filter-label {
                            display: flex;
                            flex-direction: column;
                            gap: 8px;
                        }

                        .filter-label strong {
                            color: #374151;
                            font-size: 14px;
                            font-weight: 600;
                        }

                        .filter-select {
                            padding: 10px 16px;
                            border: 1px solid #d1d5db;
                            border-radius: 8px;
                            font-size: 14px;
                            color: #1f2937;
                            background: white;
                            min-width: 150px;
                            cursor: pointer;
                            transition: all 0.2s;
                        }

                        .filter-select:hover {
                            border-color: #3b82f6;
                        }

                        .filter-select:focus {
                            outline: none;
                            border-color: #3b82f6;
                            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
                        }

                        .btn-reset {
                            padding: 10px 20px;
                            background: #6b7280;
                            color: white;
                            border: none;
                            border-radius: 8px;
                            font-size: 14px;
                            font-weight: 500;
                            cursor: pointer;
                            transition: all 0.2s;
                        }

                        .btn-reset:hover {
                            background: #4b5563;
                            transform: translateY(-1px);
                            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                        }

                        .menu-upload-form {
                            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
                            border: 2px solid #fbbf24;
                            border-radius: 10px;
                            padding: 24px;
                            margin-bottom: 24px;
                            box-shadow: 0 2px 8px rgba(251, 191, 36, 0.2);
                        }

                        .upload-title {
                            margin: 0 0 20px 0;
                            color: #92400e;
                            font-size: 1.3rem;
                            font-weight: 600;
                        }

                        .upload-form {
                            display: flex;
                            gap: 16px;
                            align-items: flex-end;
                            flex-wrap: wrap;
                        }

                        .upload-field {
                            flex: 1;
                            min-width: 200px;
                        }

                        .upload-field-file {
                            flex: 1;
                            min-width: 400px;
                        }

                        .menu-upload-form code {
                            background: rgba(0, 0, 0, 0.1);
                            padding: 2px 6px;
                            border-radius: 4px;
                            font-family: 'Fira Code', monospace;
                            font-size: 13px;
                        }

                        .upload-label {
                            display: block;
                            margin-bottom: 8px;
                            color: #374151;
                            font-weight: 500;
                            font-size: 14px;
                        }

                        .upload-input {
                            width: 100%;
                            padding: 10px 14px;
                            border: 1px solid #d1d5db;
                            border-radius: 8px;
                            font-size: 14px;
                            color: #1f2937;
                            background: white;
                            transition: all 0.2s;
                            box-sizing: border-box;
                        }

                        .upload-input:focus {
                            outline: none;
                            border-color: #3b82f6;
                            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
                        }

                        .upload-file {
                            cursor: pointer;
                        }

                        .selected-files {
                            margin-top: 8px;
                            padding: 8px;
                            background: rgba(255, 255, 255, 0.7);
                            border-radius: 6px;
                            font-size: 13px;
                            color: #374151;
                            min-height: 20px;
                        }

                        .selected-file-item {
                            display: inline-block;
                            padding: 4px 8px;
                            margin: 4px 4px 0 0;
                            background: #3b82f6;
                            color: white;
                            border-radius: 4px;
                            font-size: 12px;
                        }

                        .btn-upload {
                            padding: 10px 24px;
                            background: #3b82f6;
                            color: white;
                            border: none;
                            border-radius: 8px;
                            font-size: 14px;
                            font-weight: 500;
                            cursor: pointer;
                            transition: all 0.2s;
                            white-space: nowrap;
                        }

                        .btn-upload:hover {
                            background: #2563eb;
                            transform: translateY(-1px);
                            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3);
                        }

                        .btn-upload:active {
                            transform: translateY(0);
                        }

                        .upload-status {
                            margin-top: 16px;
                            padding: 12px;
                            border-radius: 6px;
                            font-size: 14px;
                        }

                        .upload-status.success {
                            background: #d1fae5;
                            color: #065f46;
                            border: 1px solid #10b981;
                        }

                        .upload-status.error {
                            background: #fee2e2;
                            color: #991b1b;
                            border: 1px solid #ef4444;
                        }

                        .upload-status.info {
                            background: #dbeafe;
                            color: #1e40af;
                            border: 1px solid #3b82f6;
                        }

                        .menu-files-list {
                            background: white;
                            border: 1px solid #e5e7eb;
                            border-radius: 10px;
                            padding: 24px;
                            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
                        }

                        .files-title {
                            margin: 0 0 20px 0;
                            color: #1f2937;
                            font-size: 1.3rem;
                            font-weight: 600;
                        }

                        .files-container {
                            max-height: 600px;
                            overflow-y: auto;
                            overflow-x: hidden;
                        }

                        .files-container::-webkit-scrollbar {
                            width: 8px;
                        }

                        .files-container::-webkit-scrollbar-track {
                            background: #f1f5f9;
                            border-radius: 4px;
                        }

                        .files-container::-webkit-scrollbar-thumb {
                            background: #cbd5e1;
                            border-radius: 4px;
                        }

                        .files-container::-webkit-scrollbar-thumb:hover {
                            background: #94a3b8;
                        }

                        .loading-state {
                            text-align: center;
                            padding: 60px 40px;
                            color: #9ca3af;
                        }

                        .spinner {
                            display: inline-block;
                            width: 40px;
                            height: 40px;
                            border: 4px solid #f3f4f6;
                            border-top-color: #3b82f6;
                            border-radius: 50%;
                            animation: spin 1s linear infinite;
                        }

                        @keyframes spin {
                            to {
                                transform: rotate(360deg);
                            }
                        }

                        .loading-state p {
                            margin-top: 16px;
                            font-size: 14px;
                        }

                        .menu-file-item {
                            display: flex;
                            align-items: center;
                            gap: 16px;
                            padding: 16px;
                            margin-bottom: 12px;
                            background: #f9fafb;
                            border: 1px solid #e5e7eb;
                            border-radius: 8px;
                            transition: all 0.2s;
                        }

                        .menu-file-item:hover {
                            background: #f3f4f6;
                            border-color: #3b82f6;
                            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.1);
                            transform: translateY(-1px);
                        }

                        .menu-file-item .file-icon {
                            font-size: 28px;
                            flex-shrink: 0;
                        }

                        .menu-file-item .file-info {
                            flex: 1;
                        }

                        .menu-file-item .file-name {
                            font-weight: 500;
                            color: #1f2937;
                            margin-bottom: 6px;
                            font-size: 15px;
                        }

                        .menu-file-item .file-date {
                            font-size: 13px;
                            color: #6b7280;
                        }

                        .menu-file-item .file-download {
                            padding: 8px 20px;
                            background: #3b82f6;
                            color: white;
                            text-decoration: none;
                            border-radius: 8px;
                            font-size: 14px;
                            font-weight: 500;
                            transition: all 0.2s;
                            white-space: nowrap;
                        }

                        .menu-file-item .file-download:hover {
                            background: #2563eb;
                            transform: translateY(-1px);
                            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
                        }

                        .menu-files-empty {
                            text-align: center;
                            padding: 60px 40px;
                            color: #9ca3af;
                            font-size: 15px;
                        }

                        @media (max-width: 768px) {
                            .filters-row {
                                flex-direction: column;
                                align-items: stretch;
                            }

                            .filter-label {
                                width: 100%;
                            }

                            .filter-select {
                                width: 100%;
                            }

                            .upload-form {
                                flex-direction: column;
                                align-items: stretch;
                            }

                            .upload-field,
                            .upload-field-file {
                                width: 100%;
                            }

                            .menu-file-item {
                                flex-direction: column;
                                align-items: stretch;
                                text-align: center;
                            }

                            .menu-file-item .file-download {
                                width: 100%;
                            }
                        }
                    </style>

                    <script>
                        // –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∞–¥–º–∏–Ω-–¥–µ–π—Å—Ç–≤–∏–π (–∫–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è)
                        const canDeleteMenuFiles = {{ 'true' if current_user.is_authenticated else 'false' }};

                        function renderStaticMenuFiles() {
                            try {
                                const container = document.getElementById('menu-static-files-container');
                                if (!container) return;

                                // –ë–µ—Ä—ë–º –≥–æ–¥ –∏–∑ —Ñ–∏–ª—å—Ç—Ä–∞ (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω), –∏–Ω–∞—á–µ —Ç–µ–∫—É—â–∏–π
                                const selectedYear = document.getElementById('menu-year-filter')?.value || '';
                                const year = selectedYear ? Number(selectedYear) : new Date().getFullYear();
                                const files = [
                                    { filename: `tm${year}-sm.xlsx`, type: 'template' },
                                    { filename: `kp${year}.xlsx`, type: 'template' },
                                    { filename: 'findex.xlsx', type: 'template' }
                                ];

                                const itemsHtml = files.map(f => {
                                    const url = `/food/${encodeURIComponent(f.filename)}`;
                                    return `
                                        <div class="menu-file-item">
                                            <div class="file-icon">üìÑ</div>
                                            <div class="file-info">
                                                <div class="file-name">${f.filename}</div>
                                                <div class="file-date">–®–∞–±–ª–æ–Ω</div>
                                            </div>
                                            <div style="display:flex; gap: 10px; align-items:center; justify-content:flex-end;">
                                                <a href="${url}" download class="file-download">–°–∫–∞—á–∞—Ç—å</a>
                                                ${canDeleteMenuFiles ? `<button type="button" class="file-download" style="background:#ef4444; border-color:#ef4444;" onclick="deleteMenuFile('${f.filename}')">–£–¥–∞–ª–∏—Ç—å</button>` : ``}
                                            </div>
                                        </div>
                                    `;
                                }).join('');

                                container.innerHTML = itemsHtml;
                            } catch (e) {
                                console.error(e);
                            }
                        }

                        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –º–µ–Ω—é
                        async function loadMenuFiles() {
                            const year = document.getElementById('menu-year-filter')?.value || '';
                            const month = document.getElementById('menu-month-filter')?.value || '';
                            const day = document.getElementById('menu-day-filter')?.value || '';

                            const params = new URLSearchParams();
                            if (year) params.append('year', year);
                            if (month) params.append('month', month);
                            if (day) params.append('day', day);

                            try {
                                const response = await fetch(`/sidebar/api/nutrition/menu-files?${params.toString()}`);
                                const data = await response.json();

                                const container = document.getElementById('menu-files-container');
                                if (!container) return;

                                if (data.success && data.files && data.files.length > 0) {
                                    const monthNames = {
                                        1: '–Ø–Ω–≤–∞—Ä—å', 2: '–§–µ–≤—Ä–∞–ª—å', 3: '–ú–∞—Ä—Ç', 4: '–ê–ø—Ä–µ–ª—å', 5: '–ú–∞–π', 6: '–ò—é–Ω—å',
                                        7: '–ò—é–ª—å', 8: '–ê–≤–≥—É—Å—Ç', 9: '–°–µ–Ω—Ç—è–±—Ä—å', 10: '–û–∫—Ç—è–±—Ä—å', 11: '–ù–æ—è–±—Ä—å', 12: '–î–µ–∫–∞–±—Ä—å'
                                    };

                                    const pad2 = (n) => String(n).padStart(2, '0');
                                    const monthKey = (f) => `${f.year}-${pad2(f.month)}`;

                                    // group by month
                                    const groups = new Map();
                                    data.files.forEach(f => {
                                        const key = monthKey(f);
                                        if (!groups.has(key)) groups.set(key, []);
                                        groups.get(key).push(f);
                                    });

                                    // sort months desc
                                    const monthKeys = Array.from(groups.keys()).sort((a, b) => String(b).localeCompare(String(a)));
                                    const now = new Date();
                                    const currentKey = `${now.getFullYear()}-${pad2(now.getMonth() + 1)}`;
                                    const defaultMonth = monthKeys.includes(currentKey) ? currentKey : monthKeys[0];

                                    const fileItemHtml = (file) => `
                    <div class="menu-file-item">
                        <div class="file-icon">üìä</div>
                        <div class="file-info">
                            <div class="file-name">${file.filename}</div>
                            <div class="file-date">–î–∞—Ç–∞: ${file.date}</div>
                        </div>
                                            <div style="display:flex; gap: 10px; align-items:center; justify-content:flex-end;">
                        <a href="${file.url}" download class="file-download">–°–∫–∞—á–∞—Ç—å</a>
                                                ${canDeleteMenuFiles ? `<button type="button" class="file-download" style="background:#ef4444; border-color:#ef4444;" onclick="deleteMenuFile('${file.filename}')">–£–¥–∞–ª–∏—Ç—å</button>` : ``}
                    </div>
                                        </div>
                                    `;

                                    // Ensure styles for month UI exist once
                                    if (!document.getElementById('menu-month-accordion-styles')) {
                                        const style = document.createElement('style');
                                        style.id = 'menu-month-accordion-styles';
                                        style.textContent = `
                                            .mf-month-chip{
                                                border: 1px solid #e5e7eb;
                                                background: #ffffff;
                                                border-radius: 999px;
                                                padding: 10px 14px;
                                                cursor: pointer;
                                                font-weight: 900;
                                                color: #111827;
                                                box-shadow: 0 1px 2px rgba(0,0,0,0.04);
                                                transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease, border-color 0.12s ease, color 0.12s ease;
                                                white-space: nowrap;
                                            }
                                            .mf-month-chip:hover{
                                                transform: translateY(-1px);
                                                border-color: #cbd5e1;
                                                box-shadow: 0 6px 16px rgba(15, 23, 42, 0.06);
                                            }
                                            .mf-month-chip.active{
                                                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                                border-color: rgba(118, 75, 162, 0.45);
                                                color: #ffffff;
                                                box-shadow: 0 10px 24px rgba(102, 126, 234, 0.18);
                                            }
                                            .mf-month-bar{
                                                position: sticky;
                                                bottom: 0;
                                                background: #ffffff;
                                                border-top: 1px solid #e5e7eb;
                                                padding: 12px 0 0 0;
                                                margin-top: 14px;
                                            }
                                            .mf-month-row{
                                                display: flex;
                                                gap: 10px;
                                                overflow-x: auto;
                                                padding: 0 2px 10px 2px;
                                            }
                                            .mf-pager{
                                                display: flex;
                                                justify-content: space-between;
                                                align-items: center;
                                                gap: 12px;
                                                margin: 6px 0 10px 0;
                                            }
                                            .mf-pager-btn{
                                                border: 1px solid #e5e7eb;
                                                background: #ffffff;
                                                color: #111827;
                                                border-radius: 12px;
                                                padding: 10px 14px;
                                                cursor: pointer;
                                                font-weight: 900;
                                            }
                                            .mf-pager-btn:disabled{
                                                opacity: 0.45;
                                                cursor: default;
                                            }
                                            .mf-pager-info{
                                                color: #6b7280;
                                                font-weight: 800;
                                            }
                                        `;
                                        document.head.appendChild(style);
                                    }

                                    const labelFor = (mk) => {
                                        const [yyyy, mmStr] = String(mk).split('-');
                                        const mm = Number(mmStr);
                                        return `${monthNames[mm] || mmStr} ${yyyy}`;
                                    };

                                    // state (persist across reloads of list for same page session)
                                    const prevState = window.menuFilesUiState || {};
                                    const selectedMonth = monthKeys.includes(prevState.selectedMonth) ? prevState.selectedMonth : defaultMonth;
                                    const pageByMonth = prevState.pageByMonth && typeof prevState.pageByMonth === 'object' ? prevState.pageByMonth : {};

                                    window.menuFilesUiState = {
                                        selectedMonth,
                                        pageByMonth
                                    };

                                    container.innerHTML = `
                                        <div id="menu-files-list-area"></div>
                                        <div id="menu-files-pager" class="mf-pager"></div>
                                        <div class="mf-month-bar">
                                            <div class="mf-month-row" id="menu-files-month-row"></div>
                                        </div>
                                    `;

                                    const listArea = document.getElementById('menu-files-list-area');
                                    const pager = document.getElementById('menu-files-pager');
                                    const monthRow = document.getElementById('menu-files-month-row');
                                    if (!listArea || !pager || !monthRow) return;

                                    const pageSize = 10;

                                    function renderMonthButtons() {
                                        monthRow.innerHTML = monthKeys.map(mk => {
                                            const isActive = mk === window.menuFilesUiState.selectedMonth;
                                            return `<button type="button" class="mf-month-chip ${isActive ? 'active' : ''}" data-mk="${mk}">${labelFor(mk)}</button>`;
                                        }).join('');

                                        monthRow.querySelectorAll('button[data-mk]').forEach(btn => {
                                            btn.addEventListener('click', () => {
                                                const mk = btn.getAttribute('data-mk');
                                                if (!mk) return;
                                                window.menuFilesUiState.selectedMonth = mk;
                                                window.menuFilesUiState.pageByMonth[mk] = 0;
                                                render();
                                            });
                                        });
                                    }

                                    function render() {
                                        const mk = window.menuFilesUiState.selectedMonth;
                                        const files = groups.get(mk) || [];

                                        // sort –≤–Ω—É—Ç—Ä–∏ –º–µ—Å—è—Ü–∞ –ø–æ –¥–Ω—é desc
                                        const sorted = files.slice().sort((a, b) => (b.day || 0) - (a.day || 0));

                                        const total = sorted.length;
                                        const page = Math.max(0, Number(window.menuFilesUiState.pageByMonth[mk] || 0));
                                        const maxPage = Math.max(0, Math.ceil(total / pageSize) - 1);
                                        const safePage = Math.min(page, maxPage);
                                        window.menuFilesUiState.pageByMonth[mk] = safePage;

                                        const start = safePage * pageSize;
                                        const end = Math.min(start + pageSize, total);
                                        const pageItems = sorted.slice(start, end);

                                        listArea.innerHTML = pageItems.map(fileItemHtml).join('') || '<div class="menu-files-empty">–§–∞–π–ª—ã –º–µ–Ω—é –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';

                                        const prevDisabled = safePage <= 0;
                                        const nextDisabled = safePage >= maxPage;

                                        pager.innerHTML = `
                                            <button type="button" class="mf-pager-btn" id="mf-prev" ${prevDisabled ? 'disabled' : ''}>‚Üê –ù–∞–∑–∞–¥</button>
                                            <div class="mf-pager-info">${labelFor(mk)} ¬∑ ${total} —Ñ–∞–π–ª–æ–≤ ¬∑ ${total ? (safePage + 1) : 0}/${total ? (maxPage + 1) : 0}</div>
                                            <button type="button" class="mf-pager-btn" id="mf-next" ${nextDisabled ? 'disabled' : ''}>–í–ø–µ—Ä—ë–¥ ‚Üí</button>
                                        `;

                                        const prevBtn = document.getElementById('mf-prev');
                                        const nextBtn = document.getElementById('mf-next');
                                        if (prevBtn) {
                                            prevBtn.addEventListener('click', () => {
                                                if (window.menuFilesUiState.pageByMonth[mk] > 0) {
                                                    window.menuFilesUiState.pageByMonth[mk] -= 1;
                                                    render();
                                                }
                                            });
                                        }
                                        if (nextBtn) {
                                            nextBtn.addEventListener('click', () => {
                                                if (window.menuFilesUiState.pageByMonth[mk] < maxPage) {
                                                    window.menuFilesUiState.pageByMonth[mk] += 1;
                                                    render();
                                                }
                                            });
                                        }

                                        // update active styles
                                        monthRow.querySelectorAll('button[data-mk]').forEach(btn => {
                                            const isActive = (btn.getAttribute('data-mk') || '') === mk;
                                            btn.classList.toggle('active', isActive);
                                        });
                                    }

                                    renderMonthButtons();
                                    render();
                                } else {
                                    container.innerHTML = '<div class="menu-files-empty">–§–∞–π–ª—ã –º–µ–Ω—é –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                                }

                                // –†–µ–Ω–¥–µ—Ä–∏–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –Ω–∞–ª–∏—á–∏—è "–¥–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö" —Ñ–∞–π–ª–æ–≤
                                renderStaticMenuFiles();
                            } catch (error) {
                                if (window.errorHandler && window.errorHandler.showError) {
                                    window.errorHandler.showError({
                                        title: '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤',
                                        message: error.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–æ–≤ –º–µ–Ω—é',
                                        instructions: [
                                            '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É',
                                            '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É',
                                            '–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, —Å–æ–æ–±—â–∏—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É'
                                        ]
                                    }, '–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–æ–≤ –º–µ–Ω—é');
                                } else {
                                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ –º–µ–Ω—é:', error);
                                    const container = document.getElementById('menu-files-container');
                                    if (container) {
                                        container.innerHTML = '<div class="menu-files-empty" style="color: #ef4444;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤</div>';
                                    }
                                }

                                // –î–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ –∑–∞–≥—Ä—É–∑–∫–∏ "–¥–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö" —Ñ–∞–π–ª–æ–≤ –ø–æ–∫–∞–∂–µ–º –¥–æ–ø. —Ñ–∞–π–ª—ã
                                renderStaticMenuFiles();
                            }
                        }

                        async function deleteMenuFile(filename) {
                            try {
                                const name = String(filename || '').trim();
                                if (!name) return;
                                if (!confirm(`–£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª –º–µ–Ω—é "${name}"?`)) return;

                                const res = await fetch('/sidebar/delete_file', {
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify({
                                        filename: name,
                                        section: 'food',
                                        field_name: 'menu_file'
                                    })
                                });

                                const result = await res.json();
                                if (!result.success) {
                                    alert(result.error || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞');
                                    return;
                                }

                                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
                                await loadMenuFiles();
                            } catch (e) {
                                console.error(e);
                                alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
                            }
                        }

                        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
                        async function initMenuFilters() {
                            try {
                                const response = await fetch('/sidebar/api/nutrition/menu-files');
                                const data = await response.json();

                                if (data.success && data.files) {
                                    // –ü–æ–ª—É—á–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
                                    const years = [...new Set(data.files.map(f => f.year))].sort((a, b) => b - a);
                                    const months = [...new Set(data.files.map(f => f.month))].sort((a, b) => b - a);

                                    // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
                                    const yearFilter = document.getElementById('menu-year-filter');
                                    const monthFilter = document.getElementById('menu-month-filter');
                                    const dayFilter = document.getElementById('menu-day-filter');

                                    if (yearFilter) {
                                        years.forEach(year => {
                                            const option = document.createElement('option');
                                            option.value = year;
                                            option.textContent = year;
                                            yearFilter.appendChild(option);
                                        });
                                    }

                                    if (monthFilter) {
                                        const monthNames = ['–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å', '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'];
                                        months.forEach(month => {
                                            const option = document.createElement('option');
                                            option.value = month;
                                            option.textContent = monthNames[month - 1];
                                            monthFilter.appendChild(option);
                                        });
                                    }

                                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
                                    if (yearFilter) {
                                        yearFilter.addEventListener('change', () => {
                                            updateDaysFilter();
                                            loadMenuFiles();
                                        });
                                    }

                                    if (monthFilter) {
                                        monthFilter.addEventListener('change', () => {
                                            updateDaysFilter();
                                            loadMenuFiles();
                                        });
                                    }

                                    if (dayFilter) {
                                        dayFilter.addEventListener('change', loadMenuFiles);
                                    }
                                }

                                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª—ã –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
                                loadMenuFiles();
                            } catch (error) {
                                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤:', error);
                            }
                        }

                        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞ –¥–Ω–µ–π
                        async function updateDaysFilter() {
                            const year = document.getElementById('menu-year-filter')?.value || '';
                            const month = document.getElementById('menu-month-filter')?.value || '';
                            const dayFilter = document.getElementById('menu-day-filter');

                            if (!dayFilter) return;

                            // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–∏–µ –æ–ø—Ü–∏–∏
                            dayFilter.innerHTML = '<option value="">–í—ã–±—Ä–∞—Ç—å –¥–µ–Ω—å</option>';

                            if (!year || !month) return;

                            try {
                                const response = await fetch(`/sidebar/api/nutrition/menu-files?year=${year}&month=${month}`);
                                const data = await response.json();

                                if (data.success && data.files) {
                                    const days = [...new Set(data.files.map(f => f.day))].sort((a, b) => b - a);
                                    days.forEach(day => {
                                        const option = document.createElement('option');
                                        option.value = day;
                                        option.textContent = day;
                                        dayFilter.appendChild(option);
                                    });
                                }
                            } catch (error) {
                                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–∞ –¥–Ω–µ–π:', error);
                            }
                        }

                        // –°–±—Ä–æ—Å —Ñ–∏–ª—å—Ç—Ä–æ–≤
                        function resetMenuFilters() {
                            document.getElementById('menu-year-filter').value = '';
                            document.getElementById('menu-month-filter').value = '';
                            document.getElementById('menu-day-filter').value = '';
                            loadMenuFiles();
                        }

                        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
                        const filesInput = document.getElementById('menu-files');
                        const selectedFilesDiv = document.getElementById('selected-files');

                        if (filesInput && selectedFilesDiv) {
                            filesInput.addEventListener('change', function (e) {
                                const files = Array.from(e.target.files);
                                if (files.length === 0) {
                                    selectedFilesDiv.innerHTML = '';
                                    return;
                                }

                                const filesHtml = files.map(file =>
                                    `<span class="selected-file-item">üìÑ ${file.name}</span>`
                                ).join('');
                                selectedFilesDiv.innerHTML = `<strong>–í—ã–±—Ä–∞–Ω–æ —Ñ–∞–π–ª–æ–≤: ${files.length}</strong><br>${filesHtml}`;
                            });
                        }

                        // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞—Ç—ã –∏–∑ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ (—Ñ–æ—Ä–º–∞—Ç: YYYY-MM-DD-sm.xlsx)
                        function extractDateFromFilename(filename) {
                            const match = filename.match(/^(\d{4})-(\d{2})-(\d{2})/);
                            if (match) {
                                return `${match[1]}-${match[2]}-${match[3]}`;
                            }
                            return null;
                        }
                        
                        function isAllowedMenuUploadFilename(filename) {
                            const name = String(filename || '');
                            if (extractDateFromFilename(name)) return true;
                            const lower = name.toLowerCase();
                            return /^tm\d{4}-sm\.xlsx$/.test(lower) || /^kp\d{4}\.xlsx$/.test(lower) || lower === 'findex.xlsx';
                        }

                        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ –º–µ–Ω—é
                        async function uploadMenuFiles(event) {
                            event.preventDefault();
                            const form = event.target;
                            const filesInput = document.getElementById('menu-files');
                            const statusDiv = document.getElementById('menu-upload-status');

                            if (!filesInput || !filesInput.files || filesInput.files.length === 0) {
                                statusDiv.innerHTML = '<div class="upload-status error">–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ñ–∞–π–ª</div>';
                                return;
                            }

                            const files = Array.from(filesInput.files);

                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ —Ñ–∞–π–ª—ã –∏–º–µ—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∏–º–µ–Ω–∏
                            const invalidFiles = [];
                            files.forEach(file => {
                                if (!isAllowedMenuUploadFilename(file.name)) {
                                    invalidFiles.push(file.name);
                                }
                            });

                            if (invalidFiles.length > 0) {
                                statusDiv.innerHTML = `<div class="upload-status error">–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ–∞–π–ª—ã –∏–º–µ—é—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∏–º–µ–Ω–∏.<br>–î–æ–ø—É—Å—Ç–∏–º–æ:<br>- YYYY-MM-DD-sm.xlsx (–Ω–∞–ø—Ä–∏–º–µ—Ä 2025-10-02-sm.xlsx)<br>- tmYYYY-sm.xlsx, kpYYYY.xlsx, findex.xlsx<br><br>–ù–µ–≤–µ—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã:<br>${invalidFiles.join('<br>')}</div>`;
                                return;
                            }

                            statusDiv.innerHTML = `<div class="upload-status info">–ó–∞–≥—Ä—É–∑–∫–∞ ${files.length} —Ñ–∞–π–ª(–æ–≤)...</div>`;

                            let successCount = 0;
                            let errorCount = 0;
                            const errors = [];

                            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
                            for (let i = 0; i < files.length; i++) {
                                const file = files[i];

                                const formData = new FormData();
                                formData.append('file', file);

                                try {
                                    const response = await fetch('/sidebar/api/nutrition/upload-menu', {
                                        method: 'POST',
                                        body: formData
                                    });

                                    const data = await response.json();

                                    if (data.success) {
                                        successCount++;
                                    } else {
                                        errorCount++;
                                        errors.push(`${file.name}: ${data.error || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏'}`);
                                    }
                                } catch (error) {
                                    errorCount++;
                                    errors.push(`${file.name}: ${error.message}`);
                                }
                            }

                            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                            if (errorCount === 0) {
                                statusDiv.innerHTML = `<div class="upload-status success">‚úì –£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ ${successCount} —Ñ–∞–π–ª(–æ–≤)</div>`;
                                form.reset();
                                if (selectedFilesDiv) {
                                    selectedFilesDiv.innerHTML = '';
                                }
                                setTimeout(() => {
                                    initMenuFilters();
                                    loadMenuFiles();
                                }, 1000);
                            } else if (successCount > 0) {
                                statusDiv.innerHTML = `<div class="upload-status error">–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${successCount} –∏–∑ ${files.length} —Ñ–∞–π–ª–æ–≤. –û—à–∏–±–∫–∏: ${errors.join(', ')}</div>`;
                                setTimeout(() => {
                                    initMenuFilters();
                                    loadMenuFiles();
                                }, 1000);
                            } else {
                                statusDiv.innerHTML = `<div class="upload-status error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤: ${errors.join(', ')}</div>`;
                                if (window.errorHandler && window.errorHandler.showError) {
                                    window.errorHandler.showError({
                                        title: '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤',
                                        message: '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª—ã –º–µ–Ω—é',
                                        instructions: errors
                                    }, '–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–æ–≤ –º–µ–Ω—é');
                                }
                            }
                        }

                        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                        if (document.readyState === 'loading') {
                            document.addEventListener('DOMContentLoaded', initMenuFilters);
                        } else {
                            initMenuFilters();
                        }
                    </script>
                    {% endif %}

                    <style>
                        .section-container {
                            max-width: 1200px;
                            margin: 0 auto;
                            padding: 20px;
                        }

                        /* –°—Ç–∏–ª–∏ –¥–ª—è –±–ª–æ–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã */
                        .working-hours-section {
                            margin: 40px 0;
                            background: #ffffff;
                            border-radius: 12px;
                            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
                            overflow: hidden;
                        }

                        .working-hours-header {
                            background: linear-gradient(135deg, #059669 0%, #047857 100%);
                            padding: 25px 30px;
                            text-align: center;
                        }

                        .working-hours-header h2 {
                            color: #ffffff;
                            font-size: 1.8rem;
                            font-weight: 700;
                            margin: 0;
                            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                            letter-spacing: 0.5px;
                        }

                        .working-hours-container {
                            padding: 30px;
                        }

                        .working-hours-table {
                            width: 100%;
                            border-collapse: collapse;
                            background: #ffffff;
                            border-radius: 8px;
                            overflow: hidden;
                            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                        }

                        .working-hours-table thead {
                            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
                        }

                        .working-hours-table th {
                            padding: 18px 20px;
                            text-align: left;
                            font-weight: 700;
                            color: #166534;
                            font-size: 1rem;
                            letter-spacing: 0.3px;
                            border-bottom: 2px solid #bbf7d0;
                        }

                        .working-hours-table td {
                            padding: 16px 20px;
                            border-bottom: 1px solid #e5e7eb;
                            font-size: 0.95rem;
                            color: #374151;
                            vertical-align: top;
                        }


                        .working-hours-table tbody tr:last-child td {
                            border-bottom: none;
                        }

                        .working-hours-table td:first-child {
                            font-weight: 600;
                            color: #1f2937;
                        }

                        .working-hours-table td:nth-child(2) {
                            font-weight: 500;
                            color: #059669;
                        }

                        .working-hours-table td:last-child {
                            color: #6b7280;
                            font-style: italic;
                        }

                        /* –°—Ç–∏–ª–∏ –¥–ª—è –±–ª–æ–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ */
                        .document-item {
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            padding: 0;
                            background: transparent;
                            border: none;
                            border-radius: 0;
                            margin-bottom: 0;
                            transition: none;
                            box-shadow: none;
                        }

                        .document-item:hover {
                            background: transparent;
                            border-color: transparent;
                            transform: none;
                            box-shadow: none;
                        }

                        .document-item:last-child {
                            margin-bottom: 0;
                        }

                        .document-icon {
                            font-size: 2rem;
                            margin-right: 20px;
                            color: #3b82f6;
                            flex-shrink: 0;
                        }

                        .document-info {
                            flex: 1;
                            display: flex;
                            flex-direction: column;
                            align-items: center;
                            text-align: center;
                        }

                        .document-title {
                            font-size: 1.1rem;
                            font-weight: 600;
                            color: #1f2937;
                            margin-bottom: 8px;
                            line-height: 1.4;
                        }

                        .document-link {
                            font-size: 1rem;
                            display: inline-flex;
                            justify-content: center;
                            text-align: center;
                        }

                        .download-link {
                            color: #3b82f6;
                            text-decoration: none;
                            font-weight: 500;
                            font-size: 1rem;
                            padding: 8px 16px;
                            background: #eff6ff;
                            border-radius: 6px;
                            display: inline-block;
                            transition: all 0.2s ease;
                            word-wrap: break-word;
                            overflow-wrap: break-word;
                            white-space: normal;
                            max-width: 100%;
                            box-sizing: border-box;
                        }

                        .download-link:hover {
                            background: #eff6ff;
                            color: #3b82f6;
                            text-decoration: none;
                        }

                        /* –°—Ç–∏–ª–∏ –¥–ª—è –±–ª–æ–∫–∞ "–ú–µ—Å—Ç–∞ –æ—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏" */
                        .locations-section {
                            margin: 40px 0;
                            background: #ffffff;
                            border-radius: 12px;
                            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
                            overflow: hidden;
                        }

                        .locations-header {
                            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
                            padding: 25px 30px;
                            text-align: center;
                        }

                        .locations-header h2 {
                            color: #ffffff;
                            font-size: 1.8rem;
                            font-weight: 700;
                            margin: 0;
                            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                            letter-spacing: 0.5px;
                        }

                        .locations-container {
                            padding: 30px;
                        }

                        .location-block {
                            background: #f8fafc;
                            border: 1px solid #e2e8f0;
                            border-radius: 8px;
                            padding: 20px 25px;
                            margin-bottom: 15px;
                            transition: all 0.3s ease;
                            position: relative;
                            display: flex;
                            gap: 18px;
                            align-items: flex-start;
                            flex-wrap: wrap;
                        }

                        .location-block:last-child {
                            margin-bottom: 0;
                        }

                        .location-block:hover {
                            background: #f1f5f9;
                        }

                        .location-title {
                            font-size: 1.05rem;
                            font-weight: 700;
                            color: #1e293b;
                            margin-bottom: 8px;
                            line-height: 1.4;
                            letter-spacing: 0.3px;
                            min-width: 160px;
                            flex: 1 1 260px;
                            word-break: break-word;
                            white-space: normal;
                        }

                        .location-address {
                            font-size: 1rem;
                            color: #475569;
                            line-height: 1.5;
                            font-weight: 500;
                            word-break: break-word;
                            flex: 1 1 200px;
                        }

                        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
                        @media (max-width: 768px) {
                            .working-hours-header {
                                padding: 20px 15px;
                            }

                            .working-hours-header h2 {
                                font-size: 1.5rem;
                            }

                            .working-hours-container {
                                padding: 20px 15px;
                            }

                            .working-hours-table th,
                            .working-hours-table td {
                                padding: 12px 15px;
                                font-size: 0.9rem;
                            }

                            .working-hours-table th {
                                font-size: 0.95rem;
                            }

                            .document-item {
                                padding: 0;
                                flex-direction: row;
                                text-align: left;
                            }

                            .document-icon {
                                margin-right: 10px;
                                margin-bottom: 0;
                                font-size: 1.2rem;
                            }

                            .document-title {
                                font-size: 1rem;
                                margin-bottom: 6px;
                            }

                            .download-link {
                                padding: 6px 12px;
                                font-size: 0.9rem;
                            }

                            .locations-header {
                                padding: 20px 15px;
                            }

                            .locations-header h2 {
                                font-size: 1.5rem;
                            }

                            .locations-container {
                                padding: 20px 15px;
                            }

                            .location-block {
                                padding: 16px 18px;
                                flex-direction: column;
                                align-items: flex-start;
                                gap: 10px;
                            }

                            .location-title {
                                font-size: 1rem;
                                min-width: auto;
                                flex: 1 1 auto;
                            }

                            .location-address {
                                font-size: 0.95rem;
                            }
                        }

                        .section-header {
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            margin-bottom: 30px;
                            padding: 20px;
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            border-radius: 12px;
                            color: white;
                        }

                        .section-header h1 {
                            margin: 0;
                            font-size: 2.5rem;
                        }

                        .section-description {
                            margin-bottom: 30px;
                            padding: 20px;
                            background: #f8fafc;
                            border-radius: 8px;
                            border-left: 4px solid #3b82f6;
                        }

                        .section-description p {
                            margin: 0;
                            font-size: 1.1rem;
                            line-height: 1.6;
                            color: #374151;
                        }

                        .content-blocks {
                            display: flex;
                            flex-direction: column;
                            gap: 30px;
                        }

                        .content-block {
                            background: white;
                            border-radius: 12px;
                            padding: 30px;
                            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                            border: none;
                            max-width: 100%;
                            box-sizing: border-box;
                            overflow-x: hidden;
                        }

                        .content-block:hover {
                            background: white !important;
                            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1) !important;
                            transform: none !important;
                        }

                        .content-block:hover::before {
                            transform: scaleX(0) !important;
                            opacity: 0 !important;
                        }

                        .content-block h2 {
                            margin-top: 0;
                            margin-bottom: 20px;
                            color: #1f2937;
                            font-size: 1.5rem;
                            border-bottom: 2px solid #e5e7eb;
                            padding-bottom: 10px;
                        }

                        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü */
                        .table-wrapper {
                            overflow-x: auto;
                            border-radius: 8px;
                            border: none;
                        }

                        .content-table {
                            width: 100%;
                            border-collapse: collapse;
                            background: white;
                        }
                        
                        .content-table-sveden {
                            border-collapse: collapse !important;
                        }

                        .content-table th,
                        .content-table td {
                            padding: 12px 16px;
                            text-align: left;
                            border-bottom: 1px solid #e5e7eb;
                            word-wrap: break-word;
                            overflow-wrap: break-word;
                            word-break: break-word;
                            font-size: 1.05rem;
                        }

                        .content-table th {
                            background: #f9fafb;
                            font-weight: 600;
                            color: #374151;
                            font-size: 1.1rem;
                        }


                        .content-table-sveden {
                            table-layout: fixed;
                            border-collapse: collapse !important;
                            border-spacing: 0 !important;
                        }
                        
                        .content-table-sveden th,
                        .content-table-sveden td {
                            padding: 4px 8px !important;
                            border-spacing: 0 !important;
                        }
                        
                        .content-table-sveden tr {
                            height: auto !important;
                            min-height: 0 !important;
                            max-height: none !important;
                        }
                        
                        .content-table-sveden tbody tr {
                            height: auto !important;
                            min-height: 0 !important;
                        }

                        .content-table-sveden td:first-child {
                            width: 35%;
                        }

                        .content-table-sveden td:last-child {
                            width: 65%;
                        }

                        .content-table-sveden td {
                            vertical-align: middle !important;
                            word-wrap: break-word;
                            overflow-wrap: break-word;
                            word-break: break-word;
                            font-size: 1.05rem;
                            padding: 4px 8px !important;
                            height: auto !important;
                            min-height: 0 !important;
                            max-height: none !important;
                            line-height: 1.15 !important;
                        }
                        
                        .content-table-sveden td * {
                            box-sizing: border-box;
                        }
                        
                        .content-table-sveden td .files-list,
                        .content-table-sveden td .file-item,
                        .content-table-sveden td .download-link {
                            box-sizing: border-box;
                        }
                        
                        /* –£–±–∏—Ä–∞–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤–Ω—É—Ç—Ä–∏ —Ç–∞–±–ª–∏—Ü—ã */
                        .content-table-sveden td > *:first-child {
                            margin-top: 0 !important;
                        }
                        
                        .content-table-sveden td > *:last-child {
                            margin-bottom: 0 !important;
                        }
                        
                        .content-table-sveden td .files-list > *:first-child {
                            margin-top: 0 !important;
                        }
                        
                        .content-table-sveden td .files-list > *:last-child {
                            margin-bottom: 0 !important;
                        }

                        .content-table-sveden td.table-cell-file-full {
                            width: 100%;
                        }

                        .content-table-sveden td.table-cell-file-full {
                            text-align: left;
                        }

                        .content-table-sveden td.table-cell-file-full {
                            padding: 4px 8px !important;
                            line-height: 1.2 !important;
                        }
                        
                        .content-table-sveden td.table-cell-file-full a.download-link {
                            display: block !important;
                            padding: 6px 12px !important;
                            font-weight: 500;
                            font-size: 0.95rem !important;
                            white-space: normal;
                            word-wrap: break-word;
                            overflow-wrap: break-word;
                            width: 100%;
                            box-sizing: border-box;
                            text-align: left;
                            margin: 2px 0 !important;
                            line-height: 1.2 !important;
                            background: #eff6ff !important;
                            border-radius: 6px !important;
                            color: #3b82f6 !important;
                            text-decoration: none !important;
                            transition: all 0.2s ease !important;
                        }
                        
                        .content-table-sveden td.table-cell-file-full a.download-link:hover {
                            background: #eff6ff !important;
                            color: #3b82f6 !important;
                        }
                        
                        .content-table-sveden td.table-cell-file-full .files-list {
                            gap: 0 !important;
                            margin: 0 !important;
                            margin-top: 0 !important;
                            margin-bottom: 0 !important;
                            padding: 0 !important;
                            display: flex !important;
                            flex-direction: column !important;
                        }
                        
                        .content-table-sveden td.table-cell-file-full .file-item {
                            margin: 0 !important;
                            margin-top: 0 !important;
                            margin-bottom: 0 !important;
                            padding: 2px 4px !important;
                            min-height: 0 !important;
                            height: auto !important;
                        }

                        .content-table-sveden td:last-child {
                            text-align: left;
                            line-height: 1.15 !important;
                            white-space: normal !important;
                        }
                        
                        .content-table-sveden td:last-child span[style*="white-space: pre-line"] {
                            white-space: pre-line !important;
                            display: block;
                            line-height: 1.15;
                            margin: 0;
                            padding: 0;
                        }
                        
                        .content-table-sveden td:last-child p,
                        .content-table-sveden td:last-child div:not(.files-list):not(.subrows-container) {
                            margin: 0;
                            padding: 0;
                            line-height: 1.15;
                        }

                        .content-table-sveden td:last-child a.download-link {
                            display: block !important;
                            text-align: left;
                            font-size: 0.95rem !important;
                            white-space: normal;
                            word-wrap: break-word;
                            overflow-wrap: break-word;
                            width: 100%;
                            box-sizing: border-box;
                            padding: 6px 12px !important;
                            margin: 2px 0 !important;
                            line-height: 1.2 !important;
                            background: #eff6ff !important;
                            border-radius: 6px !important;
                            color: #3b82f6 !important;
                            text-decoration: none !important;
                            transition: all 0.2s ease !important;
                        }
                        
                        .content-table-sveden td:last-child a.download-link:hover {
                            background: #eff6ff !important;
                            color: #3b82f6 !important;
                        }

                        .content-table-sveden td:last-child .files-list {
                            text-align: left;
                            white-space: normal;
                            width: 100%;
                            display: flex !important;
                            flex-direction: column !important;
                            gap: 0 !important;
                            margin: 0 !important;
                            margin-top: 0 !important;
                            padding: 0 !important;
                            align-items: stretch !important;
                        }
                        
                        .content-table-sveden td:last-child .files-list .file-item {
                            width: 100% !important;
                            margin: 0 !important;
                            margin-top: 0 !important;
                            margin-bottom: 0 !important;
                            padding: 2px 4px !important;
                            min-height: 0 !important;
                            height: auto !important;
                            max-height: none !important;
                            max-width: 100% !important;
                            border: none !important;
                            background: transparent !important;
                            border-radius: 0 !important;
                            box-shadow: none !important;
                        }
                        
                        .content-table-sveden td:last-child .files-list .file-item:hover {
                            background: transparent !important;
                            border: none !important;
                            box-shadow: none !important;
                            transform: none !important;
                        }

                        .content-table-sveden td:last-child .file-item {
                            text-align: left;
                            display: block !important;
                            white-space: normal;
                            width: 100%;
                            box-sizing: border-box;
                            word-wrap: break-word;
                            overflow-wrap: break-word;
                            margin: 0 !important;
                            margin-top: 0 !important;
                            margin-bottom: 0 !important;
                            padding: 2px 4px !important;
                            min-height: 0 !important;
                            height: auto !important;
                            max-height: none !important;
                            border: none !important;
                            background: transparent !important;
                            border-radius: 0 !important;
                            box-shadow: none !important;
                        }
                        
                        .content-table-sveden td:last-child .file-item:hover {
                            background: transparent !important;
                            border: none !important;
                            box-shadow: none !important;
                            transform: none !important;
                        }
                        
                        .content-table-sveden td:last-child .file-item .download-link {
                            width: 100%;
                            word-wrap: break-word;
                            overflow-wrap: break-word;
                            white-space: normal;
                            display: block !important;
                            padding: 6px 12px !important;
                            margin: 2px 0 !important;
                            line-height: 1.2 !important;
                            font-size: 0.95rem !important;
                            background: #eff6ff !important;
                            border-radius: 6px !important;
                            gap: 4px !important;
                            color: #3b82f6 !important;
                            text-decoration: none !important;
                            transition: all 0.2s ease !important;
                        }
                        
                        .content-table-sveden td:last-child .file-item .download-link:hover {
                            background: #eff6ff !important;
                            color: #3b82f6 !important;
                        }

                        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–∏—Å–∫–æ–≤ */
                        .list-content ul {
                            list-style: none;
                            padding: 0;
                        }

                        .list-content li {
                            padding: 10px 0;
                            border-bottom: 1px solid #e5e7eb;
                            position: relative;
                            padding-left: 20px;
                        }

                        .list-content li:before {
                            content: "‚Ä¢";
                            color: #3b82f6;
                            font-weight: bold;
                            position: absolute;
                            left: 0;
                        }

                        /* –°—Ç–∏–ª–∏ –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ */
                        .documents-list {
                            display: flex;
                            flex-direction: column;
                            gap: 8px;
                        }

                        .document-item {
                            padding: 0;
                            background: transparent;
                            border-radius: 0;
                            border: none;
                        }

                        .document-link {
                            text-decoration: none;
                            color: #2563eb;
                            font-weight: 400;
                            font-size: 1rem;
                            display: flex;
                            align-items: center;
                            gap: 10px;
                            padding: 8px 0;
                            transition: color 0.2s;
                            border-bottom: 1px solid transparent;
                        }

                        .document-link:hover {
                            color: #2563eb;
                            text-decoration: none;
                            border-bottom-color: transparent;
                        }

                        /* –§–æ—Ç–æ –∫–∞–∫ –≤ –Ω–æ–≤–æ—Å—Ç—è—Ö: –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ª–µ–Ω—Ç–∞ */
                        .info-photo-row {
                            display: flex;
                            gap: 12px;
                            overflow-x: auto;
                            padding: 8px 0 12px 0;
                            scroll-behavior: smooth;
                            scrollbar-width: thin;
                        }

                        .info-photo-item {
                            flex: 0 0 240px;
                            min-width: 240px;
                        }

                        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π */
                        .photos-gallery {
                            display: grid;
                            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                            gap: 20px;
                        }

                        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –±–ª–æ–∫–∞—Ö (–∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ –ø–ª–∏—Ç–∫–∏) */
                        .photos-gallery.text-block-photos {
                            display: grid !important;
                            grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
                            gap: 8px !important;
                            margin-top: 24px;
                            max-width: 100% !important;
                            width: 100% !important;
                            box-sizing: border-box !important;
                            overflow: hidden;
                        }

                        .photos-gallery.text-block-photos .photo-item {
                            max-width: 100% !important;
                            box-sizing: border-box !important;
                            min-width: 0 !important;
                            width: 100% !important;
                            position: relative !important;
                            padding-bottom: 100% !important;
                            height: 0 !important;
                        }

                        /* –°—Ç–∏–ª–∏ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ø–ª–∏—Ç–∫–∏) */
                        .page-images-section {
                            margin-top: 40px;
                            padding-top: 40px;
                            border-top: 2px solid #e5e7eb;
                        }

                        .page-images-gallery {
                            display: grid !important;
                            grid-template-columns: repeat(3, 1fr) !important;
                            gap: 20px !important;
                            margin-top: 24px;
                        }

                        @media (max-width: 640px) {
                            .info-photo-item {
                                flex-basis: 200px;
                                min-width: 200px;
                            }
                        }

                        .page-image-item {
                            position: relative !important;
                            border-radius: 12px;
                            overflow: hidden;
                            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                            transition: all 0.3s ease;
                            background: #f8fafc;
                            width: 100% !important;
                            height: 0 !important;
                            padding-bottom: 100% !important;
                            /* –°–æ–∑–¥–∞–µ—Ç –∫–≤–∞–¥—Ä–∞—Ç */
                            cursor: pointer;
                        }

                        .page-image-item:hover {
                            transform: translateY(-8px) scale(1.02);
                            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
                        }

                        .page-image-item::before {
                            content: '';
                            position: absolute;
                            top: 0;
                            left: 0;
                            right: 0;
                            bottom: 0;
                            background: linear-gradient(to bottom, transparent 0%, rgba(0, 0, 0, 0.1) 100%);
                            opacity: 0;
                            transition: opacity 0.3s ease;
                            z-index: 1;
                            pointer-events: none;
                        }

                        .page-image-item:hover::before {
                            opacity: 1;
                        }

                        .page-image {
                            position: absolute !important;
                            top: 0 !important;
                            left: 0 !important;
                            width: 100% !important;
                            height: 100% !important;
                            object-fit: cover !important;
                            display: block;
                            transition: transform 0.3s ease;
                        }

                        .page-image-item:hover .page-image {
                            transform: scale(1.05);
                        }

                        @media (max-width: 768px) {
                            .page-images-gallery {
                                grid-template-columns: repeat(2, 1fr);
                                gap: 12px;
                            }
                        }

                        .text-block-photos {
                            margin-top: 24px;
                            padding-top: 24px;
                            border-top: 1px solid #e5e7eb;
                        }

                        .text-content-text {
                            margin-bottom: 16px;
                            line-height: 1.6;
                            white-space: pre-wrap;
                        }

                        .text-content-photos {
                            margin-top: 16px;
                            width: 100%;
                            max-width: 100%;
                            box-sizing: border-box;
                        }

                        .photo-item {
                            position: relative;
                            border-radius: 8px;
                            overflow: hidden;
                            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                            background: #f8fafc;
                            width: 100%;
                            height: 0;
                            padding-bottom: 100%;
                            /* –°–æ–∑–¥–∞–µ—Ç –∫–≤–∞–¥—Ä–∞—Ç */
                            cursor: pointer;
                            transition: all 0.3s ease;
                            max-width: 100%;
                            box-sizing: border-box;
                            flex-shrink: 0;
                        }


                        .photo-item:hover {
                            transform: translateY(-8px) scale(1.02);
                            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
                        }

                        .photo-image {
                            position: absolute !important;
                            top: 0 !important;
                            left: 0 !important;
                            width: 100% !important;
                            height: 100% !important;
                            object-fit: cover !important;
                            border-radius: 8px;
                            border: none;
                            display: block;
                            transition: transform 0.3s ease;
                            max-width: 100%;
                        }

                        .photo-item:hover .photo-image {
                            transform: scale(1.05);
                        }

                        .photo-caption {
                            margin-top: 10px;
                            color: #6b7280;
                            font-style: italic;
                        }

                        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ –ª—é–¥–µ–π (–ø—Ä–µ–≤—å—é: —Ñ–æ—Ç–æ, –∏–º—è, –¥–æ–ª–∂–Ω–æ—Å—Ç—å) */
                        .persons-grid {
                            display: grid;
                            grid-template-columns: repeat(3, 1fr);
                            gap: 24px;
                        }

                        .persons-cards-grid .person-card {
                            display: flex;
                            flex-direction: column;
                            padding: 0;
                            border-radius: 12px;
                            overflow: hidden;
                            border: 1px solid #e5e7eb;
                            cursor: pointer;
                            transition: all 0.2s ease;
                            text-align: center;
                        }

                        .persons-cards-grid .person-card:hover {
                            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
                            border-color: #3b82f6;
                        }

                        .person-card-preview {
                            display: flex;
                            flex-direction: column;
                            align-items: center;
                        }

                        .person-card-photo-wrap {
                            width: 100%;
                            aspect-ratio: 3/4;
                            max-height: 280px;
                            background: #f1f5f9;
                            overflow: hidden;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                        }

                        .person-card-photo-wrap.person-card-photo-placeholder {
                            background: #e2e8f0;
                            color: #64748b;
                            font-size: 1rem;
                        }

                        .person-card-image {
                            width: 100%;
                            height: 100%;
                            object-fit: cover;
                            display: block;
                        }

                        .person-card-name {
                            margin: 14px 12px 4px;
                            font-size: 1.1rem;
                            font-weight: 700;
                            color: #1e293b;
                            line-height: 1.3;
                        }

                        .person-card-position {
                            margin: 0 12px 14px;
                            font-size: 0.95rem;
                            font-weight: 600;
                            color: #3b82f6;
                        }

                        .person-card {
                            background: #ffffff;
                            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
                        }

                        .person-photo {
                            flex-shrink: 0;
                            width: 180px;
                            height: 240px;
                            border-radius: 10px;
                            overflow: hidden;
                            border: 2px solid #e5e7eb;
                            background: #f8fafc;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                        }

                        .person-image {
                            width: 100%;
                            height: 100%;
                            object-fit: cover;
                            display: block;
                        }

                        .person-info {
                            flex: 1;
                            display: flex;
                            flex-direction: column;
                            gap: 12px;
                        }

                        .person-name {
                            margin: 0;
                            color: #1e293b;
                            font-size: 1.4rem;
                            font-weight: 700;
                            line-height: 1.3;
                        }

                        .person-position {
                            margin: 0;
                            color: #3b82f6;
                            font-size: 1.1rem;
                            font-weight: 600;
                        }

                        .person-description {
                            margin: 0;
                            color: #64748b;
                            font-size: 1rem;
                            line-height: 1.6;
                            white-space: pre-wrap;
                        }

                        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–µ—Ä—Å–æ–Ω—ã (—Ä–∞–∑–º–µ—â–∞–µ—Ç—Å—è –≤ body, –ø–æ–≤–µ—Ä—Ö –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã) */
                        .person-detail-modal {
                            position: fixed;
                            inset: 0;
                            z-index: 99999;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            padding: 20px;
                            visibility: hidden;
                            opacity: 0;
                            transition: visibility 0.2s, opacity 0.2s;
                        }

                        .person-detail-modal.person-detail-modal-open {
                            visibility: visible;
                            opacity: 1;
                        }

                        .person-detail-modal-overlay {
                            position: absolute;
                            inset: 0;
                            background: rgba(0, 0, 0, 0.5);
                            cursor: pointer;
                        }

                        .person-detail-modal-box {
                            position: relative;
                            display: flex;
                            flex-direction: column;
                            max-width: 640px;
                            width: 100%;
                            max-height: 90vh;
                            background: #fff;
                            border-radius: 16px;
                            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.25);
                            overflow: hidden;
                        }

                        .person-detail-modal-close {
                            position: absolute;
                            top: 12px;
                            right: 12px;
                            width: 36px;
                            height: 36px;
                            border: none;
                            background: #f1f5f9;
                            border-radius: 8px;
                            font-size: 1.5rem;
                            line-height: 1;
                            cursor: pointer;
                            color: #64748b;
                            z-index: 1;
                        }

                        .person-detail-modal-close:hover {
                            background: #e2e8f0;
                            color: #1e293b;
                        }

                        .person-detail-modal-content {
                            padding: 28px 32px 32px;
                            overflow-y: auto;
                            overflow-x: hidden;
                            flex: 1;
                            min-height: 0;
                        }

                        .person-detail-header {
                            display: flex;
                            gap: 24px;
                            margin-bottom: 24px;
                            padding-bottom: 20px;
                            border-bottom: 1px solid #e5e7eb;
                            flex-shrink: 0;
                        }

                        .person-detail-photo {
                            flex-shrink: 0;
                            width: 120px;
                            height: 120px;
                            border-radius: 50%;
                            overflow: hidden;
                            background: #f1f5f9;
                        }

                        .person-detail-photo img {
                            width: 100%;
                            height: 100%;
                            object-fit: cover;
                        }

                        .person-detail-title-wrap {
                            flex: 1;
                            min-width: 0;
                        }

                        .person-detail-name {
                            margin: 0 0 8px 0;
                            font-size: 1.4rem;
                            font-weight: 700;
                            color: #1e293b;
                            line-height: 1.3;
                        }

                        .person-detail-position {
                            margin: 0;
                            font-size: 1.05rem;
                            font-weight: 600;
                            color: #3b82f6;
                        }

                        .person-detail-body {
                            font-size: 1rem;
                            line-height: 1.6;
                            color: #374151;
                        }

                        .person-detail-body .person-detail-row {
                            margin: 0 0 12px 0;
                        }

                        .person-detail-body .person-detail-desc,
                        .person-detail-body .person-detail-text {
                            margin: 0 0 16px 0;
                            white-space: pre-wrap;
                        }

                        .person-detail-body .person-detail-list {
                            margin: 0 0 16px 0;
                            padding-left: 24px;
                        }

                        .person-detail-body .person-detail-list li {
                            margin-bottom: 8px;
                        }

                        .person-detail-body .person-detail-list-ol {
                            list-style-type: decimal;
                        }

                        /* –°—Ç–∏–ª–∏ –¥–ª—è –±–ª—é–¥ */
                        .dishes-content {
                            margin-top: 20px;
                        }

                        .dishes-list {
                            display: flex;
                            flex-direction: column;
                            gap: 20px;
                        }

                        .dish-item {
                            background: #f8fafc;
                            border-radius: 12px;
                            padding: 20px;
                            border: 1px solid #e5e7eb;
                            display: flex;
                            flex-direction: column;
                            gap: 15px;
                            transition: all 0.3s ease;
                        }

                        .dish-item:hover {
                            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                        }

                        .dish-photo {
                            width: 100%;
                            max-width: 500px;
                            margin: 0 auto;
                            border-radius: 8px;
                            overflow: hidden;
                            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                        }

                        .dish-image {
                            width: 100%;
                            height: auto;
                            display: block;
                            object-fit: cover;
                        }

                        .dish-info {
                            text-align: center;
                        }

                        .dish-title {
                            margin: 0 0 10px 0;
                            color: #1f2937;
                            font-size: 1.25rem;
                            font-weight: 600;
                        }

                        .dish-date {
                            margin: 0;
                            color: #6b7280;
                            font-size: 1rem;
                        }

                        .person-image {
                            width: 120px;
                            height: 120px;
                            border-radius: 50%;
                            object-fit: cover;
                            border: 3px solid #e5e7eb;
                        }

                        .person-name {
                            margin: 0 0 10px 0;
                            color: #1f2937;
                            font-size: 1.2rem;
                        }

                        .person-position {
                            margin: 0 0 10px 0;
                            color: #3b82f6;
                            font-weight: 500;
                        }

                        .person-phone,
                        .person-email {
                            margin: 5px 0;
                            color: #6b7280;
                            font-size: 0.9rem;
                        }

                        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã */
                        .form-data-section {
                            background: #f8fafc;
                            border-radius: 12px;
                            padding: 25px;
                            margin-bottom: 30px;
                            border: none;
                        }

                        /* –î–ª—è –Ω–æ–≤—ã—Ö –±–ª–æ–∫–æ–≤ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–≤–µ–¥–µ–Ω–∏–π —Å–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞—Ä—ã–µ —Ç–∞–±–ª–∏—Ü—ã form_data */
                        .section-container--sveden-tables .form-data-section {
                            display: none;
                        }

                        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤ */
                        .files-list {
                            display: flex;
                            flex-direction: column;
                            gap: 8px;
                            margin-top: 8px;
                            align-items: center;
                        }
                        
                        .content-table-sveden .files-list {
                            gap: 0 !important;
                            margin-top: 0 !important;
                            margin-bottom: 0 !important;
                            align-items: stretch !important;
                        }

                        .files-list .file-item {
                            border: none;
                            background: transparent;
                            box-shadow: none;
                            padding: 6px 10px;
                            transition: none;
                            width: 100%;
                            max-width: 360px;
                        }
                        
                        .content-table-sveden .files-list .file-item {
                            padding: 2px 4px !important;
                            margin: 0 !important;
                            max-width: 100% !important;
                            min-height: 0 !important;
                            height: auto !important;
                        }

                        .files-list .file-item:hover {
                            border: none;
                            background: transparent;
                            box-shadow: none;
                            transform: none;
                        }

                        .file-item {
                            display: flex;
                            align-items: center;
                            padding: 10px 14px;
                            background: #ffffff;
                            border: 1px solid #e5e7eb;
                            border-radius: 8px;
                            transition: all 0.2s ease;
                            margin: 4px 0;
                            max-width: 100%;
                            box-sizing: border-box;
                            word-wrap: break-word;
                            overflow-wrap: break-word;
                        }
                        
                        .content-table-sveden .file-item {
                            padding: 2px 4px !important;
                            margin: 0 !important;
                            min-height: 0 !important;
                            height: auto !important;
                            border: none !important;
                            background: transparent !important;
                            border-radius: 0 !important;
                        }

                        .file-item:hover {
                            background: #ffffff;
                            transform: none !important;
                        }
                        
                        .content-table-sveden .file-item:hover {
                            background: transparent !important;
                            border: none !important;
                            box-shadow: none !important;
                            transform: none !important;
                        }

                        .file-item .download-link {
                            color: #3b82f6;
                            text-decoration: none;
                            font-weight: 500;
                            font-size: 1rem;
                            display: flex;
                            align-items: center;
                            gap: 8px;
                            font-size: 0.95rem;
                            word-wrap: break-word;
                            overflow-wrap: break-word;
                            white-space: normal;
                            max-width: 100%;
                            box-sizing: border-box;
                            flex: 1;
                            min-width: 0;
                        }
                        
                        .content-table-sveden .file-item .download-link {
                            padding: 6px 12px !important;
                            margin: 2px 0 !important;
                            gap: 4px !important;
                            line-height: 1.2 !important;
                            font-size: 0.95rem !important;
                            background: #eff6ff !important;
                            border-radius: 6px !important;
                            color: #3b82f6 !important;
                            text-decoration: none !important;
                            transition: all 0.2s ease !important;
                        }
                        
                        .content-table-sveden .file-item .download-link:hover {
                            background: #eff6ff !important;
                            color: #3b82f6 !important;
                        }

                        .file-item .download-link:hover {
                            color: #3b82f6;
                        }

                        .form-data-section {
                            background: #f8fafc;
                            padding: 28px;
                            border-radius: 12px;
                            margin: 24px 0;
                            border: none;
                        }

                        /* –ü–æ–ª–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ hover –¥–ª—è –±–ª–æ–∫–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ —Å—Å—ã–ª–æ–∫ ¬´–°–∫–∞—á–∞—Ç—å¬ª */
                        .documents-list .file-item:hover,
                        .documents-list .document-item:hover,
                        .form-data-section .file-item:hover,
                        .form-data-section .document-item:hover,
                        .content-block .file-item:hover,
                        .content-block .document-item:hover,
                        .file-item:hover,
                        .document-item:hover {
                            background: #ffffff !important;
                            border-color: #e5e7eb !important;
                            box-shadow: none !important;
                            transform: none !important;
                        }
                        .content-table-sveden .file-item:hover {
                            background: transparent !important;
                            border-color: transparent !important;
                        }
                        .file-item .download-link:hover,
                        .document-item .download-link:hover,
                        a.document-link:hover {
                            background: #eff6ff !important;
                            color: #3b82f6 !important;
                            box-shadow: none !important;
                        }

                        .form-data-section h2 {
                            margin-top: 0;
                            margin-bottom: 24px;
                            color: #1e293b;
                            font-size: 1.6rem;
                            font-weight: 700;
                            border-bottom: 3px solid #3b82f6;
                            padding-bottom: 12px;
                            padding-top: 0;
                        }

                        .form-data-grid {
                            display: grid;
                            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
                            gap: 20px;
                        }

                        .form-data-item {
                            background: #ffffff;
                            padding: 20px;
                            border-radius: 10px;
                            border: 1px solid #e5e7eb;
                            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
                            display: flex;
                            flex-direction: column;
                            gap: 12px;
                            transition: all 0.2s ease;
                        }


                        .form-data-item strong {
                            color: #1e40af;
                            font-size: 0.95rem;
                            font-weight: 600;
                            letter-spacing: 0.3px;
                            margin-bottom: 4px;
                        }

                        .form-data-item span {
                            color: #374151;
                            font-size: 0.95rem;
                            line-height: 1.7;
                            word-wrap: break-word;
                            white-space: pre-wrap;
                        }

                        .form-data-item span em {
                            color: #9ca3af;
                            font-style: italic;
                        }

                        .download-link {
                            color: #2563eb;
                            text-decoration: none;
                            font-weight: 500;
                            font-size: 1rem;
                            transition: all 0.2s ease;
                            display: inline-flex;
                            align-items: center;
                            gap: 6px;
                            padding: 6px 10px;
                            border-radius: 6px;
                            word-wrap: break-word;
                            overflow-wrap: break-word;
                            white-space: normal;
                            max-width: 100%;
                            box-sizing: border-box;
                        }

                        .download-link:hover {
                            color: #3b82f6;
                            background: #eff6ff;
                        }

                        .files-list {
                            display: flex;
                            flex-direction: column;
                            gap: 8px;
                            margin-top: 4px;
                        }

                        .files-list .file-item {
                            padding: 0;
                        }

                        .btn {
                            padding: 10px 20px;
                            border: none;
                            border-radius: 6px;
                            cursor: pointer;
                            font-size: 14px;
                            text-decoration: none;
                            display: inline-block;
                            transition: all 0.2s;
                        }

                        .btn-primary {
                            background: #3b82f6;
                            color: white;
                        }

                        .btn-primary:hover {
                            background: #2563eb;
                        }

                        /* –°—Ç–∏–ª–∏ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤ */
                        .info-block-content {
                            background: #ffffff;
                            border: 1px solid #e2e8f0;
                            border-radius: 8px;
                            padding: 20px;
                            margin: 12px 0;
                            white-space: pre-wrap;
                            font-family: inherit;
                            line-height: 1.7;
                            color: #374151;
                            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
                        }

                        .section-container {
                            max-width: 1400px;
                            margin: 0 auto;
                            padding: 20px;
                        }

                        .section-header {
                            margin-bottom: 32px;
                        }

                        .section-header h1 {
                            color: #1e293b;
                            font-size: 2.25rem;
                            font-weight: 700;
                            margin-bottom: 12px;
                        }

                        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
                        @media (max-width: 768px) {
                            .section-header {
                                flex-direction: column;
                                gap: 15px;
                                text-align: center;
                            }

                            .section-header h1 {
                                font-size: 2rem;
                            }

                            .section-container {
                                padding: 12px;
                            }

                            .form-data-section {
                                padding: 20px;
                            }

                            .form-data-grid {
                                grid-template-columns: 1fr;
                                gap: 15px;
                            }

                            .form-data-item {
                                padding: 16px;
                            }

                            .content-block {
                                padding: 20px;
                            }

                            .photos-gallery {
                                grid-template-columns: 1fr;
                            }

                            .photos-gallery.text-block-photos {
                                grid-template-columns: repeat(2, 1fr) !important;
                                gap: 12px !important;
                            }

                            .persons-grid {
                                grid-template-columns: 1fr;
                            }

                            .locations-content {
                                padding: 15px;
                            }
                        }
                    </style>

                    {% if current_user.is_authenticated %}
                    <script>
                        function _escapeHtml(value) {
                            const s = String(value ?? '');
                            return s
                                .replace(/&/g, '&amp;')
                                .replace(/</g, '&lt;')
                                .replace(/>/g, '&gt;')
                                .replace(/"/g, '&quot;')
                                .replace(/'/g, '&#39;');
                        }

                        function _dateDdMmYyyyToInput(value) {
                            const s = String(value ?? '').trim();
                            if (!s) return '';
                            if (s.includes('-')) return s; // already YYYY-MM-DD
                            const parts = s.split('.');
                            if (parts.length !== 3) return '';
                            const [dd, mm, yyyy] = parts;
                            if (!dd || !mm || !yyyy) return '';
                            return `${yyyy}-${mm.padStart(2, '0')}-${dd.padStart(2, '0')}`;
                        }

                        function _dateInputToDdMmYyyy(value) {
                            const s = String(value ?? '').trim();
                            if (!s) return '';
                            const parts = s.split('-');
                            if (parts.length !== 3) return '';
                            const [yyyy, mm, dd] = parts;
                            if (!dd || !mm || !yyyy) return '';
                            return `${dd.padStart(2, '0')}.${mm.padStart(2, '0')}.${yyyy}`;
                        }

                        function closeEditDailyMenuDishes() {
                            const modal = document.getElementById('dailyMenuDishesModal');
                            if (modal) {
                                modal.remove();
                                document.body.style.overflow = '';
                            }
                        }

                        function _renderDailyMenuDishesRows(dishes, menuFiles) {
                            const rows = dishes.map((dish, idx) => {
                                const title = _escapeHtml(dish.title || '');
                                const publishDate = _escapeHtml(dish.publish_date || '');
                                const photoUrl = _escapeHtml(dish.photo || '');
                                const menuUrl = dish.menu_file_url || dish.menu_file || '';
                                const menuUrlEsc = _escapeHtml(menuUrl);

                                const optionsHtml = [
                                    `<option value="">‚Äî –Ω–µ –≤—ã–±—Ä–∞–Ω–æ ‚Äî</option>`,
                                    ...menuFiles.map(f => {
                                        const optVal = _escapeHtml(f.url || '');
                                        const optText = _escapeHtml(`${f.date || ''} ‚Äî ${f.filename || ''}`.trim());
                                        const selected = f.url === menuUrl ? 'selected' : '';
                                        const dataFilename = _escapeHtml(f.filename || '');
                                        return `<option value="${optVal}" data-filename="${dataFilename}" ${selected}>${optText}</option>`;
                                    })
                                ].join('');

                                return `
<div class="daily-menu-dish-row" data-index="${idx}" style="border: 1px solid #e5e7eb; border-radius: 12px; padding: 16px; background: #ffffff;">
  <div style="display: flex; justify-content: space-between; align-items: center; gap: 12px; margin-bottom: 12px;">
    <div style="font-weight: 800; color: #111827;">–ë–ª—é–¥–æ #${idx + 1}</div>
    <button type="button" onclick="removeDailyMenuDishRow(${idx})" style="background: #ef4444; color: #ffffff; border: none; border-radius: 10px; padding: 8px 12px; cursor: pointer; font-weight: 700;">–£–¥–∞–ª–∏—Ç—å</button>
  </div>

  <div style="display: grid; grid-template-columns: 1fr 220px; gap: 12px; margin-bottom: 12px;">
    <div>
      <label style="display: block; margin-bottom: 6px; font-weight: 700; color: #374151; font-size: 13px;">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
      <input type="text" class="dish-title-input" value="${title}" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ó–∞–≤—Ç—Ä–∞–∫" style="width: 100%; padding: 10px 12px; border: 1px solid #e5e7eb; border-radius: 10px;">
    </div>
    <div>
      <label style="display: block; margin-bottom: 6px; font-weight: 700; color: #374151; font-size: 13px;">–î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</label>
      <input type="date" class="dish-publish-date-input" value="${publishDate}" style="width: 100%; padding: 10px 12px; border: 1px solid #e5e7eb; border-radius: 10px;">
    </div>
  </div>

  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
    <div>
      <label style="display: block; margin-bottom: 6px; font-weight: 700; color: #374151; font-size: 13px;">–§–æ—Ç–æ –±–ª—é–¥–∞</label>
      <input type="hidden" class="dish-photo-url-input" value="${photoUrl}">
      <div style="display: flex; gap: 12px; align-items: center;">
        <div style="width: 88px; height: 88px; border-radius: 12px; border: 1px solid #e5e7eb; background: #f9fafb; overflow: hidden; flex-shrink: 0;">
          <img class="dish-photo-preview" src="${photoUrl}" alt="" style="width: 100%; height: 100%; object-fit: cover; display: ${photoUrl ? 'block' : 'none'};">
        </div>
        <div style="flex: 1;">
          <input type="file" accept="image/*" onchange="uploadDailyMenuDishPhoto(event, ${idx})" style="width: 100%;">
          <div style="margin-top: 6px; font-size: 12px; color: #6b7280;">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ ‚Äî —Å—Å—ã–ª–∫–∞ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</div>
        </div>
      </div>
    </div>
    <div>
      <label style="display: block; margin-bottom: 6px; font-weight: 700; color: #374151; font-size: 13px;">–§–∞–π–ª –ø–∏—Ç–∞–Ω–∏—è (–∏–∑ ¬´–ü–∏—Ç–∞–Ω–∏–µ¬ª)</label>
      <select class="dish-menu-file-select" style="width: 100%; padding: 10px 12px; border: 1px solid #e5e7eb; border-radius: 10px;">
        ${optionsHtml}
      </select>
      ${menuUrlEsc ? `<div style="margin-top: 6px; font-size: 12px;"><a href="${menuUrlEsc}" target="_blank" style="color:#2563eb; text-decoration:none; font-weight:700;">–û—Ç–∫—Ä—ã—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ–∞–π–ª</a></div>` : ''}
    </div>
  </div>
</div>`;
                            });

                            return rows.join('\n');
                        }

                        function _syncDailyMenuDishesStateFromDom() {
                            const state = window.dailyMenuDishesState;
                            if (!state) return;

                            const rows = Array.from(document.querySelectorAll('.daily-menu-dish-row'));
                            state.dishes = rows.map(row => {
                                const title = row.querySelector('.dish-title-input')?.value?.trim() || '';
                                const publishDate = row.querySelector('.dish-publish-date-input')?.value || '';
                                const photo = row.querySelector('.dish-photo-url-input')?.value?.trim() || '';
                                const menuSelect = row.querySelector('.dish-menu-file-select');
                                const menuFileUrl = menuSelect?.value || '';
                                return {
                                    title,
                                    publish_date: publishDate,
                                    photo,
                                    menu_file_url: menuFileUrl
                                };
                            });
                        }

                        function addDailyMenuDishRow() {
                            const state = window.dailyMenuDishesState;
                            if (!state) return;
                            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è (–≤ —Ç.—á. —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–æ—Ç–æ) –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–æ–π
                            _syncDailyMenuDishesStateFromDom();
                            const today = new Date().toISOString().split('T')[0];
                            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ –±–ª—é–¥–æ –≤ –Ω–∞—á–∞–ª–æ –º–∞—Å—Å–∏–≤–∞, —á—Ç–æ–±—ã –æ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–æ—Å—å –≤–≤–µ—Ä—Ö—É
                            state.dishes.unshift({
                                title: '',
                                publish_date: today,
                                photo: '',
                                menu_file_url: ''
                            });
                            const container = document.getElementById('daily-menu-dishes-rows');
                            if (container) {
                                container.innerHTML = _renderDailyMenuDishesRows(state.dishes, state.menuFiles);
                                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–µ—Ä–µ—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞—Ç—ã
                                _attachDishDateChangeHandlers();
                            }
                        }

                        function _attachDishDateChangeHandlers() {
                            const dateInputs = document.querySelectorAll('.dish-publish-date-input');
                            dateInputs.forEach(input => {
                                input.addEventListener('change', () => {
                                    const state = window.dailyMenuDishesState;
                                    if (!state) return;
                                    
                                    _syncDailyMenuDishesStateFromDom();
                                    state.dishes = _sortDishesByDate(state.dishes);
                                    
                                    const container = document.getElementById('daily-menu-dishes-rows');
                                    if (container) {
                                        container.innerHTML = _renderDailyMenuDishesRows(state.dishes, state.menuFiles);
                                        _attachDishDateChangeHandlers();
                                    }
                                });
                            });
                        }

                        function removeDailyMenuDishRow(index) {
                            const state = window.dailyMenuDishesState;
                            if (!state) return;
                            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è (–≤ —Ç.—á. —Ñ–æ—Ç–æ) –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–æ–π/—É–¥–∞–ª–µ–Ω–∏–µ–º
                            _syncDailyMenuDishesStateFromDom();
                            state.dishes = state.dishes.filter((_, i) => i !== index);
                            const container = document.getElementById('daily-menu-dishes-rows');
                            if (container) {
                                container.innerHTML = _renderDailyMenuDishesRows(state.dishes, state.menuFiles);
                                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–µ—Ä–µ—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞—Ç—ã
                                _attachDishDateChangeHandlers();
                            }
                        }

                        async function uploadDailyMenuDishPhoto(event, index) {
                            try {
                                const file = event?.target?.files?.[0];
                                if (!file) return;
                                if (!file.type?.startsWith('image/')) {
                                    alert('–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
                                    return;
                                }

                                const formData = new FormData();
                                formData.append('file', file);
                                formData.append('section', 'nutrition-dishes-archive');
                                formData.append('field_name', 'daily_menu_dish_photos');

                                const response = await fetch('/sidebar/upload_file', { method: 'POST', body: formData });
                                const result = await response.json();
                                if (!result.success) {
                                    alert(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`);
                                    return;
                                }

                                const row = document.querySelector(`.daily-menu-dish-row[data-index="${index}"]`);
                                if (!row) return;

                                const hidden = row.querySelector('.dish-photo-url-input');
                                const img = row.querySelector('.dish-photo-preview');
                                if (hidden) hidden.value = result.url || '';
                                if (img) {
                                    img.src = result.url || '';
                                    img.style.display = result.url ? 'block' : 'none';
                                }

                                // –í–ê–ñ–ù–û: —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –≤ state, –∏–Ω–∞—á–µ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏/—É–¥–∞–ª–µ–Ω–∏–∏ –±–ª—é–¥
                                // –º–æ–¥–∞–ª –ø–µ—Ä–µ—Ä–∏—Å—É–µ—Ç—Å—è –∏ "–∑–∞–±—ã–≤–∞–µ—Ç" –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ —Ñ–æ—Ç–æ.
                                if (window.dailyMenuDishesState && Array.isArray(window.dailyMenuDishesState.dishes)) {
                                    if (window.dailyMenuDishesState.dishes[index]) {
                                        window.dailyMenuDishesState.dishes[index].photo = result.url || '';
                                    }
                                }
                            } catch (e) {
                                console.error(e);
                                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
                            } finally {
                                if (event?.target) event.target.value = '';
                            }
                        }

                        async function saveDailyMenuDishes() {
                            try {
                                const state = window.dailyMenuDishesState;
                                if (!state) return;

                                const rows = Array.from(document.querySelectorAll('.daily-menu-dish-row'));
                                const dishes = rows.map(row => {
                                    const title = row.querySelector('.dish-title-input')?.value?.trim() || '';
                                    const publishDateInput = row.querySelector('.dish-publish-date-input')?.value || '';
                                    const publishDate = _dateInputToDdMmYyyy(publishDateInput) || _dateInputToDdMmYyyy(new Date().toISOString().split('T')[0]);
                                    const photo = row.querySelector('.dish-photo-url-input')?.value?.trim() || '';
                                    const menuSelect = row.querySelector('.dish-menu-file-select');
                                    const menuFileUrl = menuSelect?.value || '';
                                    const menuFileName = menuSelect?.selectedOptions?.[0]?.dataset?.filename || '';

                                    return {
                                        title,
                                        publish_date: publishDate,
                                        photo,
                                        menu_file_url: menuFileUrl,
                                        menu_file_name: menuFileName
                                    };
                                }).filter(d => d.title || d.photo || d.menu_file_url);

                                // –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ blocks
                                const existingResponse = await fetch('/sidebar/section/nutrition-dishes-archive');
                                const existingData = existingResponse.ok ? await existingResponse.json() : {};
                                const existingBlocks = existingData?.section?.content_blocks || [];

                                const preserved = Array.isArray(existingBlocks)
                                    ? existingBlocks.filter(b => !(b && b.type === 'dishes' && b.title === '–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –º–µ–Ω—é'))
                                    : [];

                                preserved.push({
                                    type: 'dishes',
                                    title: '–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –º–µ–Ω—é',
                                    dishes
                                });

                                const sectionData = {
                                    title: '–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –º–µ–Ω—é',
                                    text: '',
                                    content: '',
                                    content_blocks: preserved
                                };

                                const formData = new FormData();
                                formData.append('wizard_data', JSON.stringify({
                                    'nutrition-dishes-archive': sectionData
                                }));
                                formData.append('save_single', 'true');

                                const response = await fetch('/sidebar/wizard_save', { method: 'POST', body: formData });
                                const result = await response.json();
                                if (!result.success) {
                                    alert(`–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ${result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`);
                                    return;
                                }

                                alert('–ë–ª—é–¥–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
                                closeEditDailyMenuDishes();
                                setTimeout(() => window.location.reload(), 300);
                            } catch (e) {
                                console.error(e);
                                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –±–ª—é–¥. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
                            }
                        }

                        function _focusDailyMenuDishInEditor(focusIndex) {
                            if (focusIndex === undefined || focusIndex === null) return;
                            const idx = Number(focusIndex);
                            if (!Number.isFinite(idx) || idx < 0) return;

                            // –ñ–¥–µ–º –æ–¥–∏–Ω —Ç–∏–∫, —á—Ç–æ–±—ã DOM —É—Å–ø–µ–ª –æ—Ç—Ä–∏—Å–æ–≤–∞—Ç—å—Å—è
                            requestAnimationFrame(() => {
                                const row = document.querySelector(`.daily-menu-dish-row[data-index="${idx}"]`);
                                if (!row) return;
                                row.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                row.classList.add('daily-dish-focus');
                                setTimeout(() => row.classList.remove('daily-dish-focus'), 1200);
                            });
                        }

                        function _sortDishesByDate(dishes) {
                            if (!Array.isArray(dishes)) return dishes;
                            
                            const today = new Date().toISOString().split('T')[0];
                            
                            function parseDate(dateStr) {
                                if (!dateStr) return null;
                                try {
                                    if (dateStr.includes('.')) {
                                        const parts = dateStr.split('.');
                                        if (parts.length === 3) {
                                            return new Date(parseInt(parts[2]), parseInt(parts[1]) - 1, parseInt(parts[0]));
                                        }
                                    } else if (dateStr.includes('-')) {
                                        return new Date(dateStr);
                                    }
                                } catch (e) {
                                    return null;
                                }
                                return null;
                            }
                            
                            function sortKey(dish) {
                                if (!dish || typeof dish !== 'object') {
                                    return [0, new Date(0)];
                                }
                                
                                const publishDate = dish.publish_date || dish.date || '';
                                const dt = parseDate(publishDate);
                                const todayDate = new Date(today);
                                todayDate.setHours(0, 0, 0, 0);
                                
                                if (!dt) {
                                    return [1, new Date('9999-12-31')];
                                }
                                
                                const dtNormalized = new Date(dt);
                                dtNormalized.setHours(0, 0, 0, 0);
                                
                                if (dtNormalized >= todayDate) {
                                    return [1, dt];
                                }
                                
                                return [0, dt];
                            }
                            
                            return [...dishes].sort((a, b) => {
                                const keyA = sortKey(a);
                                const keyB = sortKey(b);
                                
                                if (keyA[0] !== keyB[0]) {
                                    return keyB[0] - keyA[0];
                                }
                                
                                return keyB[1] - keyA[1];
                            });
                        }

                        async function openEditDailyMenuDishes(options = {}) {
                            try {
                                const [sectionResp, menuResp] = await Promise.all([
                                    fetch('/sidebar/section/nutrition-dishes-archive'),
                                    fetch('/sidebar/api/nutrition/menu-files')
                                ]);

                                const sectionData = sectionResp.ok ? await sectionResp.json() : {};
                                const menuData = menuResp.ok ? await menuResp.json() : {};

                                const menuFiles = (menuData && menuData.success && Array.isArray(menuData.files)) ? menuData.files : [];
                                const blocks = sectionData?.section?.content_blocks || [];
                                const dishesBlock = Array.isArray(blocks)
                                    ? blocks.find(b => b && b.type === 'dishes' && b.title === '–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –º–µ–Ω—é')
                                    : null;
                                const dishesRaw = Array.isArray(dishesBlock?.dishes) ? dishesBlock.dishes : [];

                                const dishesUnsorted = dishesRaw.map(d => ({
                                    title: d?.title || '',
                                    publish_date: _dateDdMmYyyyToInput(d?.publish_date || d?.date || '') || (new Date().toISOString().split('T')[0]),
                                    photo: d?.photo || '',
                                    menu_file_url: d?.menu_file_url || d?.menu_file || ''
                                }));

                                const dishes = _sortDishesByDate(dishesUnsorted);

                                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ window –¥–ª—è add/remove
                                window.dailyMenuDishesState = { dishes, menuFiles };

                                const modal = document.createElement('div');
                                modal.id = 'dailyMenuDishesModal';
                                modal.style.cssText = 'position:fixed; inset:0; background: rgba(0,0,0,0.35); z-index: 10000; display:flex; align-items:center; justify-content:center; padding: 20px;';
                                modal.innerHTML = `
<div style="background:#ffffff; border-radius: 18px; width: 100%; max-width: 900px; max-height: 90vh; overflow:hidden; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); display:flex; flex-direction:column;">
  <div style="padding: 20px 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color:#fff; display:flex; justify-content:space-between; align-items:center;">
    <div style="font-size: 18px; font-weight: 800;">üçΩÔ∏è –ë–ª—é–¥–∞ ‚Äî ¬´–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –º–µ–Ω—é¬ª</div>
    <button onclick="closeEditDailyMenuDishes()" style="background: rgba(255,255,255,0.2); border:none; color:#fff; width: 36px; height: 36px; border-radius: 10px; cursor:pointer; font-size: 22px;">√ó</button>
  </div>

  <div style="padding: 20px 24px; overflow:auto; flex:1;">
    <div style="display:flex; justify-content:space-between; align-items:center; gap: 12px; margin-bottom: 14px;">
      <div style="color:#374151; font-weight: 700;">–î–æ–±–∞–≤—å—Ç–µ –æ–¥–Ω–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –±–ª—é–¥</div>
      <button type="button" onclick="addDailyMenuDishRow()" style="background:#10b981; color:#fff; border:none; border-radius: 12px; padding: 10px 14px; cursor:pointer; font-weight: 800;">+ –î–æ–±–∞–≤–∏—Ç—å –±–ª—é–¥–æ</button>
    </div>
    <div id="daily-menu-dishes-rows" style="display:flex; flex-direction:column; gap: 12px;"></div>
  </div>

  <div style="padding: 16px 24px; background:#f8fafc; border-top: 1px solid #e5e7eb; display:flex; justify-content:flex-end; gap: 12px;">
    <button onclick="closeEditDailyMenuDishes()" style="padding: 12px 18px; background:#ffffff; border:1px solid #e5e7eb; border-radius: 12px; cursor:pointer; font-weight: 800; color:#374151;">–û—Ç–º–µ–Ω–∞</button>
    <button onclick="saveDailyMenuDishes()" style="padding: 12px 18px; background:#2563eb; border:none; border-radius: 12px; cursor:pointer; font-weight: 900; color:#ffffff;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –±–ª—é–¥–∞</button>
  </div>
</div>`;

                                document.body.appendChild(modal);
                                document.body.style.overflow = 'hidden';

                                const container = document.getElementById('daily-menu-dishes-rows');
                                if (container) {
                                    if (window.dailyMenuDishesState.dishes.length === 0) {
                                        addDailyMenuDishRow();
                                    } else {
                                        container.innerHTML = _renderDailyMenuDishesRows(window.dailyMenuDishesState.dishes, window.dailyMenuDishesState.menuFiles);
                                        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–µ—Ä–µ—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞—Ç—ã
                                        _attachDishDateChangeHandlers();
                                    }
                                }

                                // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã–ª–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä –∏–∑ –∫–Ω–æ–ø–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –±–ª—é–¥–∞ ‚Äî –ø—Ä–æ—Å–∫—Ä–æ–ª–ª–∏–º –∏ –ø–æ–¥—Å–≤–µ—Ç–∏–º –æ–¥–∏–Ω —Ä–∞–∑
                                _focusDailyMenuDishInEditor(options?.focusIndex);
                            } catch (e) {
                                console.error(e);
                                alert('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –±–ª—é–¥. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
                            }
                        }

                        async function openEditDailyMenu() {
                            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª–∞ "–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –º–µ–Ω—é"
                            try {
                                const response = await fetch('/sidebar/section/nutrition-dishes-archive');
                                const data = await response.json();

                                let sectionData = {
                                    title: '–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –º–µ–Ω—é',
                                    text: '',
                                    photos: [],
                                    documents: [],
                                    dishes: []
                                };

                                if (data.success && data.section) {
                                    sectionData.title = data.section.title || '–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –º–µ–Ω—é';
                                    if (data.section.text) {
                                        try {
                                            const textData = JSON.parse(data.section.text);
                                            sectionData.text = textData.text || textData.form_data?.content || '';
                                        } catch (e) {
                                            sectionData.text = data.section.text;
                                        }
                                    }

                                    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏–∑ content_blocks
                                    if (data.section.content_blocks && Array.isArray(data.section.content_blocks)) {
                                        for (const block of data.section.content_blocks) {
                                            if (block.type === 'text' && block.title === '–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –º–µ–Ω—é') {
                                                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ –±–ª–æ–∫–∞, –µ—Å–ª–∏ –æ–Ω –Ω–µ –±—ã–ª –∑–∞–≥—Ä—É–∂–µ–Ω –∏–∑ text
                                                if (!sectionData.text && block.content) {
                                                    sectionData.text = block.content;
                                                }
                                                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
                                                if (block.photos && Array.isArray(block.photos)) {
                                                    block.photos.forEach(photoUrl => {
                                                        if (photoUrl) {
                                                            sectionData.photos.push({
                                                                url: photoUrl,
                                                                name: photoUrl.split('/').pop() || '–§–æ—Ç–æ'
                                                            });
                                                        }
                                                    });
                                                }
                                                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–æ–∫—É–º–µ–Ω—Ç—ã
                                                if (block.documents && Array.isArray(block.documents)) {
                                                    block.documents.forEach(doc => {
                                                        if (doc) {
                                                            if (typeof doc === 'string') {
                                                                sectionData.documents.push({
                                                                    url: doc,
                                                                    name: doc.split('/').pop() || '–î–æ–∫—É–º–µ–Ω—Ç'
                                                                });
                                                            } else if (doc.url) {
                                                                sectionData.documents.push({
                                                                    url: doc.url,
                                                                    name: doc.name || doc.url.split('/').pop() || '–î–æ–∫—É–º–µ–Ω—Ç'
                                                                });
                                                            }
                                                        }
                                                    });
                                                }
                                            } else if (block.type === 'dishes' && block.title === '–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –º–µ–Ω—é') {
                                                // –ó–∞–≥—Ä—É–∂–∞–µ–º –±–ª—é–¥–∞ –∏–∑ –±–ª–æ–∫–∞
                                                if (block.dishes && Array.isArray(block.dishes)) {
                                                    sectionData.dishes = block.dishes.map(dish => {
                                                        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞—Ç—É –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –∏–∑ —Ñ–æ—Ä–º–∞—Ç–∞ DD.MM.YYYY –≤ YYYY-MM-DD –¥–ª—è input type="date"
                                                        let publishDateValue = dish.publish_date || dish.date || '';
                                                        if (publishDateValue.includes('.')) {
                                                            const parts = publishDateValue.split('.');
                                                            if (parts.length === 3) {
                                                                publishDateValue = `${parts[2]}-${parts[1]}-${parts[0]}`;
                                                            }
                                                        } else if (!publishDateValue) {
                                                            publishDateValue = new Date().toISOString().split('T')[0];
                                                        }

                                                        return {
                                                            title: dish.title || '',
                                                            publish_date: publishDateValue,
                                                            photo: dish.photo || ''
                                                        };
                                                    });
                                                }
                                            }
                                        }
                                    }

                                    // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –≤ content_blocks, –∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ —Ñ–∞–π–ª–æ–≤ —Ä–∞–∑–¥–µ–ª–∞ (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
                                    if (sectionData.photos.length === 0 && sectionData.documents.length === 0) {
                                        const filesResponse = await fetch('/sidebar/get_section_files/nutrition-dishes-archive');
                                        if (filesResponse.ok) {
                                            const filesData = await filesResponse.json();
                                            if (filesData.success && filesData.files) {
                                                filesData.files.forEach(file => {
                                                    if (file.is_image) {
                                                        sectionData.photos.push({
                                                            url: file.url,
                                                            name: file.original_name || file.display_name || file.filename
                                                        });
                                                    } else {
                                                        sectionData.documents.push({
                                                            url: file.url,
                                                            name: file.original_name || file.display_name || file.filename
                                                        });
                                                    }
                                                });
                                            }
                                        }
                                    }
                                }

                                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
                                let currentPublishDate = new Date().toISOString().split('T')[0];
                                if (sectionData.section && sectionData.section.content_blocks) {
                                    for (const block of sectionData.section.content_blocks) {
                                        if (block.type === 'text' && block.title === '–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –º–µ–Ω—é' && block.publish_date) {
                                            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞—Ç—É –∏–∑ DD.MM.YYYY –≤ YYYY-MM-DD
                                            const dateParts = block.publish_date.split('.');
                                            if (dateParts.length === 3) {
                                                currentPublishDate = `${dateParts[2]}-${dateParts[1]}-${dateParts[0]}`;
                                            }
                                            break;
                                        }
                                    }
                                }

                                // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –Ω–æ–≤—ã–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º –¥–∏–∑–∞–π–Ω–æ–º
                                const modal = document.createElement('div');
                                modal.className = 'daily-menu-edit-modal';
                                modal.id = 'dailyMenuEditModal';
                                modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.1)); backdrop-filter: blur(4px); z-index: 10000; display: flex; align-items: center; justify-content: center; padding: 20px;';
                                modal.innerHTML = `
            <div class="daily-menu-edit-container" style="background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); border-radius: 24px; padding: 0; max-width: 800px; width: 100%; max-height: 90vh; overflow: hidden; position: relative; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(0, 0, 0, 0.05); display: flex; flex-direction: column;">
                <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º -->
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 28px 32px; position: relative; overflow: hidden; flex-shrink: 0;">
                    <div style="position: absolute; top: -50%; right: -10%; width: 200px; height: 200px; background: rgba(255, 255, 255, 0.1); border-radius: 50%;"></div>
                    <div style="position: absolute; bottom: -30%; left: -5%; width: 150px; height: 150px; background: rgba(255, 255, 255, 0.08); border-radius: 50%;"></div>
                    <div style="display: flex; justify-content: space-between; align-items: center; position: relative; z-index: 1;">
                        <h2 style="margin: 0; font-size: 1.875rem; color: #ffffff; font-weight: 700; letter-spacing: -0.5px; text-shadow: 0 2px 4px rgba(0,0,0,0.1);">üìã –ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –º–µ–Ω—é</h2>
                        <button onclick="closeEditDailyMenu()" style="background: rgba(255, 255, 255, 0.2); border: none; font-size: 24px; cursor: pointer; color: #ffffff; padding: 8px; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border-radius: 10px; transition: all 0.2s; backdrop-filter: blur(10px);" onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'; this.style.transform='rotate(90deg)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'; this.style.transform='rotate(0deg)'">√ó</button>
                    </div>
                </div>
                
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç —Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π -->
                <div style="padding: 32px; flex: 1; overflow-y: auto; min-height: 0;">
                    <div style="display: flex; flex-direction: column; gap: 28px;">
                        <!-- –¢–µ–∫—Å—Ç -->
                        <div style="background: #ffffff; border-radius: 16px; padding: 24px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0,0,0,0.05); transition: all 0.3s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.08)'" onmouseout="this.style.boxShadow='0 1px 3px rgba(0,0,0,0.05)'">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                                <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px;">‚úèÔ∏è</div>
                                <h3 style="margin: 0; font-size: 1.125rem; color: #1e293b; font-weight: 700;">–¢–µ–∫—Å—Ç</h3>
                            </div>
                            <textarea id="daily-menu-text" rows="6" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –º–µ–Ω—é..." style="width: 100%; padding: 14px; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 15px; resize: vertical; font-family: inherit; transition: all 0.2s; background: #f8fafc;" onfocus="this.style.borderColor='#667eea'; this.style.background='#ffffff'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.background='#f8fafc'; this.style.boxShadow='none'">${sectionData.text}</textarea>
                        </div>
                        
                        <!-- –î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ -->
                        <div style="background: #ffffff; border-radius: 16px; padding: 24px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0,0,0,0.05); transition: all 0.3s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.08)'" onmouseout="this.style.boxShadow='0 1px 3px rgba(0,0,0,0.05)'">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                                <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px;">üìÖ</div>
                                <h3 style="margin: 0; font-size: 1.125rem; color: #1e293b; font-weight: 700;">–î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</h3>
                            </div>
                            <input type="date" id="daily-menu-publish-date" value="${currentPublishDate}" style="width: 100%; padding: 14px; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 15px; transition: all 0.2s; background: #f8fafc; font-family: inherit;" onfocus="this.style.borderColor='#667eea'; this.style.background='#ffffff'; this.style.boxShadow='0 0 0 3px rgba(102, 126, 234, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.background='#f8fafc'; this.style.boxShadow='none'">
                        </div>
                        
                        <!-- –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ -->
                        <div style="background: #ffffff; border-radius: 16px; padding: 24px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0,0,0,0.05); transition: all 0.3s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.08)'" onmouseout="this.style.boxShadow='0 1px 3px rgba(0,0,0,0.05)'">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                                <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px;">üì∑</div>
                                <h3 style="margin: 0; font-size: 1.125rem; color: #1e293b; font-weight: 700;">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</h3>
                            </div>
                            <div class="file-drop-zone" id="daily-menu-photos-drop" style="border: 2px dashed #cbd5e1; border-radius: 12px; padding: 20px; text-align: center; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); cursor: pointer; transition: all 0.3s; position: relative; overflow: hidden;" 
                                 ondrop="handleDailyMenuDrop(event, 'photos')" ondragover="event.preventDefault(); event.currentTarget.style.borderColor='#667eea'; event.currentTarget.style.background='linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%)'; event.currentTarget.style.transform='scale(1.02)'" ondragleave="event.currentTarget.style.borderColor='#cbd5e1'; event.currentTarget.style.background='linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%)'; event.currentTarget.style.transform='scale(1)'" onclick="document.getElementById('daily-menu-photos-input').click();">
                                <div style="font-size: 32px; margin-bottom: 8px;">üì∏</div>
                                <p style="margin: 0; color: #475569; font-size: 14px; font-weight: 600;">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Å—é–¥–∞</p>
                                <p style="margin: 4px 0 0 0; font-size: 12px; color: #94a3b8;">–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤</p>
                                <p style="margin: 6px 0 0 0; font-size: 11px; color: #cbd5e1;">JPG, JPEG, PNG, GIF</p>
                            </div>
                            <input type="file" id="daily-menu-photos-input" accept="image/*" multiple style="display: none;" onchange="handleDailyMenuPhotoSelect(event)">
                            <div id="daily-menu-photos-list" style="margin-top: 20px; display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 16px;">
                                ${sectionData.photos.map((photo, idx) => `
                                    <div class="photo-item" style="position: relative; border: 2px solid #e2e8f0; border-radius: 16px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.08); transition: all 0.3s; aspect-ratio: 1;" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 16px rgba(0,0,0,0.12)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.08)'">
                                        <img src="${photo.url}" alt="${photo.name}" style="width: 100%; height: 100%; object-fit: cover; display: block;">
                                        <button onclick="removeDailyMenuPhoto('${photo.url}')" style="position: absolute; top: 8px; right: 8px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border: none; border-radius: 8px; width: 32px; height: 32px; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center; transition: all 0.2s; box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);" onmouseover="this.style.transform='scale(1.1)'; this.style.boxShadow='0 4px 12px rgba(239, 68, 68, 0.4)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 2px 8px rgba(239, 68, 68, 0.3)'">√ó</button>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- –§–∞–π–ª—ã -->
                        <div style="background: #ffffff; border-radius: 16px; padding: 24px; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0,0,0,0.05); transition: all 0.3s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.08)'" onmouseout="this.style.boxShadow='0 1px 3px rgba(0,0,0,0.05)'">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                                <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px;">üìÑ</div>
                                <h3 style="margin: 0; font-size: 1.125rem; color: #1e293b; font-weight: 700;">–§–∞–π–ª—ã</h3>
                            </div>
                            <div class="file-drop-zone" id="daily-menu-files-drop" style="border: 2px dashed #cbd5e1; border-radius: 12px; padding: 20px; text-align: center; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); cursor: pointer; transition: all 0.3s;" 
                                 ondrop="handleDailyMenuDrop(event, 'files')" ondragover="event.preventDefault(); event.currentTarget.style.borderColor='#667eea'; event.currentTarget.style.background='linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%)'; event.currentTarget.style.transform='scale(1.02)'" ondragleave="event.currentTarget.style.borderColor='#cbd5e1'; event.currentTarget.style.background='linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%)'; event.currentTarget.style.transform='scale(1)'" onclick="document.getElementById('daily-menu-files-input').click();">
                                <div style="font-size: 32px; margin-bottom: 8px;">üìÅ</div>
                                <p style="margin: 0; color: #475569; font-size: 14px; font-weight: 600;">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞</p>
                                <p style="margin: 4px 0 0 0; font-size: 12px; color: #94a3b8;">–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤</p>
                                <p style="margin: 6px 0 0 0; font-size: 11px; color: #cbd5e1;">PDF, DOC, DOCX, XLSX, TXT –∏ –¥—Ä—É–≥–∏–µ</p>
                            </div>
                            <input type="file" id="daily-menu-files-input" multiple style="display: none;" onchange="handleDailyMenuFileSelect(event)">
                            <div id="daily-menu-files-list" style="margin-top: 20px; display: flex; flex-direction: column; gap: 12px;">
                                ${sectionData.documents.map((doc, idx) => `
                                    <div class="file-item" style="display: flex; align-items: center; gap: 16px; padding: 16px; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border: 2px solid #e2e8f0; border-radius: 12px;">
                                        <div style="width: 48px; height: 48px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; flex-shrink: 0;">üìÑ</div>
                                        <a href="${doc.url}" target="_blank" style="flex: 1; color: #1e293b; text-decoration: none; font-size: 15px; font-weight: 500; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${doc.name}</a>
                                        <button onclick="removeDailyMenuFile('${doc.url}')" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border: none; border-radius: 10px; padding: 10px 18px; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.2s; flex-shrink: 0; box-shadow: 0 2px 8px rgba(239, 68, 68, 0.2);" onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 12px rgba(239, 68, 68, 0.3)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 2px 8px rgba(239, 68, 68, 0.2)'">–£–¥–∞–ª–∏—Ç—å</button>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- –§—É—Ç–µ—Ä —Å –∫–Ω–æ–ø–∫–∞–º–∏ -->
                <div style="background: #f8fafc; padding: 24px 32px; border-top: 1px solid #e2e8f0; display: flex; gap: 12px; justify-content: flex-end; flex-shrink: 0; position: sticky; bottom: 0; z-index: 10;">
                    <button onclick="closeEditDailyMenu()" style="padding: 14px 28px; background: #ffffff; border: 2px solid #e2e8f0; border-radius: 12px; cursor: pointer; font-weight: 600; color: #475569; transition: all 0.2s; font-size: 15px;" onmouseover="this.style.borderColor='#cbd5e1'; this.style.background='#f1f5f9'; this.style.transform='translateY(-2px)'" onmouseout="this.style.borderColor='#e2e8f0'; this.style.background='#ffffff'; this.style.transform='translateY(0)'">–û—Ç–º–µ–Ω–∞</button>
                    <button onclick="saveDailyMenu()" style="padding: 14px 28px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 12px; cursor: pointer; font-weight: 700; color: white; transition: all 0.2s; font-size: 15px; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(102, 126, 234, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(102, 126, 234, 0.3)'">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                </div>
            </div>
        `;

                                document.body.appendChild(modal);
                                document.body.style.overflow = 'hidden';

                                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
                                window.dailyMenuData = {
                                    photos: [...sectionData.photos],
                                    documents: [...sectionData.documents]
                                };

                            } catch (error) {
                                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
                            }
                        }

                        function closeEditDailyMenu() {
                            const modal = document.getElementById('dailyMenuEditModal');
                            if (modal) {
                                modal.remove();
                                document.body.style.overflow = '';
                            }
                            window.dailyMenuData = null;
                        }

                        function handleDailyMenuDrop(event, type) {
                            event.preventDefault();
                            event.stopPropagation();
                            event.currentTarget.style.borderColor = '#e5e7eb';

                            const files = Array.from(event.dataTransfer.files);
                            if (type === 'photos') {
                                const imageFiles = files.filter(f => f.type.startsWith('image/'));
                                if (imageFiles.length > 0) {
                                    handleDailyMenuPhotoSelect({ target: { files: imageFiles } });
                                }
                            } else {
                                handleDailyMenuFileSelect({ target: { files: files } });
                            }
                        }

                        async function handleDailyMenuPhotoSelect(event) {
                            const files = Array.from(event.target.files || []);
                            if (files.length === 0) return;

                            const photosList = document.getElementById('daily-menu-photos-list');
                            if (!photosList) return;

                            for (const file of files) {
                                if (!file.type.startsWith('image/')) continue;

                                const formData = new FormData();
                                formData.append('file', file);
                                formData.append('section', 'nutrition-dishes-archive');
                                formData.append('field_name', 'daily_menu_photos');

                                try {
                                    const response = await fetch('/sidebar/upload_file', { method: 'POST', body: formData });
                                    const result = await response.json();

                                    if (result.success) {
                                        if (!window.dailyMenuData) window.dailyMenuData = { photos: [], documents: [] };
                                        window.dailyMenuData.photos.push({
                                            url: result.url,
                                            name: result.original_name || result.filename
                                        });

                                        const photoItem = document.createElement('div');
                                        photoItem.className = 'photo-item';
                                        photoItem.style.cssText = 'position: relative; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden;';
                                        photoItem.innerHTML = `
                    <img src="${result.url}" alt="${result.original_name || result.filename}" style="width: 100%; height: 150px; object-fit: cover;">
                    <button onclick="removeDailyMenuPhoto('${result.url}')" style="position: absolute; top: 4px; right: 4px; background: #ef4444; color: white; border: none; border-radius: 4px; width: 24px; height: 24px; cursor: pointer; font-size: 16px;">√ó</button>
                `;
                                        photosList.appendChild(photoItem);
                                    } else {
                                        alert(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ${file.name}: ${result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`);
                                    }
                                } catch (error) {
                                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏:', error);
                                    alert(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ${file.name}`);
                                }
                            }

                            event.target.value = '';
                        }

                        async function handleDailyMenuFileSelect(event) {
                            const files = Array.from(event.target.files || []);
                            if (files.length === 0) return;

                            const filesList = document.getElementById('daily-menu-files-list');
                            if (!filesList) return;

                            for (const file of files) {
                                const formData = new FormData();
                                formData.append('file', file);
                                formData.append('section', 'nutrition-dishes-archive');
                                formData.append('field_name', 'daily_menu_documents');

                                try {
                                    const response = await fetch('/sidebar/upload_file', { method: 'POST', body: formData });
                                    const result = await response.json();

                                    if (result.success) {
                                        if (!window.dailyMenuData) window.dailyMenuData = { photos: [], documents: [] };
                                        window.dailyMenuData.documents.push({
                                            url: result.url,
                                            name: result.original_name || result.filename
                                        });

                                        const fileItem = document.createElement('div');
                                        fileItem.className = 'file-item';
                                        fileItem.style.cssText = 'display: flex; align-items: center; gap: 12px; padding: 12px; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px; margin-bottom: 8px;';
                                        fileItem.innerHTML = `
                    <span style="font-size: 24px;">üìÑ</span>
                    <a href="${result.url}" target="_blank" style="flex: 1; color: #2563eb; text-decoration: none;">${result.original_name || result.filename}</a>
                    <button onclick="removeDailyMenuFile('${result.url}')" style="background: #ef4444; color: white; border: none; border-radius: 4px; padding: 4px 8px; cursor: pointer;">–£–¥–∞–ª–∏—Ç—å</button>
                `;
                                        filesList.appendChild(fileItem);
                                    } else {
                                        alert(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ${file.name}: ${result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`);
                                    }
                                } catch (error) {
                                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞:', error);
                                    alert(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ${file.name}`);
                                }
                            }

                            event.target.value = '';
                        }

                        function removeDailyMenuPhoto(photoUrl) {
                            if (!window.dailyMenuData || !window.dailyMenuData.photos) return;

                            window.dailyMenuData.photos = window.dailyMenuData.photos.filter(p => p.url !== photoUrl);

                            const photosList = document.getElementById('daily-menu-photos-list');
                            if (photosList) {
                                const photoItem = photosList.querySelector(`img[src="${photoUrl}"]`)?.closest('.photo-item');
                                if (photoItem) {
                                    photoItem.remove();
                                }
                            }
                        }

                        function removeDailyMenuFile(fileUrl) {
                            if (!window.dailyMenuData || !window.dailyMenuData.documents) return;

                            window.dailyMenuData.documents = window.dailyMenuData.documents.filter(d => d.url !== fileUrl);

                            const filesList = document.getElementById('daily-menu-files-list');
                            if (filesList) {
                                const fileItem = filesList.querySelector(`a[href="${fileUrl}"]`)?.closest('.file-item');
                                if (fileItem) {
                                    fileItem.remove();
                                }
                            }
                        }


                        function removeDailyMenuDish(index) {
                            const dishesList = document.getElementById('daily-menu-dishes-list');
                            if (!dishesList) return;

                            const dishItem = dishesList.querySelector(`.dish-edit-item[data-index="${index}"]`);
                            if (dishItem) {
                                dishItem.remove();

                                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å—ã –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                                const remainingItems = dishesList.querySelectorAll('.dish-edit-item');
                                remainingItems.forEach((item, idx) => {
                                    item.setAttribute('data-index', idx);
                                    const removeButton = item.querySelector('button[onclick*="removeDailyMenuDish"]');
                                    if (removeButton) {
                                        removeButton.setAttribute('onclick', `removeDailyMenuDish(${idx})`);
                                    }
                                });

                                // –ï—Å–ª–∏ —É–¥–∞–ª–∏–ª–∏ –≤—Å–µ –±–ª—é–¥–∞, –¥–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç—É—é —Ñ–æ—Ä–º—É –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –±–ª—é–¥–∞
                                if (remainingItems.length === 0) {
                                    const today = new Date().toISOString().split('T')[0];
                                    const emptyDishItem = document.createElement('div');
                                    emptyDishItem.className = 'dish-edit-item';
                                    emptyDishItem.setAttribute('data-index', '0');
                                    emptyDishItem.style.cssText = 'border: 1px solid #e5e7eb; border-radius: 8px; padding: 16px; background: #f9fafb;';
                                    emptyDishItem.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
                    <div>
                        <label style="display: block; margin-bottom: 4px; font-weight: 500; color: #6b7280; font-size: 14px;">–ó–∞–≥–æ–ª–æ–≤–æ–∫ –±–ª—é–¥–∞</label>
                        <input type="text" class="dish-title-input" value="" placeholder="–ë–ª—é–¥–æ –Ω–∞ –¥–µ–Ω—å" style="width: 100%; padding: 8px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 14px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 4px; font-weight: 500; color: #6b7280; font-size: 14px;">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è (URL)</label>
                        <input type="text" class="dish-photo-input" value="" placeholder="/static/uploads/..." style="width: 100%; padding: 8px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 14px;">
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
                    <div>
                        <label style="display: block; margin-bottom: 4px; font-weight: 500; color: #6b7280; font-size: 14px;">–î–∞—Ç–∞ –±–ª—é–¥–∞</label>
                        <input type="date" class="dish-date-input" value="${today}" style="width: 100%; padding: 8px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 14px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 4px; font-weight: 500; color: #6b7280; font-size: 14px;">–î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</label>
                        <input type="date" class="dish-publish-date-input" value="${today}" style="width: 100%; padding: 8px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 14px;">
                    </div>
                </div>
            `;
                                    dishesList.appendChild(emptyDishItem);
                                }
                            }
                        }

                        async function saveDailyMenu() {
                            const text = document.getElementById('daily-menu-text')?.value || '';
                            const publishDate = document.getElementById('daily-menu-publish-date')?.value || '';

                            try {
                                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª–∞ –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –±–ª–æ–∫–æ–≤
                                const existingResponse = await fetch('/sidebar/section/nutrition-dishes-archive');
                                let existingTextBlock = null;
                                if (existingResponse.ok) {
                                    const existingData = await existingResponse.json();
                                    if (existingData.success && existingData.section && existingData.section.content_blocks) {
                                        for (const block of existingData.section.content_blocks) {
                                            if (block.type === 'text' && block.title === '–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –º–µ–Ω—é') {
                                                existingTextBlock = block;
                                                break;
                                            }
                                        }
                                    }
                                }

                                // –°–æ–±–∏—Ä–∞–µ–º —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∏–∑ DOM –∏ window.dailyMenuData
                                const photosList = document.getElementById('daily-menu-photos-list');
                                const photos = [];
                                const photosSet = new Set(); // –î–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

                                // –°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤–ª—è–µ–º —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∏–∑ window.dailyMenuData (–Ω–æ–≤—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ)
                                if (window.dailyMenuData && window.dailyMenuData.photos) {
                                    window.dailyMenuData.photos.forEach(photo => {
                                        if (photo.url && !photosSet.has(photo.url)) {
                                            photos.push(photo.url);
                                            photosSet.add(photo.url);
                                        }
                                    });
                                }

                                // –ó–∞—Ç–µ–º –¥–æ–±–∞–≤–ª—è–µ–º —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∏–∑ DOM (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ)
                                if (photosList) {
                                    const photoItems = photosList.querySelectorAll('.photo-item img');
                                    photoItems.forEach(img => {
                                        if (img.src && !photosSet.has(img.src)) {
                                            photos.push(img.src);
                                            photosSet.add(img.src);
                                        }
                                    });
                                }

                                // –°–æ–±–∏—Ä–∞–µ–º –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏–∑ DOM –∏ window.dailyMenuData
                                const filesList = document.getElementById('daily-menu-files-list');
                                const documents = [];
                                const documentsSet = new Set(); // –î–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

                                // –°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤–ª—è–µ–º –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏–∑ window.dailyMenuData (–Ω–æ–≤—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ)
                                if (window.dailyMenuData && window.dailyMenuData.documents) {
                                    window.dailyMenuData.documents.forEach(doc => {
                                        if (doc.url && !documentsSet.has(doc.url)) {
                                            documents.push({
                                                url: doc.url,
                                                name: doc.name || doc.url.split('/').pop() || '–î–æ–∫—É–º–µ–Ω—Ç'
                                            });
                                            documentsSet.add(doc.url);
                                        }
                                    });
                                }

                                // –ó–∞—Ç–µ–º –¥–æ–±–∞–≤–ª—è–µ–º –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏–∑ DOM (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ)
                                if (filesList) {
                                    const fileItems = filesList.querySelectorAll('.file-item a');
                                    fileItems.forEach(link => {
                                        if (link.href && !documentsSet.has(link.href)) {
                                            documents.push({
                                                url: link.href,
                                                name: link.textContent.trim() || link.href.split('/').pop() || '–î–æ–∫—É–º–µ–Ω—Ç'
                                            });
                                            documentsSet.add(link.href);
                                        }
                                    });
                                }

                                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞—Ç—É –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –∏–∑ —Ñ–æ—Ä–º–∞—Ç–∞ YYYY-MM-DD –≤ DD.MM.YYYY
                                let publishDateFormatted = '';
                                if (publishDate && publishDate.includes('-')) {
                                    const parts = publishDate.split('-');
                                    if (parts.length === 3) {
                                        publishDateFormatted = `${parts[2]}.${parts[1]}.${parts[0]}`;
                                    }
                                } else if (!publishDate) {
                                    const today = new Date();
                                    publishDateFormatted = `${String(today.getDate()).padStart(2, '0')}.${String(today.getMonth() + 1).padStart(2, '0')}.${today.getFullYear()}`;
                                }

                                // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ–º –±–ª–æ–∫ —Ç–∏–ø–∞ "text" —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏, –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ –∏ –¥–∞—Ç–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
                                const contentBlocks = [];

                                // –í—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞–µ–º/–æ–±–Ω–æ–≤–ª—è–µ–º –±–ª–æ–∫, –¥–∞–∂–µ –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç
                                const textBlock = existingTextBlock ? { ...existingTextBlock } : {
                                    type: 'text',
                                    title: '–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –º–µ–Ω—é',
                                    content: '',
                                    photos: [],
                                    documents: []
                                };

                                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –±–ª–æ–∫–∞
                                if (text !== undefined && text !== null) {
                                    textBlock.content = text;
                                }

                                // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–µ, –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ)
                                if (photos.length > 0) {
                                    textBlock.photos = photos;
                                } else if (!existingTextBlock) {
                                    textBlock.photos = [];
                                }

                                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ–∫—É–º–µ–Ω—Ç—ã (–∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–µ, –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ)
                                if (documents.length > 0) {
                                    textBlock.documents = documents;
                                } else if (!existingTextBlock) {
                                    textBlock.documents = [];
                                }

                                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞—Ç—É –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
                                if (publishDateFormatted) {
                                    textBlock.publish_date = publishDateFormatted;
                                }

                                contentBlocks.push(textBlock);

                                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª–∞
                                const sectionData = {
                                    title: '–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –º–µ–Ω—é',
                                    text: text,
                                    content: text,
                                    content_blocks: contentBlocks
                                };

                                console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –º–µ–Ω—é:', {
                                    text,
                                    publishDate: publishDateFormatted,
                                    photos: photos.length,
                                    documents: documents.length,
                                    contentBlocks
                                });

                                const formData = new FormData();
                                formData.append('wizard_data', JSON.stringify({
                                    'nutrition-dishes-archive': sectionData
                                }));
                                formData.append('save_single', 'true');

                                console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä:', {
                                    sectionData,
                                    contentBlocks: contentBlocks.length,
                                    textBlock: contentBlocks[0]
                                });

                                const response = await fetch('/sidebar/wizard_save', {
                                    method: 'POST',
                                    body: formData
                                });

                                if (!response.ok) {
                                    throw new Error(`HTTP error! status: ${response.status}`);
                                }

                                const result = await response.json();
                                console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', result);

                                if (result.success) {
                                    alert('–ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –º–µ–Ω—é —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
                                    closeEditDailyMenu();
                                    // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π, —á—Ç–æ–±—ã –¥–∞–Ω–Ω—ã–µ —É—Å–ø–µ–ª–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è
                                    setTimeout(() => {
                                        window.location.reload();
                                    }, 500);
                                } else {
                                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', result.error);
                                    alert(`–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ${result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`);
                                }
                            } catch (error) {
                                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                                alert(`–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ${error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.`);
                            }
                        }

                        function openEditSection() {
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ sidebar —Ä–∞–∑–¥–µ–ª–æ–º
                            const sectionEndpoint = '{{ section.endpoint }}';
                            const sectionUrl = '{{ section.url }}';

                            // –ï—Å–ª–∏ —Ä–∞–∑–¥–µ–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ /sidebar/, –æ—Ç–∫—Ä—ã–≤–∞–µ–º sidebar –º–∞—Å—Ç–µ—Ä
                            const isSidebarPage = (window.location && window.location.pathname || '').startsWith('/sidebar/');
                            if (sectionUrl.includes('/sidebar/') || isSidebarPage) {
                                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –¥–ª—è sidebar –º–∞—Å—Ç–µ—Ä–∞
                                if (window.sidebarWizardManager) {
                                    // –í–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º sidebar –º–∞—Å—Ç–µ—Ä–∞
                                    window.IS_SIDEBAR_WIZARD = true;
                                    // –ù–∞—Ö–æ–¥–∏–º/–¥–æ–±–∞–≤–ª—è–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —à–∞–≥ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –Ω–µ–º—É
                                    let stepIndex = window.sidebarWizardManager.wizardSteps.findIndex(step => step.endpoint === sectionEndpoint);
                                    if (stepIndex < 0 && typeof window.sidebarWizardManager.ensureDynamicStep === 'function') {
                                        stepIndex = window.sidebarWizardManager.ensureDynamicStep(sectionEndpoint, '{{ section.title|e }}');
                                    }

                                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                                    if (Object.keys(window.sidebarWizardManager.wizardData).length === 0 || !window.sidebarWizardManager.wizardData[sectionEndpoint]) {
                                        window.sidebarWizardManager.loadWizardData().then(() => {
                                            window.sidebarWizardManager.currentStep = stepIndex >= 0 ? stepIndex : 0;
                                            window.sidebarWizardManager.renderSteps();
                                            window.sidebarWizardManager.renderCurrentStep();
                                            window.sidebarWizardManager.open();
                                        });
                                    } else {
                                        window.sidebarWizardManager.currentStep = stepIndex >= 0 ? stepIndex : 0;
                                        window.sidebarWizardManager.renderSteps();
                                        window.sidebarWizardManager.renderCurrentStep();
                                        window.sidebarWizardManager.open();
                                    }
                                } else {
                                    alert('–ú–∞—Å—Ç–µ—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
                                }
                            } else {
                                // –ò–Ω–∞—á–µ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –æ–±—ã—á–Ω—ã–π –º–∞—Å—Ç–µ—Ä
                                if (typeof window.openWizard === 'function') {
                                // –ü—Ä–æ—Å–∏–º –º–∞—Å—Ç–µ—Ä —Å—Ä–∞–∑—É –æ—Ç–∫—Ä—ã—Ç—å —à–∞–≥ —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞–∑–¥–µ–ª–∞
                                window.WIZARD_TARGET_ENDPOINT = sectionEndpoint || null;
                                    window.openWizard();
                                // –î–∞–ª—å–Ω–µ–π—à–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ loadWizardData
                                }
                            }
                        }

                        // –£–¥–∞–ª–µ–Ω prompt-—Å–ø–æ—Å–æ–± —Å–æ–∑–¥–∞–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ openCreateSidebarSubsectionModal(parent)

                        // –£–¥–∞–ª–µ–Ω–∏–µ –±–ª—é–¥–∞ –∏–∑ –∞—Ä—Ö–∏–≤–∞
                        async function deleteDishFromArchive(dishDate, dishTitle) {
                            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –±–ª—é–¥–æ "${dishTitle}" (–¥–∞—Ç–∞: ${dishDate})?`)) {
                                return;
                            }

                            try {
                                const response = await fetch('/sidebar/delete_dish', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify({
                                        dish_date: dishDate,
                                        dish_title: dishTitle
                                    })
                                });

                                const result = await response.json();

                                if (result.success) {
                                    alert('–ë–ª—é–¥–æ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ');
                                    window.location.reload();
                                } else {
                                    alert(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ${result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`);
                                }
                            } catch (error) {
                                console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –±–ª—é–¥–∞:', error);
                                alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –±–ª—é–¥–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
                            }
                        }
                    </script>

                    {% endif %}
                </div>

                <div id="personDetailModal" class="person-detail-modal" aria-hidden="true" role="dialog" aria-labelledby="personDetailModalTitle">
                    <div class="person-detail-modal-overlay"></div>
                    <div class="person-detail-modal-box">
                        <button type="button" class="person-detail-modal-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">&times;</button>
                        <div class="person-detail-modal-content" id="personDetailModalContent"></div>
                    </div>
                </div>
                <script>
                    (function() {
                        var modal = document.getElementById('personDetailModal');
                        if (modal && modal.parentNode !== document.body) {
                            document.body.appendChild(modal);
                        }
                        var contentEl = document.getElementById('personDetailModalContent');
                        var overlay = modal && modal.querySelector('.person-detail-modal-overlay');
                        var closeBtn = modal && modal.querySelector('.person-detail-modal-close');
                        function closeModal() {
                            if (modal) { modal.classList.remove('person-detail-modal-open'); modal.setAttribute('aria-hidden', 'true'); }
                        }
                        function openModal(data) {
                            if (!contentEl || !data) return;
                            var photo = data.photo || data.photo_url || '';
                            if (photo.indexOf('|') >= 0) photo = photo.split('|')[0].trim();
                            var name = data.name || '‚Äî';
                            var position = data.position || '‚Äî';
                            var email = data.email || '';
                            var phone = data.phone || '';
                            var description = (data.description || '').trim();
                            var experience = (data.experience || '').trim();
                            var education = (data.education || '').trim();
                            var retraining = (data.professional_retraining || '').trim();
                            var awards = (data.awards || '').trim();
                            var courses = (data.courses || '').trim();
                            var parts = [];
                            parts.push('<div class="person-detail-header">');
                            if (photo) parts.push('<div class="person-detail-photo"><img src="' + photo.replace(/"/g, '&quot;') + '" alt="" onerror="this.style.display=\'none\'"></div>');
                            parts.push('<div class="person-detail-title-wrap"><h2 id="personDetailModalTitle" class="person-detail-name">' + (name.replace(/</g, '&lt;').replace(/>/g, '&gt;')) + '</h2><p class="person-detail-position">' + (position.replace(/</g, '&lt;').replace(/>/g, '&gt;')) + '</p></div></div>');
                            parts.push('<div class="person-detail-body">');
                            if (email) parts.push('<p class="person-detail-row"><strong>E-mail:</strong> <a href="mailto:' + email.replace(/"/g, '&quot;') + '">' + email.replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</a></p>');
                            if (phone) parts.push('<p class="person-detail-row"><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> ' + phone.replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</p>');
                            if (description) parts.push('<p class="person-detail-desc">' + description.replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\n/g, '<br>') + '</p>');
                            if (experience) parts.push('<p class="person-detail-row"><strong>–ü–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–∞–∂:</strong> ' + experience.replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</p>');
                            if (education) parts.push('<p class="person-detail-row"><strong>–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ:</strong></p><p class="person-detail-text">' + education.replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\n/g, '<br>') + '</p>');
                            if (retraining) parts.push('<p class="person-detail-row"><strong>–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞:</strong></p><p class="person-detail-text">' + retraining.replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\n/g, '<br>') + '</p>');
                            if (awards) parts.push('<p class="person-detail-row"><strong>–ù–∞–≥—Ä–∞–¥—ã –∏ –∑–≤–∞–Ω–∏—è:</strong></p><ul class="person-detail-list">' + awards.split(/\n/).filter(function(s){ return s.trim(); }).map(function(s){ return '<li>' + s.replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</li>'; }).join('') + '</ul>');
                            if (courses) parts.push('<p class="person-detail-row"><strong>–ö—É—Ä—Å—ã –ø–æ–≤—ã—à–µ–Ω–∏—è –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏:</strong></p><ol class="person-detail-list person-detail-list-ol">' + courses.split(/\n/).filter(function(s){ return s.trim(); }).map(function(s){ return '<li>' + s.replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</li>'; }).join('') + '</ol>');
                            parts.push('</div>');
                            contentEl.innerHTML = parts.join('');
                            if (modal) { modal.classList.add('person-detail-modal-open'); modal.setAttribute('aria-hidden', 'false'); }
                        }
                        document.addEventListener('click', function(e) {
                            var card = e.target && e.target.closest && e.target.closest('.person-card-clickable');
                            if (card) {
                                e.preventDefault();
                                var id = card.getAttribute('data-person-data-id');
                                var script = id && document.getElementById(id);
                                if (script) {
                                    try { openModal(JSON.parse(script.textContent)); } catch (err) { }
                                }
                            }
                            if (e.target === overlay || e.target === closeBtn) closeModal();
                        });
                        document.addEventListener('keydown', function(e) {
                            if (e.key === 'Escape' && modal && modal.classList.contains('person-detail-modal-open')) closeModal();
                        });
                    })();
                </script>
                {% endblock %}